<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Pink Blog</title>
  <icon>https://www.gravatar.com/avatar/5c6581fa74d8841029b0c88328e88401</icon>
  <subtitle>Simplicity is the soul of efficiency.</subtitle>
  <link href="http://pinkpika.github.io/pinkblog/atom.xml" rel="self"/>
  
  <link href="http://pinkpika.github.io/pinkblog/"/>
  <updated>2022-03-15T17:16:08.288Z</updated>
  <id>http://pinkpika.github.io/pinkblog/</id>
  
  <author>
    <name>pinkpika</name>
    <email>tim801217@gmail.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SwiftUI å’Œ Combine çš„ç¬¬ä¸€æ¬¡æ¥è§¸</title>
    <link href="http://pinkpika.github.io/pinkblog/2022/03/15/SwiftUI-%E5%92%8C-Combine-%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%8E%A5%E8%A7%B8/"/>
    <id>http://pinkpika.github.io/pinkblog/2022/03/15/SwiftUI-%E5%92%8C-Combine-%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%8E%A5%E8%A7%B8/</id>
    <published>2022-03-15T09:44:01.000Z</published>
    <updated>2022-03-15T17:16:08.288Z</updated>
    
    <content type="html"><![CDATA[<div class="note default flat"><p>å¾ 2019 å¹´çš„ WWDC ç™¼å¸ƒ SwiftUI å’Œ Combine è‡³ä»Šéè¨±ä¹…ï¼Œä½†é²é²æ²’æœ‰é–‹å§‹å­¸ç¿’å’Œæ‡‰ç”¨ï¼Œæœ€è¿‘æƒ³é–‹å§‹æ…¢æ…¢æ¥è§¸å®ƒï¼Œé€™åªæ˜¯ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæœªä¾†æœƒå†æŒçºŒè¨˜éŒ„ä¸‹å»ã€‚</p></div><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä»¥å‰é–‹ç™¼ App æ˜¯åŸºæ–¼ Objective-C ç·¨å¯«ç¨‹å¼çš„æ–¹å¼ï¼ŒåŠ ä¸Š Cocoa Design Patterns ä¾‹å¦‚ target/actionã€delegate/protocolã€KVOã€NotificationCenterï¼Œä¸¦ä¸”ä½¿ç”¨ AppKit å’Œ UIKit çš„ UI ç³»çµ±å’Œ MVC çš„ç¨‹å¼æ¶æ§‹ï¼Œè€Œ Swift åŸºæœ¬ä¸Šä¹Ÿæ˜¯å°‡ä¸Šè¿°ç”¨æ³•åŸå°ä¸å‹•åœ°å°è£æˆè‡ªå·±çš„æ¥å£ï¼Œç™¼å±•å‡ºæ›´ç°¡åŒ–æ›´å®‰å…¨çš„å‘¼å«æ–¹å¼ï¼Œç”±æ–¼è¿‘ä»£ç¨‹å¼èªè¨€çš„æ¼”é€²å’Œè¶¨å‹¢ï¼ŒåŒæ™‚å‰ç«¯å„ç¨®èªè¨€å’Œæ¡†æ¶çš„èˆˆèµ· ( React Native å’Œ Flutter â€¦ )ï¼ŒSwift ä¹Ÿé€²è€Œæ¼”åŒ–å‡º SwiftUI å’Œ Combineã€‚</p><p>é€™é‚Šè¦å…ˆæåŠå¦ä¸€å€‹åè©å«åšâ€ç¨‹å¼ç¯„å¼â€ï¼Œä¸€èˆ¬ä¾†èªªâ€ç¨‹å¼ç¯„å¼â€ï¼ˆ <a href="https://en.wikipedia.org/wiki/Programming_paradigm">Programming Paradigm</a> ) æœƒç›´æ¥å½±éŸ¿å¯«ç¨‹å¼çš„æ€è€ƒæ–¹å¼å’Œé‚è¼¯ï¼Œæœ‰äº›ç¨‹å¼èªè¨€åªç‚ºä¸€ç¨®ç¯„å¼è€Œè¨­è¨ˆã€æœ‰äº›ç¨‹å¼èªè¨€å¯ä»¥ç”¨å¤šç¨®ç¯„å¼å»æ’°å¯«ã€‚</p><p>æœ€ç°¡å–®å¯ä»¥æœ‰å…©ç¨®åˆ†é¡æ–¹å¼</p><ul><li>æŒ‡ä»¤å¼ç¨‹å¼è¨­è¨ˆ ( <a href="https://en.wikipedia.org/wiki/Imperative_programming">Imperative Programming</a> ):<ul><li>åˆ©ç”¨é‹ç®—ç¬¦è™Ÿ + å¾ªç’°åŸ·è¡Œ + æ¢ä»¶åˆ¤æ–·ï¼Œä¸€è¡Œä¸€æŒ‡ä»¤ï¼Œä¸æ–·åœ°å¾€ä¸‹åŸ·è¡Œä¾†é”åˆ°ç›®æ¨™çš„åŠŸèƒ½ =&gt; <strong>æè¿°éç¨‹</strong></li><li>ä»¥ç¾©å¤§åˆ©éºµçš„æ¡ˆä¾‹ä¾†è¬›ï¼Œå°±åƒå…ˆæ»¾æ°´ç…®ç†Ÿå¤©ä½¿ç´°éºµã€æ’ˆå‡ºéºµæ¢ã€èˆ‡è‚‰é†¬æ”ªæ‹Œç†±ç‚’ã€æ”¾å…¥ç›¤ä¸­</li><li>ä¹Ÿå°±æ˜¯ä»¥å‰æˆ‘å€‘æ’°å¯« OC å’Œ Swift æ‰€ä½¿ç”¨çš„æ–¹å¼</li><li>å…¶ä¸­é‚„æœ‰æ›´è©³ç´°çš„åˆ†é¡ï¼Œä¾‹å¦‚ Procedural / Structured / Object-oriented programming â€¦</li></ul></li><li>å®£å‘Šå¼ç¨‹å¼è¨­è¨ˆ ( <a href="https://en.wikipedia.org/wiki/Declarative_programming">Declarative Programming</a> ): <ul><li>åˆ©ç”¨å®£å‘Šçš„æ–¹å¼ï¼Œåœ¨åˆå§‹åŒ–å°±å®šç¾©å¥½è³‡æ–™å’Œ View çš„ç‹€æ…‹å’Œæœªä¾†çš„èµ°å‘ =&gt; <strong>æè¿°çµæœ</strong></li><li>ä»¥ç¾©å¤§åˆ©éºµçš„æ¡ˆä¾‹ä¾†è¬›ï¼Œå°±åƒå®šç¾©ä¸€å€‹ç¾©å¤§åˆ©è‚‰é†¬å¤©ä½¿ç´°éºµ</li><li>ä¸€èˆ¬ä½¿ç”¨â€å‡½æ•¸å¼ç¨‹å¼è¨­è¨ˆâ€æˆ–æ˜¯â€é ˜åŸŸç‰¹å®šèªè¨€ ( DSL/Domain-Specific Language , ex. HTMLã€SQL ) ä¾†å¯¦ä½œå®£å‘Šå¼ç¨‹å¼è¨­è¨ˆ</li><li>SwiftUI å°±æ˜¯é€™ç¨®æ€è€ƒæ–¹å¼</li></ul></li></ul><p>Combine æ˜¯åŸºæ–¼éŸ¿æ‡‰å¼ç¨‹å¼è¨­è¨ˆ ( <a href="https://en.wikipedia.org/wiki/Reactive_programming">Reactive Programming</a> ) ä¾†ç®¡ç†æ•¸æ“šè³‡æ–™ï¼Œä¹Ÿç®—æ˜¯å®£å‘Šå¼ç¨‹å¼è¨­è¨ˆçš„å…¶ä¸­ä¸€å€‹åˆ†æ”¯ã€‚</p><p>å› æ­¤åœ¨é–‹ç™¼ SwiftUI å’Œ Combine ç›¡é‡è¦ä¸Ÿæ£„ä»¥å¾€çš„æ€è€ƒæ–¹å¼ï¼Œç”¨å…¨æ–°çš„çœ‹æ³•å»é–‹ç™¼æœƒæ›´å®¹æ˜“ç†è§£ã€‚</p><hr><h1 id="SwiftUI"><a href="#SwiftUI" class="headerlink" title="SwiftUI"></a>SwiftUI</h1><p>é€™è£¡ä¸è©³ç´°èªªæ˜ SwiftUI çš„ç”¨æ³•ï¼Œåƒ…åƒ…åˆ—å‡ºç¯„ä¾‹ï¼Œæœªä¾†å†è©³ç´°æ•´ç†ã€‚<br>å€¼å¾—ä¸€æçš„æ˜¯ SwiftUI çš„ <a href="https://developer.apple.com/documentation/swiftui/view">View</a> æ˜¯ä¸€å€‹ Protocolï¼Œå¯¦åšå‡ºä¾†çš„ View ä¾‹å¦‚ VStackã€Spacerã€Button ä¹Ÿéƒ½æ˜¯ structï¼Œè€Œä¸”é€£ Color éƒ½æ˜¯ Conform View çš„ structã€‚</p><img src="/pinkblog/2022/03/15/SwiftUI-%E5%92%8C-Combine-%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%8E%A5%E8%A7%B8/1.png" class="" width="800"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CakeView</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(spacing: <span class="number">12</span>) &#123;</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Cake List&quot;</span>)</span><br><span class="line">                .font(.system(size: <span class="number">32</span>))</span><br><span class="line">                .foregroundColor(.gray)</span><br><span class="line">                .minimumScaleFactor(<span class="number">0.5</span>)</span><br><span class="line">                .padding(.trailing, <span class="number">24</span>)</span><br><span class="line">                .frame(</span><br><span class="line">                    minWidth: <span class="number">0</span>,</span><br><span class="line">                    maxWidth: .infinity,</span><br><span class="line">                    alignment: .trailing)</span><br><span class="line">            <span class="type">CakeButtonRow</span>(row: [.strawberry, .cocolate, .cheese])</span><br><span class="line">                .padding(.bottom)</span><br><span class="line">            <span class="type">CakeButtonRow</span>(row: [.cocolate, .cheese, .strawberry])</span><br><span class="line">                .padding(.bottom)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CakeView_Previews</span> : <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">CakeView</span>()</span><br><span class="line">            <span class="type">CakeView</span>().previewDevice(<span class="string">&quot;iPhone 13&quot;</span>)</span><br><span class="line">            <span class="type">CakeView</span>().previewDevice(<span class="string">&quot;iPad Air 2&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CakeButtonRow</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> row: [<span class="type">CakeItem</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">ForEach</span>(row, id: \.<span class="keyword">self</span>) &#123; item <span class="keyword">in</span></span><br><span class="line">                <span class="type">CakeButton</span>(</span><br><span class="line">                    title: item.title,</span><br><span class="line">                    backgroundColor: item.backgroundColor)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Button: <span class="subst">\(item.title)</span>&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CakeButton</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> title: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> backgroundColor: <span class="type">Color</span></span><br><span class="line">    <span class="keyword">let</span> action: () -&gt; <span class="type">Void</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(action: action) &#123;</span><br><span class="line">            <span class="type">Text</span>(title)</span><br><span class="line">                .font(.system(size: <span class="number">16</span>))</span><br><span class="line">                .foregroundColor(.white)</span><br><span class="line">                .frame(width: <span class="number">120</span>, height: <span class="number">30</span>)</span><br><span class="line">                .background(backgroundColor)</span><br><span class="line">                .cornerRadius(<span class="number">30</span><span class="operator">/</span><span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">CakeItem</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> strawberry</span><br><span class="line">    <span class="keyword">case</span> cocolate</span><br><span class="line">    <span class="keyword">case</span> cheese</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .strawberry: <span class="keyword">return</span> <span class="string">&quot;Strawberry&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .cocolate: <span class="keyword">return</span> <span class="string">&quot;Cocolate&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .cheese: <span class="keyword">return</span> <span class="string">&quot;Cheese&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> backgroundColor: <span class="type">Color</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .strawberry: <span class="keyword">return</span> .pink</span><br><span class="line">        <span class="keyword">case</span> .cocolate: <span class="keyword">return</span> .brown</span><br><span class="line">        <span class="keyword">case</span> .cheese: <span class="keyword">return</span> .yellow</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CakeItem</span>: <span class="title">Hashable</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="Combine"><a href="#Combine" class="headerlink" title="Combine"></a>Combine</h1><h2 id="å–®å‘æ•¸æ“šæµçš„-Redux"><a href="#å–®å‘æ•¸æ“šæµçš„-Redux" class="headerlink" title="å–®å‘æ•¸æ“šæµçš„ Redux"></a>å–®å‘æ•¸æ“šæµçš„ Redux</h2><p>åœ¨ä½¿ç”¨ Combine ä¹‹å‰ï¼Œéœ€è¦å…ˆç†è§£ä¸€ä¸‹<strong>å–®å‘æ•¸æ“šæµçš„ <a href="https://redux.js.org/">Redux</a></strong> æ¦‚å¿µå’Œ <a href="https://facebook.github.io/flux/">Flux</a>ï¼Œå…¶æ€æƒ³ä¾†æºç‚º <a href="https://elm-lang.org/">Elm</a>ï¼Œå¾Œä¾†ä¹Ÿå½±éŸ¿å…¶ä»–å‰å°çš„é–‹ç™¼æ¡†æ¶ React Component å’Œ Flutterã€‚</p><img src="/pinkblog/2022/03/15/SwiftUI-%E5%92%8C-Combine-%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%8E%A5%E8%A7%B8/redux.png" class="" width="300"><p>å®ƒéœ€è¦ä»¥ä¸‹æ±è¥¿é©…å‹•è³‡æ–™æ›´å‹•</p><ul><li>Store: å°ˆé–€å­˜æ”¾å¤šå€‹ State</li><li>State: å¯è¦–ç‚ºç‹€æ…‹æˆ–æ˜¯è³‡æ–™</li><li>Reducer: å¯ç”¨æ–¼æ›´æ–° State<ul><li>ç‰¹æ€§æ˜¯ç´”å‡½æ•¸è¨­è¨ˆï¼Œæ­¤æ–¹æ³•åªæœƒä¾ç…§åƒæ•¸æ±ºå®šå›å‚³å€¼ï¼Œä¸æœƒä¾è³´ä»»ä½•ç³»çµ±ç‹€æ…‹ï¼Œä¹Ÿä¸æ‡‰æ”¹è®Šä»»ä½•å…¨åŸŸè³‡æ–™ï¼Œå› æ­¤æ²’æœ‰ä»»ä½•ä¾è³´é—œä¿‚ã€‚</li></ul></li><li>Action: ç”¨ä¾†é©…å‹• Reducer</li><li>View: ä¸èƒ½ç›´æ¥æ“ä½œ Status è€Œæ˜¯åˆ©ç”¨ Action ç™¼å‹•æ”¹è®Š Store ä¸­çš„ State</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Reducer</span> </span>&#123; </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">reduce</span>(<span class="params">state</span>: <span class="type">CakeState</span>, <span class="params">action</span>: <span class="type">CakeAction</span>)</span> -&gt; <span class="type">CakeState</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state.apply(item: action) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è³‡æ–™è™•ç†æ–¹å¼"><a href="#è³‡æ–™è™•ç†æ–¹å¼" class="headerlink" title="è³‡æ–™è™•ç†æ–¹å¼"></a>è³‡æ–™è™•ç†æ–¹å¼</h2><p>Swift ç‚ºäº†æ¨¡æ“¬å‡ºå–®å‘æ•¸æ“šæµçš„æ–¹å¼ï¼Œåˆ©ç”¨å±¬æ€§åŒ…è£ (Property Wrapper)ï¼Œè³¦äºˆäº†å±¬æ€§æœ‰å„ç¨®ç‰¹æ€§ã€‚</p><h3 id="State"><a href="#State" class="headerlink" title="@State"></a>@State</h3><p>æ­¤å±¬æ€§æœƒè‡ªå‹•å…§éƒ¨ç”Ÿæˆ setter å’Œ getterï¼Œç•¶ç™¼æ•¸æ•¸å€¼è®ŠåŒ–æ™‚ï¼Œbody æœƒè‡ªå‹•é€²è¡Œåˆ·æ–°ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">CakeState</span></span>&#123;</span><br><span class="line">    <span class="keyword">case</span> unselect</span><br><span class="line">    <span class="keyword">case</span> didselect(item: <span class="type">CakeItem</span>)</span><br><span class="line">    <span class="keyword">var</span> message: <span class="type">String</span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .unselect:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;æœªé¸æ“‡&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .didselect(<span class="keyword">let</span> item):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;å·²é¸æ“‡ - <span class="subst">\(item.title)</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CakeView</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> cakeState: <span class="type">CakeState</span> <span class="operator">=</span> .unselect</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="type">CakeButtonRow</span>(cakeState: <span class="variable">$cakeState</span>, row: [.cocolate, .cheese, .strawberry])</span><br><span class="line">            .padding(.bottom)</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Binding"><a href="#Binding" class="headerlink" title="@Binding"></a>@Binding</h3><p>å¦‚æœç”¨ @State å°‡çˆ¶å±¤çš„ç‹€æ…‹å‚³åˆ°å­å±¤ï¼Œä½†å­å±¤æŒ‰éˆ•å»ç„¡æ³•å°æœ€ä¸Šå±¤çš„ cakeState é€²è¡Œæ”¹è®Šï¼Œå› æ­¤éœ€è¦ @Bindingï¼Œæ­¤å±¬æ€§è§€å¯Ÿçš„ä¸æ˜¯å±¬æ€§æœ¬èº«ï¼Œè€Œæ˜¯ä»–çš„åƒè€ƒå¼•ç”¨ï¼Œä¸¦ä¸”å‚³éæ™‚ä½¿ç”¨ $ï¼Œé€™ç¨±ç‚ºæŠ•å½±å±æ€§(projection property)ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CakeButtonRow</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> cakeState: <span class="type">CakeState</span></span><br><span class="line">    <span class="keyword">let</span> row: [<span class="type">CakeItem</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">ForEach</span>(row, id: \.<span class="keyword">self</span>) &#123; item <span class="keyword">in</span></span><br><span class="line">                <span class="type">CakeButton</span>(</span><br><span class="line">                    title: item.title,</span><br><span class="line">                    backgroundColor: item.backgroundColor)</span><br><span class="line">                &#123;</span><br><span class="line">                    cakeState <span class="operator">=</span> .didselect(item: item)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Button: <span class="subst">\(item.title)</span>&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å±•ç¤º @State + @Binding çš„çµæœï¼Œé»æ“Šä¸‹æ–¹æŒ‰éˆ•æœƒæ›´æ–°æœ€ä¸Šé¢çš„æ–‡å­—</p><img src="/pinkblog/2022/03/15/SwiftUI-%E5%92%8C-Combine-%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%8E%A5%E8%A7%B8/2.png" class="" width="300"><hr><h3 id="ObservedObject"><a href="#ObservedObject" class="headerlink" title="@ObservedObject"></a>@ObservedObject</h3><p>@State å¯ä»¥æ¥µç‚ºç°¡å–®è™•ç†ä¸€å€‹å–®ä¸€è³‡æ–™çš„è³‡æ–™æºï¼Œä½†å¦‚æœéœ€è¦ä¸€å€‹å¤šå€‹è³‡æ–™çš„è³‡æ–™æºçš„æƒ…å¢ƒå‘¢ï¼Ÿæˆ–æ˜¯æ›´è¤‡é›œçš„é€šçŸ¥æƒ…å¢ƒå‘¢ï¼Ÿ</p><ol><li>å¿…é ˆè¦è‡ªè¡Œå®šç¾© Model ä¸¦ä¸” conform ObservedObjectï¼ŒåŒæ™‚å¿…é ˆè¦æ˜¯ classï¼Œä¾‹å¦‚ CakeModel</li><li>åœ¨ state ç™¼ç”Ÿè®ŠåŒ–æ™‚(willSet)ï¼Œéœ€è¦åˆ©ç”¨ PassthroughSubject ç‰©ä»¶ï¼Œç™¼å‹•é€šçŸ¥</li><li>å®£å‘Šæ™‚ä½¿ç”¨ @ObservedObject å³å¯</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CakeModel</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> objectWillChange <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Void</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">    <span class="keyword">var</span> state: <span class="type">CakeState</span> <span class="operator">=</span> .unselect &#123; </span><br><span class="line">        <span class="keyword">willSet</span> &#123; objectWillChange.send() &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CakeView</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="comment">//@State private var cakeState: CakeState = .unselect</span></span><br><span class="line">    <span class="meta">@ObservedObject</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">CakeModel</span>()</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="type">CakeButtonRow</span>(cakeState: <span class="variable">$model</span>.state, row: [.cocolate, .cheese, .strawberry])</span><br><span class="line">            .padding(.bottom)</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CakeButtonRow</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ObservedObject</span> <span class="keyword">var</span> model: <span class="type">CakeModel</span></span><br><span class="line">    <span class="keyword">let</span> row: [<span class="type">CakeItem</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">ForEach</span>(row, id: \.<span class="keyword">self</span>) &#123; item <span class="keyword">in</span></span><br><span class="line">                <span class="type">CakeButton</span>(</span><br><span class="line">                    title: item.title,</span><br><span class="line">                    backgroundColor: item.backgroundColor)</span><br><span class="line">                &#123;</span><br><span class="line">                    model.state <span class="operator">=</span> .didselect(item: item)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Button: <span class="subst">\(item.title)</span>&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Published"><a href="#Published" class="headerlink" title="@Published"></a>@Published</h3><p>å¦‚æœæ‰‹å‹•é€²è¡Œé€šçŸ¥å…¶å¯¦è »éº»ç…©çš„ï¼Œå¯ä»¥ä½¿ç”¨ @Publishedï¼Œé è¨­å°±æœƒå¸¶æœ‰é€šçŸ¥æ•ˆæœã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CakeModel</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> state: <span class="type">CakeState</span> <span class="operator">=</span> .unselect</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="EnvironmentObject"><a href="#EnvironmentObject" class="headerlink" title="@EnvironmentObject"></a>@EnvironmentObject</h3><p>ä¸Šé¢æåˆ°çš„ @ObservedObject çš„ç¯„ä¾‹å¿…é ˆä¸€å±¤ä¸€å±¤å¾€ä¸‹å‚³éï¼Œå°è‡´æ’°å¯«ä¸Šçš„éº»ç…©ï¼Œ<br>å› æ­¤çˆ¶å±¤å¯ä»¥ä½¿ç”¨ @EnvironmentObjectï¼Œè¢«æ¨™è¨˜çš„å±¬æ€§æœƒé€²è¡Œè‡ªå‹•åœ°æŸ¥è©¢ï¼Œ<br>å­å±¤åˆå§‹åŒ–æ™‚ï¼Œä¸ç”¨ç”±çˆ¶å±¤å‚³å€¼ä¸‹ä¾†å°±å¯é€²è¡Œä½¿ç”¨ï¼Œ<br>æœ‰æ™‚å€™ç”šè‡³ä¸­é–“å±¤æ˜¯ä¸éœ€è¦ modelï¼Œå¯ä»¥ç¯€çœä¸­é–“å±¤çš„å‚³éã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CakeView</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> model: <span class="type">CakeModel</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(spacing: <span class="number">12</span>) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            <span class="type">CakeButtonRow</span>(row: [.cocolate, .cheese, .strawberry]) <span class="comment">//&lt;---åˆå§‹åŒ–ä¸ç”¨è¨­å®šmodel</span></span><br><span class="line">                .padding(.bottom)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CakeButtonRow</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> model: <span class="type">CakeModel</span></span><br><span class="line">    <span class="keyword">let</span> row: [<span class="type">CakeItem</span>]</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">ForEach</span>(row, id: \.<span class="keyword">self</span>) &#123; item <span class="keyword">in</span></span><br><span class="line">                <span class="type">CakeButton</span>(</span><br><span class="line">                    title: item.title,</span><br><span class="line">                    backgroundColor: item.backgroundColor)</span><br><span class="line">                &#123;</span><br><span class="line">                    model.state <span class="operator">=</span> .didselect(item: item)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Button: <span class="subst">\(item.title)</span>&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æœ€ä¸Šå±¤ç‰©ä»¶æ™‚åŸæœ¬æ˜¯ä½¿ç”¨ init è¨­å®šåƒæ•¸ï¼Œä½†æ”¹æˆ .environmentObject çš„æ–¹å¼è¨­å®šã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CakeView</span>().environmentObject(<span class="type">CakeModel</span>())</span><br></pre></td></tr></table></figure><hr><h3 id="é¡Œå¤–è£œå……ï¼šProperty-Wrapper"><a href="#é¡Œå¤–è£œå……ï¼šProperty-Wrapper" class="headerlink" title="é¡Œå¤–è£œå……ï¼šProperty Wrapper"></a>é¡Œå¤–è£œå……ï¼šProperty Wrapper</h3><p>å¯ä»¥åˆ©ç”¨å±æ€§åŒ…è£… (Property Wrapper)ï¼Œå°ä»»ä½•å±¬æ€§é€²è¡Œ set å’Œ get çš„å°è£ï¼ </p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@propertyWrapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">State</span>&lt;<span class="title">Value</span>&gt;: <span class="title">DynamicViewProperty</span>, <span class="title">BindingConvertible</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">init</span>(<span class="params">initialValue</span> <span class="params">value</span>: <span class="type">Value</span>)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> value: <span class="type">Value</span> &#123; <span class="keyword">get</span> <span class="keyword">nonmutating</span> <span class="keyword">set</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> wrappedValue: <span class="type">Value</span> &#123; <span class="keyword">get</span> <span class="keyword">nonmutating</span> <span class="keyword">set</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> projectedValue: <span class="type">Binding</span>&lt;<span class="type">Value</span>&gt; &#123; <span class="keyword">get</span> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>initialValue: initæ–¹æ³•ï¼Œåªæœ‰ä¸€å€‹åƒæ•¸æ™‚ç›´æ¥çµ¦å€¼ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥æ›´å¤šåƒæ•¸</li><li>value: å¯¦éš›å­˜æ”¾çš„æ•¸å€¼</li><li>wrappedValue: å¯¦éš›ä¸Šå¤–éƒ¨é€²è¡Œè³¦å€¼å’Œå–å€¼æ™‚ï¼Œè§¸ç™¼çš„é‚è¼¯</li><li>projectedValue: ä½¿ç”¨ $ æ‰€å‚³éçš„æ•¸å€¼ï¼Œéµå®ˆ BindingConvertibleï¼Œå°±å¯ä»¥å‚³éåƒè€ƒå¼•ç”¨</li></ul><hr><h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><ul><li><a href="https://github.com/pinkpika/CakeProject">CakeProject</a></li></ul><hr><h1 id="åƒè€ƒæ›¸ç±"><a href="#åƒè€ƒæ›¸ç±" class="headerlink" title="åƒè€ƒæ›¸ç±"></a>åƒè€ƒæ›¸ç±</h1><ul><li><a href="https://objccn.io/products/swift-ui">SwiftUI ä¸ Combine ç¼–ç¨‹ - ç‹å·</a> - å‰ä¸‰ç« </li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note default flat&quot;&gt;&lt;p&gt;å¾ 2019 å¹´çš„ WWDC ç™¼å¸ƒ SwiftUI å’Œ Combine è‡³ä»Šéè¨±ä¹…ï¼Œä½†é²é²æ²’æœ‰é–‹å§‹å­¸ç¿’å’Œæ‡‰ç”¨ï¼Œæœ€è¿‘æƒ³é–‹å§‹æ…¢æ…¢æ¥è§¸å®ƒï¼Œé€™åªæ˜¯ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæœªä¾†æœƒå†æŒçºŒè¨˜éŒ„ä¸‹å»ã€‚&lt;/p&gt;
&lt;/div&gt;

&lt;h1 id=</summary>
      
    
    
    
    <category term="iOS Development" scheme="http://pinkpika.github.io/pinkblog/categories/iOS-Development/"/>
    
    
    <category term="iOS" scheme="http://pinkpika.github.io/pinkblog/tags/iOS/"/>
    
    <category term="SwiftUI" scheme="http://pinkpika.github.io/pinkblog/tags/SwiftUI/"/>
    
    <category term="Combine" scheme="http://pinkpika.github.io/pinkblog/tags/Combine/"/>
    
  </entry>
  
  <entry>
    <title>iOS Web API è¨­è¨ˆ (Web API Design in iOS)</title>
    <link href="http://pinkpika.github.io/pinkblog/2022/02/17/iOS-Web-API-%E8%A8%AD%E8%A8%88-Web-API-Design-in-iOS/"/>
    <id>http://pinkpika.github.io/pinkblog/2022/02/17/iOS-Web-API-%E8%A8%AD%E8%A8%88-Web-API-Design-in-iOS/</id>
    <published>2022-02-17T03:05:18.000Z</published>
    <updated>2022-03-15T15:27:16.278Z</updated>
    
    <content type="html"><![CDATA[<div class="note default flat"><p>API æŒ‡çš„æ˜¯æ‡‰ç”¨ç¨‹å¼ä¹‹é–“æºé€šçš„ä»‹é¢ï¼Œè€Œæœ¬ç¯‡ä¸»é¡Œå…¶å¯¦æ˜¯å‰ç«¯å‘¼å«å¾Œç«¯ Web API çš„è¨­è¨ˆï¼Œå‰ç«¯ä½¿ç”¨ Web API å¯ä»¥æ‹¿åˆ°é ç«¯çš„è³‡æ–™ï¼Œä¹Ÿå¯ä¾ç…§ä¸åŒç”¨æˆ¶æä¾›ä»–å€‘ä¸åŒçš„å…§å®¹ï¼Œå› æ­¤å¦‚ä½•è¨­è¨ˆå‰ç«¯ Web API å±¤çš„é‚è¼¯è®Šå¾—å¾ˆé‡è¦ï¼Œéœ€è¦å…¼å…·å…±ç”¨æ€§å’Œæ“´å……æ€§ã€‚</p></div><div class="note warning flat"><p>æœ¬ç¯‡æ‰€æåŠçš„ Web API è¨­è¨ˆç‰ˆæœ¬ï¼Œå…¶å¯¦æ˜¯ç”¨ä¾† <strong>ç´€éŒ„è‡ªå·±æ›¾ç¶“ä½¿ç”¨éçš„è¨­è¨ˆæ–¹å¼</strong>ï¼Œæœªä¾†ä¹Ÿå¯èƒ½æœƒå†å¢åŠ ï¼Œæ‰€ä»¥å…§å®¹æœ‰å¤§é‡è‡ªèº«ä½¿ç”¨éçš„æ„Ÿæƒ³ï¼Œ<strong>ä¸ä»£è¡¨çµ•å°çš„å¥½å£ï¼Œä¾ç…§å°ˆæ¡ˆéœ€æ±‚æˆ–æ¶æ§‹æœƒæœ‰æ›´é©åˆçš„è¨­è¨ˆæ–¹å¼</strong>ã€‚</p></div><h1 id="Web-API-è¨­è¨ˆçš„é‚è¼¯"><a href="#Web-API-è¨­è¨ˆçš„é‚è¼¯" class="headerlink" title="Web API è¨­è¨ˆçš„é‚è¼¯"></a>Web API è¨­è¨ˆçš„é‚è¼¯</h1><p>åœ¨å¯¦ä½œ Web API å±¤çš„é‚è¼¯å‰ï¼Œå¯ä»¥æŠŠå®ƒåˆ†æˆä¸‰æ®µæµç¨‹</p><img src="/pinkblog/2022/02/17/iOS-Web-API-%E8%A8%AD%E8%A8%88-Web-API-Design-in-iOS/0.png" class="" width="300"><h2 id="ğŸ”µ-Part1-çµ„åˆ-Request-æµç¨‹"><a href="#ğŸ”µ-Part1-çµ„åˆ-Request-æµç¨‹" class="headerlink" title="ğŸ”µ Part1 çµ„åˆ Request æµç¨‹"></a>ğŸ”µ Part1 çµ„åˆ Request æµç¨‹</h2><ul><li>å¦‚ä½•çµ„æˆ Request ?<ul><li>ç™¼é€å‰éœ€è¦è¨­å®šå¥½å„é …åƒæ•¸ï¼Œå¯èƒ½åŒ…å«æœ‰ä¸‹åˆ—é …ç›®</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/URL_API">URL</a>: è«‹æ±‚çš„ç¶²å€ï¼ŒåŒ…å« schemeã€hostã€ portã€pathã€query â€¦ ç­‰ç­‰<ul><li>ex. <code>https://www.ios.com/api/user?id=9999&amp;type=1</code></li></ul></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods">HTTP method</a>: è«‹æ±‚çš„æ–¹æ³•ï¼Œé€šå¸¸èƒ½åæ‡‰å‡ºæ­¤ API çš„ç›®çš„<ul><li>ex. getã€postã€putã€patchã€delete â€¦.</li></ul></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers">HTTP header</a>: è«‹æ±‚çš„é™„åŠ è³‡æ–™ï¼Œæœ‰å¾ˆå¤šç¨®å·²ç¶“å®šå¥½çš„è¦ç¯„ã€ä¹Ÿå¯ä»¥è‡ªè¨‚è³‡æ–™<ul><li>ex. Content-Type: application/x-www-form-urlencoded</li><li>ex. Content-Type: application/json</li><li>ex. Authorization: Bearer â€¦. =&gt; èº«ä»½é©—è­‰ç”¨</li><li>ex. Accept-Language: zh-TW =&gt; æŒ‡å®šèªè¨€ç”¨</li><li>ex. Tracing: â€¦. =&gt; å®¢è£½åŒ–è¿½è¹¤</li></ul></li><li>Body: ä¾ç…§ä¸åŒçš„ Content-Type æœƒå¡ä¸åŒçš„ Body<ul><li>ex. â€œaction=getmemberdata&amp;id=111â€.data(using: .utf8)</li><li>ex. â€œ{&quot;action&quot;: &quot;getlatestposts&quot;,&quot;fetchcount&quot;: 20 }â€.data(using: .utf8)</li></ul></li></ul></li></ul><h2 id="ğŸ”´-Part2-ç™¼é€-API-æµç¨‹"><a href="#ğŸ”´-Part2-ç™¼é€-API-æµç¨‹" class="headerlink" title="ğŸ”´ Part2 ç™¼é€ API æµç¨‹"></a>ğŸ”´ Part2 ç™¼é€ API æµç¨‹</h2><ul><li>ä½¿ç”¨ä»€éº¼ç™¼é€ API ?<ul><li>é€šå¸¸ä½¿ç”¨ <a href="https://developer.apple.com/documentation/foundation/urlsession">URLSession</a> æˆ–æ˜¯ä½¿ç”¨ <a href="https://github.com/Alamofire/Alamofire">Alamofire</a></li><li>é¸æ“‡ç™¼é€ Task é¡å‹ï¼Œä¸€èˆ¬ API å¿«é€Ÿäº¤æ¡è«‹æ±‚æœƒä½¿ç”¨ dataTaskï¼Œæ­¤å¤– uploadTaskã€downloadTask æ˜¯ç”¨æ–¼é•·æ™‚é–“ä¸Šå‚³æˆ–ä¸‹è¼‰ä¸”å¯åœ¨èƒŒæ™¯åŸ·è¡Œã€‚</li></ul></li><li>å¦‚ä½•è¨­å®šç¶²è·¯ Config ?<ul><li>æ€éº¼è™•ç†ç¶²è·¯å±¤çš„é‚è¼¯å°åŒ…ã€ç¶²è·¯äº¤æ¡éƒ½è¢«åº•å±¤å°è£äº†ï¼Œåªèƒ½è¨­å®šä¸€äº›é€šç”¨å±¬æ€§ã€Cookieã€Cache ç­‰ç­‰ï¼Œå¯åƒè€ƒ <a href="https://developer.apple.com/documentation/foundation/urlsessionconfiguration">URLSessionConfiguration</a></li><li>å€¼å¾—æ³¨æ„çš„æ˜¯ URLSession å°ç›¸åŒ host ä¸¦ç™¼ Request æ˜¯æœ‰ä¸Šé™çš„ï¼Œå¦‚æœæœ‰ç‰¹æ®Šéœ€æ±‚éœ€è¦èª¿æ•´ï¼Œå¯åƒè€ƒ <a href="https://developer.apple.com/documentation/foundation/urlsessionconfiguration/1407597-httpmaximumconnectionsperhost">httpMaximumConnectionsPerHost</a></li><li>å–å¾— task é€²åº¦ï¼Œéœ€è¦å¯¦ä½œ <a href="https://developer.apple.com/documentation/foundation/urlsessiontaskdelegate">URLSessionTaskDelegate</a></li><li>å–å¾—ç‹€æ…‹ task.state </li><li>å¼·åˆ¶å–æ¶ˆ task.cancel (polling/long-pollingå¯èƒ½æœƒç”¨åˆ°)</li></ul></li><li>å¦‚ä½•æ¥æ”¶å›æ‡‰ ?<ul><li>ä¸€ç¨®æ˜¯ä½¿ç”¨ callback closure çš„æ–¹å¼è§¸ç™¼</li><li>å¦ä¸€ç¨®å°±æ˜¯ Swift 5.5 URLSession é–‹å§‹æ”¯æ´ async await çš„æ–¹å¼ï¼Œå¯«èµ·ä¾†æ›´ç›´è§€æ›´æ–¹ä¾¿</li></ul></li><li>è¨˜å¾—è¦æ³¨æ„ API å›ä¾†çš„ thread æ˜¯åœ¨å“ªè£¡ ?<ul><li>URLSession çš„ dataTask callback é è¨­æ˜¯ background thread</li><li>URLSession çš„ async await æ˜¯å›ç™¼é€å‰çš„ thread</li><li>Alamofire callback é è¨­æ˜¯ main thread</li></ul></li></ul><h2 id="ğŸŸ¢-Part3-è™•ç†-Response-æµç¨‹"><a href="#ğŸŸ¢-Part3-è™•ç†-Response-æµç¨‹" class="headerlink" title="ğŸŸ¢ Part3 è™•ç† Response æµç¨‹"></a>ğŸŸ¢ Part3 è™•ç† Response æµç¨‹</h2><ul><li>æ”¶åˆ°å›æ‡‰è©²å¦‚ä½•è™•ç† ?<ul><li>URLSession å›æ‡‰é€šå¸¸æœƒæ”¶åˆ°ä¸‰å€‹ç‰©ä»¶ Dataã€URLResponseã€Error çš†ç‚º optional<ul><li><code>dataTask(with request: URLRequest, completionHandler: @escaping (Data?, URLResponse?, Error?) -&gt; Void)</code></li></ul></li><li>é€šå¸¸å…ˆè™•ç† <strong>Error</strong>ï¼Œå¦‚æœæœ‰å€¼å°±æ˜¯ç¶²è·¯å±¤å°±é‡åˆ°å•é¡Œ</li><li>å…¶æ¬¡å¯ä»¥åˆ¤æ–· <strong>URLResponse å…§çš„ statusCode</strong>ï¼Œå¦‚æœç¬¦åˆè¦ç¯„çš„ API è¨­è¨ˆå¯ä»¥å¾ <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">HTTP statusCode</a> åˆ¤æ–·ç‹€æ…‹<ul><li><code>(response as? HTTPURLResponse)?.statusCode</code></li><li>2XX æˆåŠŸå›æ‡‰ </li><li>3XX é‡æ–°è½‰å‘çš„å›æ‡‰</li><li>4XX ç”¨æˆ¶ç«¯çš„éŒ¯èª¤ =&gt; 400 ç„¡æ•ˆè«‹æ±‚ã€401 æˆæ¬Šå¤±æ•— â€¦ </li><li>5XX ä¼ºæœå™¨ç«¯éŒ¯èª¤ =&gt; 500 ä¼ºæœå™¨ç«¯å…§éƒ¨æœªçŸ¥éŒ¯èª¤ â€¦</li></ul></li><li>æœ€å¾Œè¦å°‡ <strong>Data</strong> è½‰æ›æˆé æœŸçš„ç‰©ä»¶ï¼Œæœ‰å¯èƒ½æ˜¯å¾Œå°å®šç¾©å¥½çš„å›æ‡‰ç‰©ä»¶æˆ–æ˜¯éŒ¯èª¤ç‰©ä»¶</li></ul></li><li>å¦‚æœç™¼ç”ŸéŒ¯èª¤ï¼Œæ˜¯å¦éœ€è¦é‡è©¦ ?</li><li>å¦‚æœç™¼ç”Ÿç”¨æˆ¶æ²’æœ‰ç¶²è·¯ï¼Œå¦‚ä½•é€šçŸ¥ç”¨æˆ¶ ?</li><li>å¦‚æœç™¼ç”Ÿæˆæ¬Šå¤±æ•—æˆ–éæœŸï¼Œæ˜¯å¦éœ€è¦è‡ªå‹•é‡åˆ· token æˆ–æ˜¯é€šçŸ¥ç•«é¢ ?</li></ul><p>ä¸Šé¢ä¸‰å€‹éƒ¨åˆ†ä¹Ÿå¯èƒ½æœƒåŠ å…¥ Debug Log æˆ–æ˜¯äº‹ä»¶è¿½è¹¤ï¼Œç•¶é é¢çš„ä¸åŒã€ç”¨æˆ¶æ“ä½œçš„ä¸åŒã€ç«™å°çš„ä¸åŒä¹Ÿæœƒé€²è¡Œä¸åŒçš„è¨­å®šã€‚<br>ä¸‹é¢ä¾†è©¦è©¦çœ‹é€²è¡Œ Web API çš„é‚è¼¯å°è£å’Œé‡è¤‡åˆ©ç”¨ï¼Œæ¯å€‹ç‰ˆæœ¬éƒ½æœƒç¤ºç¯„ Getã€Post+UrlEncodedã€Post+Jsonï¼Œå¦‚æœéœ€è¦å…¶ä»– method å¯ä»¥è‡ªè¡Œæ–°å¢ã€‚</p><hr><h1 id="Version1-ï¼šä½¿ç”¨ç‰©ä»¶å’Œæ–¹æ³•å°è£"><a href="#Version1-ï¼šä½¿ç”¨ç‰©ä»¶å’Œæ–¹æ³•å°è£" class="headerlink" title="[Version1]ï¼šä½¿ç”¨ç‰©ä»¶å’Œæ–¹æ³•å°è£"></a>[Version1]ï¼šä½¿ç”¨ç‰©ä»¶å’Œæ–¹æ³•å°è£</h1><img src="/pinkblog/2022/02/17/iOS-Web-API-%E8%A8%AD%E8%A8%88-Web-API-Design-in-iOS/1.png" class="" width="600"><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><ul><li>ä½¿ç”¨å–®ä¸€æˆ–å¤šå€‹ Manager å°è£å‘¼å« API çš„æ–¹æ³•å’Œè™•ç†æ–¹å¼ï¼Œä¹Ÿæ˜¯å¯¦ä½œé›£åº¦æœ€ä½çš„</li><li>è‡³å°‘èƒ½ç¢ºä¿å‘¼å« API é‚è¼¯æˆ–ä¸‰æ–¹ä¾è³´éƒ½å¯ä»¥é–åœ¨ Manager å…§éƒ¨</li><li>æ¯ä¸€é“æ–¹æ³•éƒ½æ˜¯å‘¼å«ä¸€é“ API è‡ªè¡Œå¯¦ä½œ Part1ã€Part2ã€Part3ï¼Œç¢ºä¿è·è²¬çš„å–®ä¸€æ€§ï¼Œç†è«–ä¸Šäº’ç›¸ä¸å¹²æ“¾<ul><li>ex. <code>requestHttpBinGet</code>ã€<code>requestHttpBinPostUrlEncoded</code>ã€<code>requestHttpBinPostJson</code></li></ul></li><li>å°è£å…±ç”¨çš„é‚è¼¯ï¼Œåƒæ˜¯è§£æå›æ‡‰ç‰©ä»¶ã€çµ„è£ Header ç­‰ç­‰<ul><li>ex. <code>handleResponse</code>ã€<code>addHeaderContentTypeJson</code>ã€<code>addHeaderContentTypeURLEncoded</code></li></ul></li></ul><h2 id="å¯¦ä½œç¯„ä¾‹"><a href="#å¯¦ä½œç¯„ä¾‹" class="headerlink" title="å¯¦ä½œç¯„ä¾‹"></a>å¯¦ä½œç¯„ä¾‹</h2><div class="tabs" id="version1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#version1-1">APIManager</button></li><li class="tab"><button type="button" data-href="#version1-2">APIManager+HttpBinGet</button></li><li class="tab"><button type="button" data-href="#version1-3">APIManager+HttpBinPostUrlEncoded</button></li><li class="tab"><button type="button" data-href="#version1-4">APIManager+HttpBinPostJson</button></li><li class="tab"><button type="button" data-href="#version1-5">URLRequest+AddHeader</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="version1-1"><figure class="highlight swift"><figcaption><span>APIManager.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// API ç®¡ç†è€…</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">APIManager</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">APIManager</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">init</span>()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// è™•ç†å›æ‡‰</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">handleResponse</span>&lt;<span class="type">T</span>: <span class="type">Decodable</span>&gt;(<span class="params">data</span>: <span class="type">Data</span>?, <span class="params">response</span>: <span class="type">URLResponse</span>?, <span class="params">error</span>: <span class="type">Error</span>?, <span class="params">completion</span>: <span class="keyword">@escaping</span> ((<span class="type">Result</span>&lt;<span class="type">T</span>,<span class="type">APIManagerError</span>&gt;) -&gt; <span class="type">Void</span>))</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> error <span class="operator">=</span> error&#123;</span><br><span class="line">            completion(.failure(.requestError(error: error)))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> statusCode <span class="operator">=</span> (response <span class="keyword">as?</span> <span class="type">HTTPURLResponse</span>)<span class="operator">?</span>.statusCode&#123;</span><br><span class="line">            <span class="built_in">print</span>(statusCode)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> data <span class="operator">=</span> data <span class="keyword">else</span> &#123;</span><br><span class="line">            completion(.failure(.nilData))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> response <span class="operator">=</span> <span class="keyword">try?</span> <span class="type">JSONDecoder</span>().decode(<span class="type">T</span>.<span class="keyword">self</span>, from: data) <span class="keyword">else</span> &#123;</span><br><span class="line">            completion(.failure(.decodeError))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        completion(.success(response))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - éŒ¯èª¤ç‰©ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">APIManager</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// éŒ¯èª¤ç‰©ä»¶</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">APIManagerError</span>: <span class="title">Error</span></span>&#123;</span><br><span class="line">        <span class="keyword">case</span> requestError(error: <span class="type">Error</span>)</span><br><span class="line">        <span class="keyword">case</span> nilData</span><br><span class="line">        <span class="keyword">case</span> decodeError</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version1-2"><figure class="highlight swift"><figcaption><span>APIManager+HttpBinGet.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">APIManager</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">HttpBinGetResponse</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Args</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">            <span class="keyword">let</span> value: <span class="type">String</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> args: <span class="type">Args</span></span><br><span class="line">        <span class="keyword">let</span> origin: <span class="type">String</span></span><br><span class="line">        <span class="keyword">let</span> url: <span class="type">String</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requestHttpBinGet</span>(<span class="params">value</span>: <span class="type">String</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> ((<span class="type">Result</span>&lt;<span class="type">HttpBinGetResponse</span>,<span class="type">APIManagerError</span>&gt;) -&gt; <span class="type">Void</span>))</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Part1 çµ„åˆ Requestï¼Œä½¿ç”¨æ–¹æ³•æˆ–æ“´å……å°è£é¡ä¼¼çš„é‚è¼¯</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://httpbin.org/get?value=<span class="subst">\(value)</span>&quot;</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="keyword">var</span> request <span class="operator">=</span> <span class="type">URLRequest</span>(url: url)</span><br><span class="line">        request.method <span class="operator">=</span> .get</span><br><span class="line">        request.addHeaderAuthToken()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Part2 ç™¼å‹• APIï¼Œå¦‚æœæœ‰éœ€æ±‚ä¹Ÿå¯æŠ½æ›</span></span><br><span class="line">        <span class="keyword">let</span> dataTask <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTask(with: request) &#123;</span><br><span class="line">            data, response, error <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Part3 è™•ç† Responseï¼Œä½¿ç”¨æ–¹æ³•æˆ–æ“´å……å°è£é¡ä¼¼çš„é‚è¼¯</span></span><br><span class="line">            <span class="keyword">self</span>.handleResponse(data: data, response: response, error: error, completion: completion)</span><br><span class="line">        &#125;</span><br><span class="line">        dataTask.resume()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version1-3"><figure class="highlight swift"><figcaption><span>APIManager+HttpBinPostUrlEncoded.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">APIManager</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">HttpBinPostUrlEncodedResponse</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Form</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">            <span class="keyword">let</span> value: <span class="type">String</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> form: <span class="type">Form</span></span><br><span class="line">        <span class="keyword">let</span> origin: <span class="type">String</span></span><br><span class="line">        <span class="keyword">let</span> url: <span class="type">String</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requestHttpBinPostUrlEncoded</span>(<span class="params">value</span>: <span class="type">String</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> ((<span class="type">Result</span>&lt;<span class="type">HttpBinPostUrlEncodedResponse</span>,<span class="type">APIManagerError</span>&gt;) -&gt; <span class="type">Void</span>))</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Part1 çµ„åˆ Requestï¼Œä½¿ç”¨æ–¹æ³•æˆ–æ“´å……å°è£é¡ä¼¼çš„é‚è¼¯</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://httpbin.org/post&quot;</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="keyword">var</span> request <span class="operator">=</span> <span class="type">URLRequest</span>(url: url)</span><br><span class="line">        request.method <span class="operator">=</span> .post</span><br><span class="line">        request.addHeaderAuthToken()</span><br><span class="line">        request.addHeaderContentTypeURLEncoded()</span><br><span class="line">        request.httpBody <span class="operator">=</span> <span class="string">&quot;value=<span class="subst">\(value)</span>&quot;</span>.data(using: .utf8)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Part2 ç™¼å‹• APIï¼Œå¦‚æœæœ‰éœ€æ±‚ä¹Ÿå¯æŠ½æ›</span></span><br><span class="line">        <span class="keyword">let</span> dataTask <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTask(with: request) &#123;</span><br><span class="line">            data, response, error <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Part3 è™•ç† Responseï¼Œä½¿ç”¨æ–¹æ³•æˆ–æ“´å……å°è£é¡ä¼¼çš„é‚è¼¯</span></span><br><span class="line">            <span class="keyword">self</span>.handleResponse(data: data, response: response, error: error, completion: completion)</span><br><span class="line">        &#125;</span><br><span class="line">        dataTask.resume()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version1-4"><figure class="highlight swift"><figcaption><span>APIManager+HttpBinPostJson.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">APIManager</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">HttpBinPostJsonResponse</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">JsonData</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">            <span class="keyword">let</span> value: <span class="type">String</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> json: <span class="type">JsonData</span></span><br><span class="line">        <span class="keyword">let</span> origin: <span class="type">String</span></span><br><span class="line">        <span class="keyword">let</span> url: <span class="type">String</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">requestHttpBinPostJson</span>(<span class="params">value</span>: <span class="type">String</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> ((<span class="type">Result</span>&lt;<span class="type">HttpBinPostJsonResponse</span>,<span class="type">APIManagerError</span>&gt;) -&gt; <span class="type">Void</span>))</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Part1 çµ„åˆ Requestï¼Œä½¿ç”¨æ–¹æ³•æˆ–æ“´å……å°è£é¡ä¼¼çš„é‚è¼¯</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://httpbin.org/post&quot;</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="keyword">var</span> request <span class="operator">=</span> <span class="type">URLRequest</span>(url: url)</span><br><span class="line">        request.method <span class="operator">=</span> .post</span><br><span class="line">        request.addHeaderAuthToken()</span><br><span class="line">        request.addHeaderContentTypeJson()</span><br><span class="line">        request.httpBody <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            &quot;value&quot;: &quot;<span class="subst">\(value)</span>&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>.data(using: .utf8)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Part2 ç™¼å‹• APIï¼Œå¦‚æœæœ‰éœ€æ±‚ä¹Ÿå¯æŠ½æ›</span></span><br><span class="line">        <span class="keyword">let</span> dataTask <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTask(with: request) &#123;</span><br><span class="line">            data, response, error <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Part3 è™•ç† Responseï¼Œä½¿ç”¨æ–¹æ³•æˆ–æ“´å……å°è£é¡ä¼¼çš„é‚è¼¯</span></span><br><span class="line">            <span class="keyword">self</span>.handleResponse(data: data, response: response, error: error, completion: completion)</span><br><span class="line">        &#125;</span><br><span class="line">        dataTask.resume()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version1-5"><figure class="highlight swift"><figcaption><span>URLRequest+AddHeader.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">URLRequest</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@discardableResult</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">addHeaderAuthToken</span>()</span> -&gt; <span class="type">URLRequest</span>&#123;</span><br><span class="line">        <span class="keyword">self</span>.addValue(<span class="string">&quot;Bearer ......&quot;</span>, forHTTPHeaderField: <span class="string">&quot;Authorization&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@discardableResult</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">addHeaderContentTypeJson</span>()</span> -&gt; <span class="type">URLRequest</span>&#123;</span><br><span class="line">        <span class="keyword">self</span>.addValue(<span class="string">&quot;application/json&quot;</span>, forHTTPHeaderField: <span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@discardableResult</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">addHeaderContentTypeURLEncoded</span>()</span> -&gt; <span class="type">URLRequest</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.addValue(<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, forHTTPHeaderField: <span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">APIManager</span>.shared.requestHttpBinGet(value: <span class="string">&quot;xxxx1&quot;</span>) &#123;</span><br><span class="line">    result <span class="keyword">in</span> <span class="built_in">print</span>(result)</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">APIManager</span>.shared.requestHttpBinPostUrlEncoded(value: <span class="string">&quot;xxxx2&quot;</span>) &#123;</span><br><span class="line">    result <span class="keyword">in</span> <span class="built_in">print</span>(result)</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">APIManager</span>.shared.requestHttpBinPostJson(value: <span class="string">&quot;xxxx3&quot;</span>) &#123;</span><br><span class="line">    result <span class="keyword">in</span> <span class="built_in">print</span>(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><ul><li><a href="https://github.com/pinkpika/APIRequestDesignDemo/tree/main/TestApp/APIRequestDesignVersion1">APIRequestDesignDemo - Version1</a></li></ul><hr><div class="note info flat"><p>ğŸ¤”ã€ å•é¡Œ ã€‘<br>å¯¦ä½œæ¯é“ API æ™‚éƒ½éœ€è¦è‡ªè¡Œå‘¼å« Part1ã€Part2ã€Part3 ä¸å¤ æ–¹ä¾¿ï¼Œå¾ˆå¤šæ™‚å€™éƒ½æ˜¯ç›¸åŒæµç¨‹å»è¦é‡è¤‡å¯«ï¼Œå¸Œæœ›æœ‰é è¨­çš„æµç¨‹ï¼Œåªéœ€è¦å®šç¾©è«‹æ±‚çš„æ¬„ä½å’Œå›æ‡‰çš„ç‰©ä»¶å°±å¥½ã€‚</p></div><hr><h1 id="Version2-ï¼šä½¿ç”¨ç¹¼æ‰¿å’Œåå°„æ¬„ä½"><a href="#Version2-ï¼šä½¿ç”¨ç¹¼æ‰¿å’Œåå°„æ¬„ä½" class="headerlink" title="[Version2]ï¼šä½¿ç”¨ç¹¼æ‰¿å’Œåå°„æ¬„ä½"></a>[Version2]ï¼šä½¿ç”¨ç¹¼æ‰¿å’Œåå°„æ¬„ä½</h1><img src="/pinkblog/2022/02/17/iOS-Web-API-%E8%A8%AD%E8%A8%88-Web-API-Design-in-iOS/2.png" class="" width="800"><h2 id="ç‰¹æ€§-1"><a href="#ç‰¹æ€§-1" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><ul><li>ä½¿ç”¨ NetworkManager å°è£å„ç¨®é¡å‹çš„è«‹æ±‚æ–¹å¼</li><li>ä½¿ç”¨çˆ¶é¡åˆ¥ ( BaseRequest ) å’Œå­é¡åˆ¥ç¹¼æ‰¿çš„ç‰¹æ€§<ul><li>å®šç¾©è«‹æ±‚é€šç”¨çš„æ¬„ä½ ex. Domain, Path, Method â€¦. ç­‰ç­‰ï¼Œå­é¡åˆ¥å¯ä»¥è‡ªè¡Œä¿®æ”¹</li><li>å®šç¾© send æ–¹æ³•å¯¦ä½œ Part1ã€Part2ã€Part3ï¼Œä¸¦å‘¼å« NetworkManagerï¼Œå­é¡åˆ¥å¯ä»¥ç›´æ¥å‘¼å«</li></ul></li><li>ä½¿ç”¨â€åå°„æ¬„ä½â€ä¾†çµ„åˆåƒæ•¸<ul><li>ex. get query, post body â€¦. ç­‰ç­‰</li></ul></li></ul><h2 id="å¯¦ä½œç¯„ä¾‹-1"><a href="#å¯¦ä½œç¯„ä¾‹-1" class="headerlink" title="å¯¦ä½œç¯„ä¾‹"></a>å¯¦ä½œç¯„ä¾‹</h2><div class="tabs" id="version2"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#version2-1">NetworkManager</button></li><li class="tab"><button type="button" data-href="#version2-2">BaseRequest</button></li><li class="tab"><button type="button" data-href="#version2-3">HttpBinBase</button></li><li class="tab"><button type="button" data-href="#version2-4">HttpBinGet</button></li><li class="tab"><button type="button" data-href="#version2-5">HttpBinPostUrlEncoded</button></li><li class="tab"><button type="button" data-href="#version2-6">HttpBinPostJson</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="version2-1"><p><a href="https://github.com/pinkpika/APIRequestDesignDemo/blob/main/TestApp/APIRequestDesignVersion2/NetworkManager.swift">å®Œæ•´ç‰ˆ NetworkManager.swift</a></p><figure class="highlight swift"><figcaption><span>NetworkManager.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Network ç®¡ç†è€…</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetworkManager</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">NetworkManager</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">init</span>()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// è½‰æ›åƒæ•¸</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">convertParameters</span>(<span class="params">parameters</span>: [<span class="params">String</span>: <span class="keyword">Any</span>])</span> -&gt; [<span class="type">String</span>: <span class="type">String</span>] &#123;</span><br><span class="line">        <span class="keyword">var</span> temp: [<span class="type">String</span>: <span class="type">String</span>] <span class="operator">=</span> [:]</span><br><span class="line">        <span class="keyword">for</span> one <span class="keyword">in</span> parameters&#123;</span><br><span class="line">            <span class="keyword">switch</span> one.value &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">String</span>, <span class="keyword">is</span> <span class="type">Int</span>, <span class="keyword">is</span> <span class="type">Double</span>, <span class="keyword">is</span> <span class="type">CustomStringConvertible</span>:</span><br><span class="line">                temp[one.key] <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(one.value)</span>&quot;</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> temp</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// è™•ç†å›æ‡‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">handleResponse</span>&lt;<span class="type">T</span>: <span class="type">Decodable</span>&gt;(<span class="params">data</span>: <span class="type">Data</span>?, <span class="params">response</span>: <span class="type">URLResponse</span>?, <span class="params">error</span>: <span class="type">Error</span>?, <span class="params">completion</span>: <span class="keyword">@escaping</span> ((<span class="type">Result</span>&lt;<span class="type">T</span>,<span class="type">NetworkManagerError</span>&gt;) -&gt; <span class="type">Void</span>))</span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - éŒ¯èª¤ç‰©ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NetworkManager</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// éŒ¯èª¤ç‰©ä»¶</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">NetworkManagerError</span>: <span class="title">Error</span></span>&#123;</span><br><span class="line">        <span class="keyword">case</span> requestError(error: <span class="type">Error</span>)</span><br><span class="line">        <span class="keyword">case</span> nilData</span><br><span class="line">        <span class="keyword">case</span> decodeError</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - Get ç›¸é—œè«‹æ±‚</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NetworkManager</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// ç™¼é€ Get è«‹æ±‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sendGetRequest</span>&lt;<span class="type">T</span>: <span class="type">Decodable</span>&gt;(<span class="operator">...</span>)</span> -&gt; <span class="type">URLSessionDataTask</span>?&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - Post ç›¸é—œè«‹æ±‚</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NetworkManager</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// ç™¼é€ Post UrlEncoded è«‹æ±‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sendPostUrlEncodedRequest</span>&lt;<span class="type">T</span>: <span class="type">Decodable</span>&gt;(<span class="operator">...</span>)</span> -&gt; <span class="type">URLSessionDataTask</span>?&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// ç™¼é€ Post JSON è«‹æ±‚</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sendPostJSONRequest</span>&lt;<span class="type">T</span>: <span class="type">Decodable</span>&gt;(<span class="operator">...</span>)</span> -&gt; <span class="type">Void</span>)) -&gt; <span class="type">URLSessionDataTask</span>?&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version2-2"><figure class="highlight swift"><figcaption><span>BaseRequest.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseRequest</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// Domain</span></span><br><span class="line">    <span class="keyword">var</span> domain: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// Path</span></span><br><span class="line">    <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// è«‹æ±‚æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">var</span> method: <span class="type">HttpMethod</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .get</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// å…§å®¹æ ¼å¼</span></span><br><span class="line">    <span class="keyword">var</span> contentType: <span class="type">ContentType</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .none</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// Timeout</span></span><br><span class="line">    <span class="keyword">var</span> timeoutInterval: <span class="type">TimeInterval</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">60</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// ç™¼é€è«‹æ±‚</span></span><br><span class="line">    <span class="keyword">@discardableResult</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">send</span>&lt;<span class="type">T</span>: <span class="type">Decodable</span>&gt;(<span class="params">completion</span>: <span class="keyword">@escaping</span> ((<span class="type">Result</span>&lt;<span class="type">T</span>,<span class="type">NetworkManager</span>.<span class="type">NetworkManagerError</span>&gt;) -&gt; <span class="type">Void</span>))</span> -&gt; <span class="type">URLSessionDataTask</span>? &#123;</span><br><span class="line">        <span class="keyword">let</span> urlString <span class="operator">=</span> domain <span class="operator">+</span> path</span><br><span class="line">        <span class="keyword">switch</span> method &#123;</span><br><span class="line">        <span class="keyword">case</span> .get:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">NetworkManager</span>.shared.sendGetRequest(urlString: urlString, queryItems: getParameters(), timeoutInterval: timeoutInterval, completion: completion)</span><br><span class="line">        <span class="keyword">case</span> .post <span class="keyword">where</span> contentType <span class="operator">==</span> .urlencoded:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">NetworkManager</span>.shared.sendPostUrlEncodedRequest(urlString: urlString, urlEncodedParas: getParameters(), timeoutInterval: timeoutInterval, completion: completion)</span><br><span class="line">        <span class="keyword">case</span> .post <span class="keyword">where</span> contentType <span class="operator">==</span> .json:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">NetworkManager</span>.shared.sendPostJSONRequest(urlString: urlString, parameters: getParameters(), timeoutInterval: timeoutInterval, completion: completion)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// å–å¾—åƒæ•¸</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">getParameters</span>()</span> -&gt; [<span class="type">String</span>: <span class="keyword">Any</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> getParameters(mirror: <span class="type">Mirror</span>(reflecting: <span class="keyword">self</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å–å¾—åƒæ•¸(ä½¿ç”¨Mirroræ‰€æœ‰çˆ¶é¡åˆ¥çš„åƒæ•¸ï¼Œä¸¦è½‰æ›ç‚ºDictionary)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">getParameters</span>(<span class="params">mirror</span>: <span class="type">Mirror</span>)</span> -&gt; [<span class="type">String</span>: <span class="keyword">Any</span>] &#123;</span><br><span class="line">        <span class="keyword">var</span> parameters: [<span class="type">String</span>: <span class="keyword">Any</span>] <span class="operator">=</span> [:]</span><br><span class="line">        <span class="keyword">if</span> mirror.superclassMirror <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            parameters <span class="operator">=</span> parameters.merging(getParameters(mirror: mirror.superclassMirror<span class="operator">!</span> ))&#123; <span class="variable">$1</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> attr <span class="keyword">in</span> mirror.children &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> propertyName <span class="operator">=</span> attr.label &#123;</span><br><span class="line">                parameters[propertyName] <span class="operator">=</span> attr.value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> parameters</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">BaseRequest</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">ContentType</span></span>&#123;</span><br><span class="line">        <span class="keyword">case</span> none</span><br><span class="line">        <span class="keyword">case</span> urlencoded</span><br><span class="line">        <span class="keyword">case</span> json</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">HttpMethod</span></span>&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">get</span></span><br><span class="line">        <span class="keyword">case</span> post</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version2-3"><figure class="highlight swift"><figcaption><span>HttpBinBaseRequest.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpBinBaseRequest</span>: <span class="title">BaseRequest</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// Domain</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> domain: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;https://httpbin.org/&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version2-4"><figure class="highlight swift"><figcaption><span>HttpBinGetRequest+Response.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpBinGetRequest</span>: <span class="title">HttpBinBaseRequest</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;get&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setData</span>(<span class="params">value</span>: <span class="type">String</span>)</span> -&gt; <span class="keyword">Self</span>&#123;</span><br><span class="line">        <span class="keyword">self</span>.value <span class="operator">=</span> value</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HttpBinGetResponse</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Args</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">        <span class="keyword">let</span> value: <span class="type">String</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> args: <span class="type">Args</span></span><br><span class="line">    <span class="keyword">let</span> origin: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> url: <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version2-5"><figure class="highlight swift"><figcaption><span>HttpBinPostUrlEncodedRequest+Response.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpBinPostUrlEncodedRequest</span>: <span class="title">HttpBinBaseRequest</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;post&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> method: <span class="type">HttpMethod</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .post</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> contentType: <span class="type">ContentType</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .urlencoded</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;æˆ‘æ˜¯è³‡æ–™&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setData</span>(<span class="params">value</span>: <span class="type">String</span>)</span> -&gt; <span class="keyword">Self</span>&#123;</span><br><span class="line">        <span class="keyword">self</span>.value <span class="operator">=</span> value</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HttpBinPostJsonResponse</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">JsonData</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">        <span class="keyword">let</span> value: <span class="type">String</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> json: <span class="type">JsonData</span></span><br><span class="line">    <span class="keyword">let</span> origin: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> url: <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version2-6"><figure class="highlight swift"><figcaption><span>HttpBinPostJsonRequest+Response.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpBinPostUrlEncodedRequest</span>: <span class="title">HttpBinBaseRequest</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;post&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> method: <span class="type">HttpMethod</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .post</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> contentType: <span class="type">ContentType</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .urlencoded</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;æˆ‘æ˜¯è³‡æ–™&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setData</span>(<span class="params">value</span>: <span class="type">String</span>)</span> -&gt; <span class="keyword">Self</span>&#123;</span><br><span class="line">        <span class="keyword">self</span>.value <span class="operator">=</span> value</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HttpBinPostJsonResponse</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">JsonData</span>: <span class="title">Codable</span></span>&#123;</span><br><span class="line">        <span class="keyword">let</span> value: <span class="type">String</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> json: <span class="type">JsonData</span></span><br><span class="line">    <span class="keyword">let</span> origin: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> url: <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="ä½¿ç”¨æ–¹å¼-1"><a href="#ä½¿ç”¨æ–¹å¼-1" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpBinGetRequest</span>().setData(value: <span class="string">&quot;wwww1&quot;</span>).send &#123;</span><br><span class="line">    (result: <span class="type">Result</span>&lt;<span class="type">HttpBinGetResponse</span>,<span class="type">NetworkManager</span>.<span class="type">NetworkManagerError</span>&gt;) <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">HttpBinPostUrlEncodedRequest</span>().setData(value: <span class="string">&quot;wwww2&quot;</span>).send &#123;</span><br><span class="line">    (result: <span class="type">Result</span>&lt;<span class="type">HttpBinPostUrlEncodedResponse</span>,<span class="type">NetworkManager</span>.<span class="type">NetworkManagerError</span>&gt;) <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">HttpBinPostJsonRequest</span>().setData(value: <span class="string">&quot;wwww3&quot;</span>).send &#123;</span><br><span class="line">    (result: <span class="type">Result</span>&lt;<span class="type">HttpBinPostJsonResponse</span>,<span class="type">NetworkManager</span>.<span class="type">NetworkManagerError</span>&gt;) <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Demo-1"><a href="#Demo-1" class="headerlink" title="Demo"></a>Demo</h2><ul><li><a href="https://github.com/pinkpika/APIRequestDesignDemo/tree/main/TestApp/APIRequestDesignVersion2">APIRequestDesignDemo - Version2</a></li></ul><hr><div class="note info flat"><p>ğŸ¤”ã€ å•é¡Œ ã€‘<br>é›–ç„¶å»ºç«‹ API ç‰©ä»¶è®Šå¾—éå¸¸å¿«é€Ÿçœ‹ä¼¼ç¾å¥½ï¼Œä½†é¢å°å„ç¨®ä¸åŒç«™å°çš„éœ€æ±‚ï¼Œé‚„æœ‰ç•¶åˆé¢å°å¤šé” 40 å¹¾éš» App ä½¿ç”¨é€™å¥—ç³»çµ±ï¼ŒNetworkManager å› æ‡‰ä¸åŒåƒæ•¸æˆ–é è¨­å€¼ä¸æ–·åœ°æ“´å¤§è«‹æ±‚æ–¹æ³•ï¼Œæœ‰æ™‚é‚„éœ€è¦ä¸åŒè¨­å®šå€¼çš„ URLSessionï¼ŒBaseRequest ä¹Ÿé–‹å§‹æ–°å¢ä¸åŒå­é¡åˆ¥å’Œå­æµç¨‹(æœ‰ç„¡èº«ä»½é©—è­‰/æœ‰ç„¡ç‰¹å®šHeader/æœ‰ç„¡Log/ä¸åŒè™•ç†å›æ‡‰çš„æ–¹å¼â€¦)ï¼Œæœ‰äº›ç‰¹æ®Šçš„ API é‚„æœƒéœ€è¦åŒæ™‚å¡ query åŠ ä¸Š bodyï¼Œç”šè‡³éœ€è¦æ–°å¢å„ç¨® Bool é–‹é—œæˆ–æ˜¯ Delegate çš„é€šçŸ¥æ¥å£ã€‚<br>ç¬¬ä¸€æ¬¡é«”é©—åˆ°å¦‚æ­¤æ·±åˆ»çš„â€ç¹¼æ‰¿ç¨â€â€¦ğŸ˜­ğŸ˜­ğŸ˜­</p></div><div class="note primary flat"><p>ç¹¼æ‰¿ç¨é€™å€‹è©æ˜¯æˆ‘å¾ã€Œ <a href="https://www.tenlong.com.tw/products/9789865022754">The Pragmatic Programmer 20é€±å¹´ç´€å¿µç‰ˆ</a> ã€çœ‹åˆ°çš„ï¼Œæ›¸æœ¬å¼•ç”¨ä¸€å¥è©± â€œæ‚¨åªæƒ³è¦ä¸€æ ¹é¦™è•‰ï¼Œä½†æ˜¯æ‚¨å¾—åˆ°çš„å»æ˜¯ä¸€éš»æ‹¿è‘—é¦™è•‰çš„å¤§çŒ©çŒ©å’Œæ•´å€‹å¢æ— - Joe Armstrongâ€ ã€‚</p><p>ç¹¼æ‰¿å°±æ˜¯ä¸€ç¨®è€¦åˆï¼Œçˆ¶é¡åˆ¥å’Œå­é¡åˆ¥ä¹‹é–“è€¦åˆã€å­é¡åˆ¥æ–°æ–¹æ³•å‘¼å«åˆ°çˆ¶é¡åˆ¥ä¹Ÿæ˜¯è€¦åˆï¼Œæ™‚é–“ä¸€ä¹…å¾€å¾€æœƒè¿­ä»£å‡ºå¤šå€‹é¡åˆ¥çš„ä¾è³´é—œä¿‚ï¼Œåƒæ˜¯ä¸€å€‹ç¶²ç‹€ä¸€æ¨£ï¼Œä¿®æ”¹éœ€è¦å°å¿ƒå½±éŸ¿ä¸Šä¸‹åŠŸèƒ½ï¼›å¦‚æœæƒ³è¦é¿å…å°±æ˜¯ä¸è¦ä½¿ç”¨ç¹¼æ‰¿ï¼Œæ”¹ç”¨ä¸‹åˆ—æ–¹å¼ï¼Œè©³æƒ…å¯ä»¥åƒè€ƒè©²æ›¸ã€‚</p><ul><li>interface/protocol </li><li>delegation </li><li>mixin/trait</li></ul></div><hr><div class="note success flat"><p>å¹¸é‹çš„æ˜¯æ­£å¥½çœ‹åˆ° <a href="https://twitter.com/onevcat">onevcat</a> å¤§ç¥åœ¨ iPlayground 2019 åˆ†äº«äº† <a href="https://www.youtube.com/watch?v=Xk4HZfW6vK0">éƒ¨ä»¶åŒ–ç¶²è·¯ç¨‹å¼è¨­è¨ˆ</a> / <a href="https://hackmd.io/@iPlayground/2019/%2FUBGbW1PVSl69rpE2h38w7A">hackmdå…±ç­†</a> / <a href="https://github.com/onevcat/ComponentNetworking">ComponentNetworking Demo</a>ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥é”åˆ°æ¯ä¸€é“ API æŠ½æ›å„ç¨®æµç¨‹ä¸¦ä¸”å…±ç”¨é‚è¼¯ï¼Œç”šè‡³ä¹Ÿå¯ä»¥é€²è¡Œå–®å…ƒæ¸¬è©¦æˆ– Mock è³‡æ–™ï¼›å…¶ä¸­ç”¨éƒ¨ä»¶ä¸¦ä¸”â€çµ„åˆâ€å‡ºåŠŸèƒ½çš„æ¦‚å¿µé ä¹Ÿè®“æˆ‘æƒ³åˆ° SwiftLee é€™ç¯‡ <a href="https://www.avanderlee.com/swift/composition-inheritance-code-architecture/">Composition vs. Inheritance</a>ã€‚</p></div><hr><h1 id="Version3-ï¼šä½¿ç”¨éƒ¨ä»¶åŒ–è¨­è¨ˆ"><a href="#Version3-ï¼šä½¿ç”¨éƒ¨ä»¶åŒ–è¨­è¨ˆ" class="headerlink" title="[Version3]ï¼šä½¿ç”¨éƒ¨ä»¶åŒ–è¨­è¨ˆ"></a>[Version3]ï¼šä½¿ç”¨éƒ¨ä»¶åŒ–è¨­è¨ˆ</h1><p><strong>æ­¤ç‰ˆæœ¬æ˜¯å¾ä¸Šé¢æåˆ° onevcat å¤§ç¥åˆ†äº«çš„ä½œæ³• fork åšä¿®æ”¹ï¼Œä¸¦ä¸”å› ç‚ºæˆ‘é‡åˆ°çš„éœ€æ±‚åšèª¿æ•´ï¼Œæ‰€ä»¥ä¸æœƒæ˜¯æœ€å®Œç¾æœ€é©åˆä½ çš„ï¼Œä½†æ˜¯éƒ¨ä»¶åŒ–çš„æ¦‚å¿µå¾ˆé©åˆçµ¦å¤§å®¶ä¾†é€²è¡Œèª¿æ•´ã€‚</strong></p><img src="/pinkblog/2022/02/17/iOS-Web-API-%E8%A8%AD%E8%A8%88-Web-API-Design-in-iOS/3.png" class="" width="700"><h2 id="ç‰¹æ€§-2"><a href="#ç‰¹æ€§-2" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><ul><li>Part1 çµ„åˆ Request: <ul><li>ä½¿ç”¨ Adapter çµ„è£ä¸€å€‹ä¸€å€‹çš„éƒ¨ä»¶ï¼Œå¯ä»¥æ˜¯æ–°å¢ä¸€å€‹ Headerã€ä¹Ÿå¯ä»¥æ˜¯æ–°å¢ Token</li><li>æ¯ç¶“éä¸€å€‹éƒ¨ä»¶æœƒå›å‚³ä¿®æ”¹å¾Œçš„ URLRequestï¼ŒæœƒæŠŠæ‰€æœ‰ Adapter éƒ½åŸ·è¡Œéä¸€éå¾Œå›å‚³æœ€çµ‚çš„ URLRequest</li></ul></li><li>Part2 ç™¼é€ API: <ul><li>ä½¿ç”¨ protocol ApiComponentSendable å…ˆé è¨­å®šç¾©ä¸€ç¨®ç™¼é€æµç¨‹ï¼Œä¸¦ä¸”å¯æŠ½æ›ç™¼é€ä¸»é«”(Native/Alamofire/Mockéƒ½å¯)</li></ul></li><li>Part3 è™•ç† Response: <ul><li>ä½¿ç”¨ Decision ä¸€å€‹ä¸€å€‹æ±ºç­–æ±ºå®šè©²åšä»€éº¼ï¼Œä¾‹å¦‚æ¥çºŒæ±ºç­–ã€é‡é ­é–‹å§‹ã€ç™¼ç”ŸéŒ¯èª¤ã€çµæŸæ±ºç­–</li><li>å¦‚æœæ˜¯â€æ¥çºŒæ±ºç­–â€å°±å¾€ä¸‹ä¸€å€‹æ±ºç­–åˆ¤æ–·</li><li>å¦‚æœåˆ°æœ€å¾Œé‚„æ˜¯æ²’æœ‰â€çµæŸæ±ºç­–â€æˆ–æ˜¯â€ç™¼ç”ŸéŒ¯èª¤â€ï¼Œå°±ä»£è¡¨æ±ºç­–è¨­å®šæœ‰å•é¡Œ</li></ul></li><li>åœ¨å®šç¾© Request ä¸­ä½¿ç”¨ RequestBaseSetting æ–¹ä¾¿æŠ½æ›åŸºåº•è¨­å®š(æ­£å¼æˆ–æ¸¬è©¦æ©Ÿ)</li><li>åœ¨è™•ç† Response ä¸­ä½¿ç”¨ DecisionRecord å¯ä»¥åœ¨ Console æ¸…æ¥šé¡¯ç¤ºæ±ºç­–æµç¨‹</li><li>ä¹‹å‰æ¥éç‰¹æ®Šç«™å°ç•¶å›æ‡‰æˆåŠŸæ™‚ï¼ŒstatusCode = 200 ä½† Data ç‚ºç©ºçš„ï¼Œæ‰€ä»¥ç¯„ä¾‹æœ‰å€‹ NilDataDecisionã€NilDataResponse å¯ä½¿ç”¨</li></ul><h2 id="å¯¦ä½œç¯„ä¾‹-2"><a href="#å¯¦ä½œç¯„ä¾‹-2" class="headerlink" title="å¯¦ä½œç¯„ä¾‹"></a>å¯¦ä½œç¯„ä¾‹</h2><p>ä¸‹é¢åªåˆ—å‡ºé‡è¦çš„ç‰©ä»¶ï¼Œå®Œæ•´ç¯„ä¾‹å¯ä»¥åƒè€ƒä¸‹é¢ Demo ç¶²å€ï¼</p><div class="tabs" id="version3"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#version3-1">Request</button></li><li class="tab"><button type="button" data-href="#version3-2">ApiComponentSendable</button></li><li class="tab"><button type="button" data-href="#version3-3">Adapter</button></li><li class="tab"><button type="button" data-href="#version3-4">Decision</button></li><li class="tab"><button type="button" data-href="#version3-5">GetRequest</button></li><li class="tab"><button type="button" data-href="#version3-6">HttpBinService</button></li><li class="tab"><button type="button" data-href="#version3-7">HttpBinService+HttpBinGet</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="version3-1"><p>Request å®šç¾© Api çš„ åŸºç¤è¨­å®š(domain)ã€HTTPMethodã€è½‰æ¥å™¨ã€æ±ºç­–è·¯å¾‘ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// RequeståŸºç¤è¨­å®š</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">RequestBaseSetting</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// Domain</span></span><br><span class="line">    <span class="keyword">var</span> domain: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// åŸºåº•Request</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// åŸºåº•Response</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Response</span>: <span class="type">Decodable</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// RequeståŸºç¤è¨­å®š</span></span><br><span class="line">    <span class="keyword">var</span> setting: <span class="type">RequestBaseSetting</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// HTTPMethod</span></span><br><span class="line">    <span class="keyword">var</span> method: <span class="type">HTTPMethod</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// è«‹æ±‚è½‰æ¥å™¨(ç™¼é€å‰è™•ç†)</span></span><br><span class="line">    <span class="keyword">var</span> adapters: [<span class="type">RequestAdapter</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// æ±ºç­–è·¯å¾‘(æ¥æ”¶å›æ‡‰å¾Œè™•ç†)</span></span><br><span class="line">    <span class="keyword">var</span> decisions: [<span class="type">Decision</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/// åŸºåº•Request</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// å»ºç«‹Request</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">buildRequest</span>()</span> <span class="keyword">throws</span> -&gt; <span class="type">URLRequest</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: setting.domain) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">ApiComponentError</span>.requestAdapterFailure(error: <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> request <span class="operator">=</span> <span class="type">URLRequest</span>(url: url)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span> adapters.reduce(request) &#123; <span class="keyword">try</span> <span class="variable">$1</span>.adapted(<span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version3-2"><p>ApiComponentSendable å®šç¾©ç™¼é€æµç¨‹ï¼ŒåŒ…å« Part1 + Part2 + Part3ï¼Œæ¯å€‹éƒ¨åˆ†éƒ½æ˜¯è¢«çµ„è£è€Œæˆã€‚<br><a href="https://github.com/pinkpika/APIRequestDesignDemo/blob/main/TestApp/APIRequestDesignVersion3/Component/ApiComponentSendable.swift">å®Œæ•´ç‰ˆ ApiComponentSendable.swift</a></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ApiComponentSendable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sendRequest</span>(<span class="params">request</span>: <span class="type">URLRequest</span>, <span class="params">queue</span>: <span class="type">DispatchQueue</span>, <span class="params">handler</span>: <span class="keyword">@escaping</span> (<span class="type">Data</span>?, <span class="type">URLResponse</span>?, <span class="type">Error</span>?) -&gt; <span class="type">Void</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ApiComponentSendable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// ç™¼é€Request(ä½¿ç”¨åˆå§‹æ±ºç­–)</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">send</span>&lt;<span class="type">Req</span>: <span class="type">Request</span>&gt;(</span></span><br><span class="line"><span class="function">        <span class="params">request</span>: <span class="type">Req</span>,</span></span><br><span class="line"><span class="function">        <span class="params">queue</span>: <span class="type">DispatchQueue</span>,</span></span><br><span class="line"><span class="function">        <span class="params">handler</span>: <span class="keyword">@escaping</span> (<span class="type">Swift</span>.<span class="type">Result</span>&lt;<span class="type">Req</span>.<span class="type">Response</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        send(request: request,</span><br><span class="line">             decisions: request.decisions,</span><br><span class="line">             queue: queue,</span><br><span class="line">             handler: handler)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// ç™¼é€Request(ä½¿ç”¨ç‰¹å®šæ±ºç­–)</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">send</span>&lt;<span class="type">Req</span>: <span class="type">Request</span>&gt;(</span></span><br><span class="line"><span class="function">        <span class="params">request</span>: <span class="type">Req</span>,</span></span><br><span class="line"><span class="function">        <span class="params">decisions</span>: [<span class="type">Decision</span>],</span></span><br><span class="line"><span class="function">        <span class="params">queue</span>: <span class="type">DispatchQueue</span>,</span></span><br><span class="line"><span class="function">        <span class="params">handler</span>: <span class="keyword">@escaping</span> (<span class="type">Swift</span>.<span class="type">Result</span>&lt;<span class="type">Req</span>.<span class="type">Response</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Todo: å»ºç«‹Request</span></span><br><span class="line">        request.buildRequest</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Todo: ç™¼é€ Request</span></span><br><span class="line">        sendRequest(request: urlRequest, queue: queue)&#123;</span><br><span class="line">            (data, response, error) <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Todo: - é è¨­è™•ç† data, response, error</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// Todo: - è™•ç†æ±ºç­–</span></span><br><span class="line">            <span class="keyword">self</span>.handleDecision(</span><br><span class="line">                request: request,</span><br><span class="line">                queue: queue,</span><br><span class="line">                data: data,</span><br><span class="line">                response: httpResponse,</span><br><span class="line">                nowDecisions: decisions,</span><br><span class="line">                decisionRecords: [],</span><br><span class="line">                handler: handler</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// è™•ç†æ±ºç­–</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">handleDecision</span>&lt;<span class="type">Req</span>: <span class="type">Request</span>&gt;(</span></span><br><span class="line"><span class="function">        <span class="params">request</span>: <span class="type">Req</span>,</span></span><br><span class="line"><span class="function">        <span class="params">queue</span>: <span class="type">DispatchQueue</span>,</span></span><br><span class="line"><span class="function">        <span class="params">data</span>: <span class="type">Data</span>?,</span></span><br><span class="line"><span class="function">        <span class="params">response</span>: <span class="type">HTTPURLResponse</span>,</span></span><br><span class="line"><span class="function">        <span class="params">nowDecisions</span>: [<span class="type">Decision</span>],</span></span><br><span class="line"><span class="function">        <span class="params">decisionRecords</span>: [<span class="type">DecisionRecord</span>&lt;<span class="type">Req</span>&gt;],</span></span><br><span class="line"><span class="function">        <span class="params">handler</span>: <span class="keyword">@escaping</span> (<span class="type">Swift</span>.<span class="type">Result</span>&lt;<span class="type">Req</span>.<span class="type">Response</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Todo: - åˆ¤æ–·æ˜¯å¦æ‡‰ç”¨æ±ºç­–</span></span><br><span class="line">        <span class="keyword">var</span> nowDecisions <span class="operator">=</span> nowDecisions</span><br><span class="line">        <span class="keyword">let</span> current <span class="operator">=</span> nowDecisions.removeFirst()</span><br><span class="line">        current.shouldApply <span class="operator">...</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Todo: - åŸ·è¡Œæ±ºç­–</span></span><br><span class="line">        current.apply(request: request, data: data, response: response) &#123; action <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ¤æ–· action</span></span><br><span class="line">                <span class="comment">// Todo: 1 ç¹¼çºŒåŸ·è¡Œ</span></span><br><span class="line">                handleDecision</span><br><span class="line">                <span class="comment">// Todo: 2 é‡æ–°é–‹å§‹    </span></span><br><span class="line">                send(<span class="operator">...</span>)ç™¼é€<span class="type">Request</span>(ä½¿ç”¨ç‰¹å®šæ±ºç­–)</span><br><span class="line">                <span class="comment">// Todo: 3 ç™¼ç”ŸéŒ¯èª¤</span></span><br><span class="line">                handler(.failure(error))</span><br><span class="line">                <span class="comment">// Todo: 4 å®Œæˆæ±ºç­–</span></span><br><span class="line">                handler(.success(response))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version3-3"><p>Adapter å°±æ˜¯ç”¨ä¾†çµ„è£ Request çš„å„ç¨®éƒ¨ä»¶ï¼Œå¯ä»¥çµ„åˆ Header æˆ–æ˜¯ body éƒ½å¯ä»¥ã€‚</p><figure class="highlight swift"><figcaption><span>Adapter</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// è«‹æ±‚è½‰æ¥å™¨</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">RequestAdapter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">adapted</span>(<span class="keyword">_</span> <span class="params">request</span>: <span class="type">URLRequest</span>)</span> <span class="keyword">throws</span> -&gt; <span class="type">URLRequest</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// HTTPMethod çš„ è½‰æ¥å™¨</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HTTPMethodAdapter</span>: <span class="title">RequestAdapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> method: <span class="type">HTTPMethod</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">adapted</span>(<span class="keyword">_</span> <span class="params">request</span>: <span class="type">URLRequest</span>)</span> <span class="keyword">throws</span> -&gt; <span class="type">URLRequest</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> request <span class="operator">=</span> request</span><br><span class="line">        request.httpMethod <span class="operator">=</span> method.rawValue</span><br><span class="line">        <span class="keyword">return</span> request</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// ContentType çš„ è½‰æ¥å™¨</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentTypeAdapter</span>: <span class="title">RequestAdapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> contentType: <span class="type">ContentType</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">adapted</span>(<span class="keyword">_</span> <span class="params">request</span>: <span class="type">URLRequest</span>)</span> <span class="keyword">throws</span> -&gt; <span class="type">URLRequest</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> request <span class="operator">=</span> request</span><br><span class="line">        request.setValue(contentType.rawValue, forHTTPHeaderField: <span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> request</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version3-4"><p>Decision æœ‰å…©ç¨®æ–¹æ³• shouldApply å’Œ applyï¼Œç•¶ shouldApply ç‚º true çš„æ™‚å€™æ‰æœƒåŸ·è¡Œ applyã€‚<br>apply è¨˜å¾—è¦åŸ·è¡Œä»»ä¸€ç¨® DecisionAction æ‰æœƒé †åˆ©åŸ·è¡Œã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æ±ºç­–æ–¹å¼</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Decision</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// æ˜¯å¦è¦æ‡‰ç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">shouldApply</span>&lt;<span class="type">Req</span>: <span class="type">Request</span>&gt;(<span class="params">request</span>: <span class="type">Req</span>, <span class="params">data</span>: <span class="type">Data</span>?, <span class="params">response</span>: <span class="type">HTTPURLResponse</span>)</span> -&gt; <span class="type">Bool</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// æ‡‰ç”¨æ–¹å¼</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">apply</span>&lt;<span class="type">Req</span>: <span class="type">Request</span>&gt;(</span></span><br><span class="line"><span class="function">        <span class="params">request</span>: <span class="type">Req</span>,</span></span><br><span class="line"><span class="function">        <span class="params">data</span>: <span class="type">Data</span>?,</span></span><br><span class="line"><span class="function">        <span class="params">response</span>: <span class="type">HTTPURLResponse</span>,</span></span><br><span class="line"><span class="function">        <span class="params">done</span> <span class="params">closure</span>: <span class="keyword">@escaping</span> (<span class="type">DecisionAction</span>&lt;<span class="type">Req</span>&gt;) -&gt; <span class="type">Void</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// æ±ºç­–å‹•ä½œ</span></span><br><span class="line"><span class="comment">/// - continueWith: æ¥çºŒæ±ºç­–</span></span><br><span class="line"><span class="comment">/// - restartWith: é‡é ­é–‹å§‹</span></span><br><span class="line"><span class="comment">/// - errored: ç™¼ç”ŸéŒ¯èª¤</span></span><br><span class="line"><span class="comment">/// - done: çµæŸæ±ºç­–</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">DecisionAction</span>&lt;<span class="title">Req</span>: <span class="title">Request</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> continueWith(<span class="type">Data</span>?, <span class="type">HTTPURLResponse</span>)</span><br><span class="line">    <span class="keyword">case</span> restartWith([<span class="type">Decision</span>])</span><br><span class="line">    <span class="keyword">case</span> errored(<span class="type">Error</span>)</span><br><span class="line">    <span class="keyword">case</span> done(<span class="type">Req</span>.<span class="type">Response</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// æ±ºç­–æ–¹å¼ - éŒ¯èª¤ç‹€æ…‹ç¢¼</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BadStatusCodeDecision</span>: <span class="title">Decision</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">shouldApply</span>&lt;<span class="type">Req</span>: <span class="type">Request</span>&gt;(<span class="params">request</span>: <span class="type">Req</span>, <span class="params">data</span>: <span class="type">Data</span>?, <span class="params">response</span>: <span class="type">HTTPURLResponse</span>)</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="operator">!</span>(<span class="number">200</span><span class="operator">..&lt;</span><span class="number">300</span>).contains(response.statusCode)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">apply</span>&lt;<span class="type">Req</span>: <span class="type">Request</span>&gt;(</span></span><br><span class="line"><span class="function">        <span class="params">request</span>: <span class="type">Req</span>,</span></span><br><span class="line"><span class="function">        <span class="params">data</span>: <span class="type">Data</span>?,</span></span><br><span class="line"><span class="function">        <span class="params">response</span>: <span class="type">HTTPURLResponse</span>,</span></span><br><span class="line"><span class="function">        <span class="params">done</span> <span class="params">closure</span>: <span class="keyword">@escaping</span> (<span class="type">DecisionAction</span>&lt;<span class="type">Req</span>&gt;) -&gt; <span class="type">Void</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        closure(.errored(<span class="type">ApiComponentError</span>.badStatusCode(data: data, statusCode: response.statusCode)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// æ±ºç­–æ–¹å¼ - è½‰æ›ç‰©ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ParseResultDecision</span>: <span class="title">Decision</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">shouldApply</span>&lt;<span class="type">Req</span>: <span class="type">Request</span>&gt;(<span class="params">request</span>: <span class="type">Req</span>, <span class="params">data</span>: <span class="type">Data</span>?, <span class="params">response</span>: <span class="type">HTTPURLResponse</span>)</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">apply</span>&lt;<span class="type">Req</span>: <span class="type">Request</span>&gt;(</span></span><br><span class="line"><span class="function">        <span class="params">request</span>: <span class="type">Req</span>,</span></span><br><span class="line"><span class="function">        <span class="params">data</span>: <span class="type">Data</span>?,</span></span><br><span class="line"><span class="function">        <span class="params">response</span>: <span class="type">HTTPURLResponse</span>,</span></span><br><span class="line"><span class="function">        <span class="params">done</span> <span class="params">closure</span>: <span class="keyword">@escaping</span> (<span class="type">DecisionAction</span>&lt;<span class="type">Req</span>&gt;) -&gt; <span class="type">Void</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> data <span class="operator">=</span> data <span class="keyword">else</span> &#123;</span><br><span class="line">            closure(.errored(<span class="type">ApiComponentError</span>.nilData))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> value <span class="operator">=</span> <span class="keyword">try</span> <span class="type">JSONDecoder</span>().decode(<span class="type">Req</span>.<span class="type">Response</span>.<span class="keyword">self</span>, from: data)</span><br><span class="line">            closure(.done(value))</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            closure(.errored(<span class="type">ApiComponentError</span>.decodeFailure(data: data, error: error)))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version3-5"><p>GetRequest conform Requestï¼Œä¸¦ä¸”å¯¦ä½œé è¨­çš„ methodã€adaptersã€decisionsã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// åŸºåº•Request - Get</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">GetRequest</span>: <span class="title">Request</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Path</span></span><br><span class="line">    <span class="keyword">var</span> path: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// Query Params</span></span><br><span class="line">    <span class="keyword">var</span> queryParams: [<span class="type">String</span>: <span class="type">String</span>]<span class="operator">?</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// åŸºåº•Request - Get</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">GetRequest</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> method: <span class="type">HTTPMethod</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .get</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// é è¨­çš„è½‰æ¥å™¨</span></span><br><span class="line">    <span class="keyword">var</span> adapters: [<span class="type">RequestAdapter</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="type">PathAdapter</span>(path: path),</span><br><span class="line">            <span class="type">HTTPMethodAdapter</span>(method: method),</span><br><span class="line">            <span class="type">QueryParamsAdapter</span>(queryParams: queryParams)</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// é è¨­çš„æ±ºç­–è·¯å¾‘</span></span><br><span class="line">    <span class="keyword">var</span> decisions: [<span class="type">Decision</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="type">BadStatusCodeDecision</span>(),</span><br><span class="line">            <span class="type">ParseResultDecision</span>()</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version3-6"><p>HttpBinService ç”¨ä¾†æ”¾è©²ç«™å°çš„ Requestã€Responseã€é è¨­çš„è¨­å®šå€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// HttpBinService ( https://httpbin.org/#/HTTP_Methods )</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HttpBinService</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// é è¨­è¨­å®šå€¼</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> defaultSetting: <span class="type">HttpBinServiceSetting</span> <span class="operator">=</span> .<span class="keyword">init</span>(status: .production)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// HttpBinServiceSetting</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HttpBinServiceSetting</span>: <span class="title">RequestBaseSetting</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// ç‹€æ…‹(é€šå¸¸ç«™å°æœƒæœ‰æ­£å¼ç«™å’Œæ¸¬è©¦ç«™ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½æ›´å¤š)</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Status</span>: <span class="title">String</span></span>&#123;</span><br><span class="line">        <span class="keyword">case</span> debug <span class="operator">=</span> <span class="string">&quot;https://httpbin.debug.org&quot;</span></span><br><span class="line">        <span class="keyword">case</span> production <span class="operator">=</span> <span class="string">&quot;https://httpbin.org&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> status: <span class="type">Status</span></span><br><span class="line">    <span class="keyword">var</span> domain: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> status.rawValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version3-7"><p>HttpBinGetRequest conform GetRequestï¼Œåªè¦å®šç¾©æ‰€éœ€æ¬„ä½å°±è¡Œï¼</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">HttpBinService</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">HttpBinGetRequest</span>: <span class="title">GetRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">typealias</span> <span class="type">Response</span> <span class="operator">=</span> <span class="type">HttpBinGetResponse</span></span><br><span class="line">        <span class="keyword">var</span> setting: <span class="type">RequestBaseSetting</span> <span class="operator">=</span> defaultSetting</span><br><span class="line">        <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/get&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> queryParams: [<span class="type">String</span> : <span class="type">String</span>]<span class="operator">?</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="string">&quot;foo&quot;</span>: foo]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> foo: <span class="type">String</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">HttpBinGetResponse</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Args</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> foo: <span class="type">String</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> args: <span class="type">Args</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="ä½¿ç”¨æ–¹å¼-2"><a href="#ä½¿ç”¨æ–¹å¼-2" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><div class="tabs" id="version3demo"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#version3demo-1">åŸºæœ¬ç”¨æ³•</button></li><li class="tab"><button type="button" data-href="#version3demo-2">Mockæ¸¬è©¦</button></li><li class="tab"><button type="button" data-href="#version3demo-3">åˆ‡æ›æ­£å¼æˆ–æ¸¬è©¦ç’°å¢ƒ</button></li><li class="tab"><button type="button" data-href="#version3demo-4">å®Œå…¨å®¢è£½åŒ–Request</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="version3demo-1"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> request1 <span class="operator">=</span> <span class="type">HttpBinService</span>.<span class="type">HttpBinGetRequest</span>(foo: <span class="string">&quot;123&quot;</span>)</span><br><span class="line"><span class="type">ApiNativeClient</span>(session: .shared).send(request: request1, queue: .main) &#123;</span><br><span class="line">    result <span class="keyword">in</span> <span class="built_in">print</span>(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ğŸŒ [HttpBinGetRequest][GET]: https://httpbin.org/get?foo=123</span><br><span class="line">â° [HttpBinGetRequest][ReceiveTime]: 0.416s - https://httpbin.org/get?foo=123</span><br><span class="line">ğŸ“¦ [HttpBinGetRequest][StatusCode = 200][ReceiveData]: ...</span><br><span class="line">ğŸš¥ [HttpBinGetRequest][Decisions]: &#123;BadStatusCodeâ•&#125; -&gt; &#123;ParseResultâ—ï¸&#125;[Success!!!ğŸ™†ğŸ™†ğŸ™†]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version3demo-2"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Case: é€²è¡Œ Mock çš„æ¸¬è©¦</span></span><br><span class="line"><span class="keyword">var</span> request <span class="operator">=</span> <span class="type">HttpBinService</span>.<span class="type">HttpBinGetRequest</span>(foo: <span class="string">&quot;0000&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> dataString <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#123;&quot;args&quot;:&#123;&quot;foo&quot;:&quot;0000&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">let</span> apiMockClient <span class="operator">=</span> <span class="type">ApiMockClient</span>(data: dataString.data(using: .utf8), statusCode: <span class="number">200</span>)</span><br><span class="line">apiMockClient.send(request: request, queue: .main) &#123;</span><br><span class="line">    result <span class="keyword">in</span> <span class="built_in">print</span>(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version3demo-3"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Case: æ•´å€‹ç«™å°åˆ‡æ›æ­£å¼æˆ–æ¸¬è©¦ç’°å¢ƒ</span></span><br><span class="line"><span class="type">HttpBinService</span>.defaultSetting.status <span class="operator">=</span> .debug</span><br><span class="line"><span class="keyword">let</span> request <span class="operator">=</span> <span class="type">HttpBinService</span>.<span class="type">HttpBinGetRequest</span>(foo: <span class="string">&quot;123&quot;</span>)</span><br><span class="line"><span class="type">ApiNativeClient</span>(session: .shared).send(request: request, queue: .main) &#123;</span><br><span class="line">    result <span class="keyword">in</span> <span class="built_in">print</span>(result)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Case: åªåˆ‡æ›ä¸€é“ Api æ­£å¼æˆ–æ¸¬è©¦ç’°å¢ƒ</span></span><br><span class="line"><span class="keyword">var</span> request <span class="operator">=</span> <span class="type">HttpBinService</span>.<span class="type">HttpBinGetRequest</span>(foo: <span class="string">&quot;123&quot;</span>)</span><br><span class="line">request.setting <span class="operator">=</span> <span class="type">HttpBinServiceSetting</span>.<span class="keyword">init</span>(status: .debug)</span><br><span class="line"><span class="type">ApiNativeClient</span>(session: .shared).send(request: request, queue: .main) &#123;</span><br><span class="line">    result <span class="keyword">in</span> <span class="built_in">print</span>(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="version3demo-4"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">HttpBinService</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">HttpBinCustomRequest</span>: <span class="title">Request</span> </span>&#123;</span><br><span class="line">        <span class="keyword">typealias</span> <span class="type">Response</span> <span class="operator">=</span> <span class="type">HttpBinCustomResponse</span></span><br><span class="line">        <span class="keyword">var</span> setting: <span class="type">RequestBaseSetting</span> <span class="operator">=</span> defaultSetting</span><br><span class="line">        <span class="keyword">var</span> method: <span class="type">HTTPMethod</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> .get <span class="comment">// <span class="doctag">TODO:</span> - Method</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> adapters: [<span class="type">RequestAdapter</span>] &#123;</span><br><span class="line">            <span class="keyword">return</span> [</span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span> - è«‹æ±‚è½‰æ¥å™¨</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> decisions: [<span class="type">Decision</span>] &#123;</span><br><span class="line">            <span class="keyword">return</span> [</span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span> - æ±ºç­–è·¯å¾‘</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">HttpBinCustomResponse</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> - å›æ‡‰ç‰©ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="Demo-2"><a href="#Demo-2" class="headerlink" title="Demo"></a>Demo</h2><ul><li><a href="https://github.com/pinkpika/APIRequestDesignDemo/tree/main/TestApp/APIRequestDesignVersion3">APIRequestDesignDemo - Version3</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note default flat&quot;&gt;&lt;p&gt;API æŒ‡çš„æ˜¯æ‡‰ç”¨ç¨‹å¼ä¹‹é–“æºé€šçš„ä»‹é¢ï¼Œè€Œæœ¬ç¯‡ä¸»é¡Œå…¶å¯¦æ˜¯å‰ç«¯å‘¼å«å¾Œç«¯ Web API çš„è¨­è¨ˆï¼Œå‰ç«¯ä½¿ç”¨ Web API å¯ä»¥æ‹¿åˆ°é ç«¯çš„è³‡æ–™ï¼Œä¹Ÿå¯ä¾ç…§ä¸åŒç”¨æˆ¶æä¾›ä»–å€‘ä¸åŒçš„å…§å®¹ï¼Œå› æ­¤å¦‚ä½•è¨­è¨ˆå‰ç«¯ Web API å±¤çš„</summary>
      
    
    
    
    <category term="iOS Development" scheme="http://pinkpika.github.io/pinkblog/categories/iOS-Development/"/>
    
    
    <category term="iOS" scheme="http://pinkpika.github.io/pinkblog/tags/iOS/"/>
    
    <category term="Web API" scheme="http://pinkpika.github.io/pinkblog/tags/Web-API/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªå»ºç«™å°è§£æ±º CORS Policy å•é¡Œ</title>
    <link href="http://pinkpika.github.io/pinkblog/2022/02/15/%E8%87%AA%E5%BB%BA%E7%AB%99%E5%8F%B0%E8%A7%A3%E6%B1%BA-CORS-Policy-%E5%95%8F%E9%A1%8C/"/>
    <id>http://pinkpika.github.io/pinkblog/2022/02/15/%E8%87%AA%E5%BB%BA%E7%AB%99%E5%8F%B0%E8%A7%A3%E6%B1%BA-CORS-Policy-%E5%95%8F%E9%A1%8C/</id>
    <published>2022-02-15T06:22:02.000Z</published>
    <updated>2022-02-17T18:17:52.738Z</updated>
    
    <content type="html"><![CDATA[<div class="note default flat"><p>æœ‰æ™‚å€™æƒ³å¯«å€‹ç°¡å–®çš„å°å·¥å…·ä¾†æ‹‰å–æˆ–æŸ¥è©¢ API è³‡æ–™ï¼Œå¯èƒ½æ˜¯é–‹æºè³‡æ–™ã€å¯èƒ½æ˜¯å…¬å¸å…§éƒ¨ç«™å°ç”¨çš„è³‡æ–™ï¼Œ<br>ç•¶ç„¶æœ‰å¾ˆå¤šå‰ç«¯å¹³å°å¯ä»¥é¸æ“‡(ç¶²é ã€æ‰‹æ©Ÿã€PC)ï¼Œç‚ºäº†æ–¹ä¾¿éš¨æ™‚é–‹å•Ÿï¼Œæœ‰æ™‚æœƒé¸æ“‡ç°¡å–®çš„éœæ…‹ç¶²é ï¼Œ<br>ä½†æ˜¯ä½¿ç”¨ç¶²é å‘¼å« API å¯èƒ½æœƒé‡åˆ° CORS Policy çš„å•é¡Œï¼Ÿé‚£è©²å¦‚ä½•è§£æ±ºå‘¢ï¼Ÿ</p></div><h1 id="å‰ç«¯ç¶²é å‘¼å«-API"><a href="#å‰ç«¯ç¶²é å‘¼å«-API" class="headerlink" title="å‰ç«¯ç¶²é å‘¼å« API"></a>å‰ç«¯ç¶²é å‘¼å« API</h1><p>ä½¿ç”¨ç¶²é å‘¼å« API æœ‰å¾ˆå¤šæ–¹å¼ï¼Œè€Œä¸”å„æœ‰å„ªç¼ºé»ï¼Œå¯ä»¥åƒè€ƒå…¶ä»–å¤§å¤§å¯«çš„ <a href="https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part4/ajax_fetch.html">AJAXèˆ‡Fetch API</a>ï¼š</p><ul><li>AJAX èˆ‡ XMLHttpRequest</li><li>HTML5 çš„ Fetch</li><li>â€¦</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> requestOptions = &#123; <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>, <span class="attr">redirect</span>: <span class="string">&#x27;follow&#x27;</span> &#125;;</span><br><span class="line">fetch(<span class="string">&quot;http://192.168.99.222:12345/api/Member/infos&quot;</span>, requestOptions)</span><br><span class="line">.then(<span class="function"><span class="params">response</span> =&gt;</span> response.text())</span><br><span class="line">.then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="string">&quot;#error&quot;</span>).innerHTML = <span class="string">``</span>;</span><br><span class="line">    jsonToResultTable(result);</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;error&#x27;</span>, error);</span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="string">&quot;#error&quot;</span>).innerHTML = <span class="string">`<span class="subst">$&#123;error&#125;</span>`</span>;</span><br><span class="line">    <span class="built_in">window</span>.clearInterval(timeoutID);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><div class="note warning flat"><p>ä¸Šé¢çš„ç¨‹å¼ç¢¼åœ¨åŸ·è¡Œæ™‚æœƒç™¼ç”ŸéŒ¯èª¤ï¼Œæ‰“é–‹ Condole çœ‹ï¼Œç™¼ç¾æ˜¯é—œæ–¼ CORS Policy çš„å•é¡Œã€‚</p></div><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to fetch at &#x27;http://....&#x27; from origin &#x27;null&#x27; has been blocked by CORS policy: No &#x27;Access-Control-Allow-Origin&#x27; header is present on the requested resource. If an opaque response serves your needs, set the request&#x27;s mode to &#x27;no-cors&#x27; to fetch the resource with CORS disabled.</span><br></pre></td></tr></table></figure><h1 id="CORS-Policy-çš„ç”¨é€”"><a href="#CORS-Policy-çš„ç”¨é€”" class="headerlink" title="CORS Policy çš„ç”¨é€”"></a>CORS Policy çš„ç”¨é€”</h1><p>æåŠ CORS Policyï¼Œå…ˆç†è§£ä¸€ä¸‹ä»€éº¼æ˜¯<a href="https://developer.mozilla.org/zh-TW/docs/Web/Security/Same-origin_policy">åŒæºæ”¿ç­–</a> (Same-Origin Policy)<br>åŒæºæ”¿ç­–æŒ‡çš„æ˜¯èªªç¶²é é€é AJAX æˆ–æ˜¯ Fetch æŠ€è¡“å­˜å–è³‡æ–™æ™‚ï¼Œå¿…é ˆé”æˆä¸‹é¢ä¸‰å€‹æ¢ä»¶</p><ol><li>ç›¸åŒå”å®š protocol</li><li>ç›¸åŒä¸»æ©Ÿä½ç½® domain</li><li>ç›¸åŒåŸ è™Ÿ port </li></ol><p>å¦‚æœä¸æ»¿è¶³å°±æœƒæ˜¯ä¸€å€‹è·¨ä¾†æºè«‹æ±‚ (Cross-origin http request)!!<br>è€Œ CORS Policy å…¨åç‚º Cross-origin resource sharing Policyï¼Œå«åšâ€è·¨ä¾†æºè³‡æºå…±äº«æ”¿ç­–â€ï¼Œ<br>å®ƒå°±æ˜¯ç”¨ä¾†è¨‚å®šè·¨ä¾†æºçš„è«‹æ±‚å’Œä¼ºæœå™¨è©²å¦‚ä½•å›æ‡‰ã€‚</p><ul><li>å‰ç«¯ç¶²é :</li></ul><p>å¦‚æœæ˜¯è·¨ä¾†æºè«‹æ±‚ï¼Œç¶²é æœƒè‡ªå‹•è£œä¸Š Access-Control-Request ç›¸é—œåƒæ•¸ï¼Œæˆç‚º Preflight Requestã€‚</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS /api/Member/infos</span><br><span class="line">Host: 192.168.99.222:12345</span><br><span class="line">Origin: ...</span><br><span class="line">Access-Control-Request-Method: GET</span><br><span class="line">Access-Control-Request-Headers: Content-Type</span><br></pre></td></tr></table></figure><ul><li>å¾Œç«¯ä¼ºæœå™¨ç«™å°:</li></ul><p>ä¼ºæœå™¨ç«¯éœ€è¦åœ¨å›æ‡‰çš„ Header åŠ ä¸Š<br>Access-Control-Allow-Originã€Access-Control-Request-Methodã€Access-Control-Request-Headers ç­‰è¨­å®šï¼Œ<br>ç”¨ä¾†è¦å®šä¼ºæœå™¨èƒ½æ¥å—çš„ä¾†æº Originã€å¯ç”¨æ–¹æ³• Methodã€Headerï¼Œ<br>è¦å‰‡ä¹Ÿå¾ˆå¤šï¼Œå¯ä»¥è‡ªè¡Œåƒè€ƒå…¶ä»–è³‡æ–™ã€‚</p><h1 id="CORS-Policy-çš„è™•ç†æ–¹å¼"><a href="#CORS-Policy-çš„è™•ç†æ–¹å¼" class="headerlink" title="CORS Policy çš„è™•ç†æ–¹å¼"></a>CORS Policy çš„è™•ç†æ–¹å¼</h1><ol><li>å¾Œç«¯ä¼ºæœå™¨ç«™å°èª¿æ•´æ”¯æ´ç‰¹å®š Origin æˆ–æ˜¯ Header çš„â€è·¨ä¾†æºè«‹æ±‚â€ï¼Œé€™æ˜¯æœ€æ­£è¦çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯æœ€é©ç•¶çš„ã€‚</li><li>é—œé–‰ç€è¦½å™¨çš„å®‰å…¨æ€§è¨­ç½®ï¼Œä¼¼ä¹æœ‰äº›æ‹›å¼å¯ä»¥é—œé–‰ä½†å¯èƒ½ä¸å¤ªå®‰å…¨ - <a href="https://alfilatov.com/posts/run-chrome-without-cors/">Run Chrome browser without CORS</a></li><li>ä½¿ç”¨ä»£ç†ç«™å°ï¼Œåœ¨å¾Œç«¯å‘¼å« API å¾Œå†åŠ ä¸Šç¬¦åˆ CORS Policy çš„ Headerï¼Œå›å‚³åŸå§‹è³‡æ–™å³å¯ã€‚</li></ol><div class="note warning flat"><p>åœ¨ç„¡æ³•èª¿æ•´å¾Œç«¯ä¼ºæœå™¨ç«™å°çš„å‰æä¸‹ï¼Œæ„Ÿè¦ºç¬¬ä¸‰ç¨®å¯ä»¥ç©ç©çœ‹ï¼</p></div><hr><h2 id="ä½œæ³•æµç¨‹"><a href="#ä½œæ³•æµç¨‹" class="headerlink" title="ä½œæ³•æµç¨‹:"></a>ä½œæ³•æµç¨‹:</h2><p>é€™è£¡æ˜¯ä½¿ç”¨è¼ƒç°¡æ˜“çš„å»ºç«‹ç«™å°æ–¹å¼ï¼Œç”¨ Node.js å–®ä¸€è…³æœ¬å®Œæˆï¼Œ<br>æœ€å¾Œå†ä½¿ç”¨å‰ç«¯ç¶²é æ¸¬è©¦çœ‹çœ‹ï¼Œæ˜¯å¦å¯ä»¥è½‰æ‰“è³‡æ–™å›ä¾†ã€‚</p><img src="/pinkblog/2022/02/15/%E8%87%AA%E5%BB%BA%E7%AB%99%E5%8F%B0%E8%A7%A3%E6%B1%BA-CORS-Policy-%E5%95%8F%E9%A1%8C/flow.png" class="" width="800"><h3 id="å»ºç«‹ä»£ç†ç«™å°"><a href="#å»ºç«‹ä»£ç†ç«™å°" class="headerlink" title="å»ºç«‹ä»£ç†ç«™å°"></a>å»ºç«‹ä»£ç†ç«™å°</h3><p>å»ºç«‹ App.jsï¼Œä¸¦åœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œ <code>node app.js</code>ï¼Œ<br>æ‡‰è©²æœƒçœ‹åˆ° <code>ğŸŸ¢ Server running at http://127.0.0.1:3000/</code>ï¼Œå°±ä»£è¡¨æˆåŠŸå»ºç«‹ç«™å°ã€‚</p><figure class="highlight javascript"><figcaption><span>App.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æurl</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;ğŸ”µ Receive request: &quot;</span>+req.url);</span><br><span class="line">    <span class="keyword">let</span> urlObject = url.parse(req.url,<span class="literal">true</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(urlObject);</span><br><span class="line">    <span class="keyword">let</span> queryObject = urlObject.query;</span><br><span class="line">    <span class="built_in">console</span>.log(queryObject);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€™è£¡åªç¤ºç¯„ GETï¼Œå…¶ä»–æ–¹æ³•è‡ªè¡Œæ“´å……</span></span><br><span class="line">    <span class="keyword">if</span> (req.method == <span class="string">&#x27;GET&#x27;</span> &amp;&amp; urlObject.pathname == <span class="string">&#x27;/get&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">        http.get(queryObject[<span class="string">&quot;target&quot;</span>], <span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            resp.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">                data += chunk;</span><br><span class="line">            &#125;);</span><br><span class="line">            resp.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// è½‰æ‰“æˆåŠŸå¾Œï¼Œè‡ªè¡ŒåŠ ä¸Š CORS å…è¨±çš„ Header</span></span><br><span class="line">                res.statusCode = resp.statusCode;</span><br><span class="line">                res.setHeader(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">                res.setHeader(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">                res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain; charset=utf-8&#x27;</span>);</span><br><span class="line">                res.end(data);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;).on(<span class="string">&quot;error&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;ğŸ”´ Error: &quot;</span> + err.message);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.statusCode = <span class="number">200</span>;</span><br><span class="line">        res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain; charset=utf-8&#x27;</span>);</span><br><span class="line">        res.end(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(port, hostname, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`ğŸŸ¢ Server running at http://<span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>/`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">&#x27;uncaughtException&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;ğŸ”´ Caught exception: &#x27;</span>, err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="æ‰“é–‹ç¶²é "><a href="#æ‰“é–‹ç¶²é " class="headerlink" title="æ‰“é–‹ç¶²é "></a>æ‰“é–‹ç¶²é </h3><p>è¦è¨˜å¾—å…ˆç·¨è¼¯æ­¤ç¶²é ï¼ŒæŠŠ fetch çš„ç›®æ¨™æ”¹æˆä»£ç†ç«™å°çš„ APIï¼Œ<br>ä¾‹å¦‚ä¸Šé¢è¦å®šçš„ path ç‚º /getï¼Œparameter ç‚º target = æŸå€‹API ( CORS æ˜¯è¢«ç¦æ­¢æˆ–æ˜¯è¢«é™åˆ¶çš„ )<br><code>http://localhost:3000/get?target=http://.....</code><br>ç·¨è¼¯å¥½ï¼Œå°±å¯ä»¥æ‰“é–‹ç¶²é æœ‰æ²’æœ‰è³‡æ–™å›ä¾†ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>AppInfo Table<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;background-color:WhiteSmoke;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;setting&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin:10px 10px;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-dark&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;onGetData()&quot;</span>&gt;</span>Get All Data!!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">onGetData</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> requestOptions = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">redirect</span>: <span class="string">&#x27;follow&#x27;</span></span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">        fetch(<span class="string">&quot;http://localhost:3000/get?target=http://.....&quot;</span>, requestOptions) <span class="comment">// é€™è£¡è¦å‘¼å« NodeJS çš„ç«™å°ï¼Œtarget=æŸå€‹API ( CORS æ˜¯è¢«ç¦æ­¢æˆ–æ˜¯è¢«é™åˆ¶çš„ )</span></span></span><br><span class="line"><span class="javascript">        .then(<span class="function"><span class="params">response</span> =&gt;</span> response.text())</span></span><br><span class="line"><span class="javascript">        .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(result);</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">        .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&#x27;error&#x27;</span>, error);</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note default flat&quot;&gt;&lt;p&gt;æœ‰æ™‚å€™æƒ³å¯«å€‹ç°¡å–®çš„å°å·¥å…·ä¾†æ‹‰å–æˆ–æŸ¥è©¢ API è³‡æ–™ï¼Œå¯èƒ½æ˜¯é–‹æºè³‡æ–™ã€å¯èƒ½æ˜¯å…¬å¸å…§éƒ¨ç«™å°ç”¨çš„è³‡æ–™ï¼Œ&lt;br&gt;ç•¶ç„¶æœ‰å¾ˆå¤šå‰ç«¯å¹³å°å¯ä»¥é¸æ“‡(ç¶²é ã€æ‰‹æ©Ÿã€PC)ï¼Œç‚ºäº†æ–¹ä¾¿éš¨æ™‚é–‹å•Ÿï¼Œæœ‰æ™‚æœƒé¸æ“‡ç°¡å–®çš„éœæ…‹ç¶²é ï¼Œ&lt;br&gt;ä½†æ˜¯ä½¿ç”¨</summary>
      
    
    
    
    <category term="Web Development" scheme="http://pinkpika.github.io/pinkblog/categories/Web-Development/"/>
    
    
    <category term="Web" scheme="http://pinkpika.github.io/pinkblog/tags/Web/"/>
    
    <category term="CORS Policy" scheme="http://pinkpika.github.io/pinkblog/tags/CORS-Policy/"/>
    
    <category term="NodeJS" scheme="http://pinkpika.github.io/pinkblog/tags/NodeJS/"/>
    
  </entry>
  
  <entry>
    <title>XCTest å’Œ Unit Testing Bundle</title>
    <link href="http://pinkpika.github.io/pinkblog/2022/02/06/XCTest-%E5%92%8C-Unit-Testing-Bundle/"/>
    <id>http://pinkpika.github.io/pinkblog/2022/02/06/XCTest-%E5%92%8C-Unit-Testing-Bundle/</id>
    <published>2022-02-06T08:15:10.000Z</published>
    <updated>2022-02-17T18:17:52.738Z</updated>
    
    <content type="html"><![CDATA[<div class="note default flat"><p>é–‹å§‹å¯«æ¸¬è©¦å‰å¿…é ˆå…ˆç­è§£è©²å¹³å°ç”¨ä¾†å¯«æ¸¬è©¦çš„å¥—ä»¶æˆ–æ¡†æ¶ï¼Œ<br>ä¾‹å¦‚ C# çš„ MSTestã€Java çš„ JUnitã€JavaScript çš„ JsUnitï¼Œ<br>ç•¶ç„¶åœ¨ iOS å¹³å°ä¸Šä¹Ÿæœ‰å°ˆå±¬çš„æ¸¬è©¦æ¡†æ¶ XCTestã€‚</p></div><h1 id="XCTest"><a href="#XCTest" class="headerlink" title="XCTest"></a>XCTest</h1><p>XCTest æ˜¯ Apple å®˜æ–¹å‡ºçš„æ¸¬è©¦æ¡†æ¶ï¼Œå¯ä»¥ç”¨ä¾†å»ºç«‹ Unit Testingã€Performance Testingã€UI Testingã€‚</p><ul><li><a href="https://developer.apple.com/documentation/xctest">xctest å®˜æ–¹æ–‡ä»¶</a></li></ul><h1 id="Unit-Testing-Bundle"><a href="#Unit-Testing-Bundle" class="headerlink" title="Unit Testing Bundle"></a>Unit Testing Bundle</h1><p>Unit Testing Bundle å‰‡æ˜¯ Xcode å…§å»ºç”¨ä¾†åšå–®å…ƒæ¸¬è©¦çš„ Targetã€‚</p><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><ol><li><p>æ–°å¢ Target &gt; iOS Unit Testing Bundle (åœ¨å»ºç«‹å°ˆæ¡ˆæ™‚å…¶å¯¦ä¹Ÿå¯ä»¥ç›´æ¥å‹¾é¸ Include Tests)</p><img src="/pinkblog/2022/02/06/XCTest-%E5%92%8C-Unit-Testing-Bundle/1.png" class="" width="600"></li><li><p>å‘½å Target åç¨± &gt; å®Œæˆå®‰è£</p><img src="/pinkblog/2022/02/06/XCTest-%E5%92%8C-Unit-Testing-Bundle/2.png" class="" width="600"></li><li><p>é€šå¸¸éœ€è¦æ¸¬è©¦çš„ç‰©ä»¶éƒ½åœ¨å°ˆæ¡ˆè£¡ï¼Œæ‰€ä»¥ <code>TestAppTests.swift</code> éœ€è¦åœ¨æœ€ä¸Šé¢åŠ ä¸Š <code>@testable import TestApp</code></p></li><li><p>ä¹Ÿå¯ä»¥è‡ªè¡Œæ–°å¢æ¸¬è©¦æª”æ¡ˆé€²è¡Œåˆ†é¡ï¼Œå»ºè­°æ˜¯ä¸€å€‹é¡åˆ¥å°ä¸€å€‹æ¸¬è©¦æª”æ¡ˆï¼Œä¸è¦æŠŠæ‰€æœ‰é¡åˆ¥çš„æ¸¬è©¦éƒ½å¯«åœ¨åŒä¸€å€‹æª”æ¡ˆ</p></li></ol><img src="/pinkblog/2022/02/06/XCTest-%E5%92%8C-Unit-Testing-Bundle/5.png" class="" width="800"><h2 id="æ’°å¯«æ¸¬è©¦"><a href="#æ’°å¯«æ¸¬è©¦" class="headerlink" title="æ’°å¯«æ¸¬è©¦"></a>æ’°å¯«æ¸¬è©¦</h2><h3 id="Setup-å’Œ-Teardown"><a href="#Setup-å’Œ-Teardown" class="headerlink" title="Setup å’Œ Teardown"></a>Setup å’Œ Teardown</h3><ul><li>SetUpï¼šåœ¨æ¸¬è©¦åŸ·è¡Œå‰åšä¸€äº›åˆå§‹åŒ–çš„è¨­å®šã€‚</li><li>TearDownï¼šæ¸¬è©¦çµæŸå¾Œï¼Œåœ¨é€™è£¡æ¸…é™¤è³‡æ–™æˆ–è¨­å®šï¼Œç¢ºä¿ä¸æœƒç•™ä¸‹ä»»ä½•å¯èƒ½å½±éŸ¿å¾ŒçºŒæ¸¬è©¦çš„æ±è¥¿ã€‚</li></ul><p>ç›®å‰å®˜æ–¹æœ‰æä¾›å¾ˆå¤šç¨®é€²éšç”¨æ³• <a href="https://developer.apple.com/documentation/xctest/xctestcase/set_up_and_tear_down_state_in_your_tests">Set Up and Tear Down State in Your Tests</a><br>ä¾‹å¦‚åˆå§‹åŒ–æ–¹å¼å°±æœ‰åˆ†åŒæ­¥æˆ–éåŒæ­¥ï¼Œ<br>æˆ–æ˜¯æä¾› <code>addTeardownBlock</code> ä¾†å®šç¾©ç‰¹å®šæ¸¬è©¦çš„ TearDownã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setUp</span>()</span> <span class="keyword">async</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="comment">// éåŒæ­¥åŸ·è¡Œåˆå§‹åŒ–è¨­å®šï¼Œä¸¦ä¸”å¯ä»¥ throws error</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setUpWithError</span>()</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="comment">// åŒæ­¥åŸ·è¡Œåˆå§‹åŒ–è¨­å®šï¼Œä¸¦ä¸”å¯ä»¥ throws error</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setUp</span>()</span> &#123;</span><br><span class="line">    <span class="comment">// åŒæ­¥åŸ·è¡Œåˆå§‹åŒ–è¨­å®š</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="XCTAssert"><a href="#XCTAssert" class="headerlink" title="XCTAssert"></a>XCTAssert</h3><p>ç”¨ä¾†é©—è­‰çµæœæ˜¯å¦å¦‚é æœŸï¼Œæœ‰å¾ˆå¤šç¨®åˆ¤æ–·æ–¹å¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">let</span> data <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">let</span> object: <span class="type">Date</span>? <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="comment">// åˆ¤æ–·æ˜¯å¦ç‚ºTrue</span></span><br><span class="line"><span class="type">XCTAssert</span>(result)</span><br><span class="line"><span class="comment">// åˆ¤æ–·æ˜¯å¦ç‚ºfalse</span></span><br><span class="line"><span class="type">XCTAssertFalse</span>(result)</span><br><span class="line"><span class="comment">// åˆ¤æ–·æ˜¯å¦ç›¸åŒ</span></span><br><span class="line"><span class="type">XCTAssertEqual</span>(data, <span class="number">100</span>)</span><br><span class="line"><span class="comment">// åˆ¤æ–·æ˜¯å¦ä¸ç›¸åŒ</span></span><br><span class="line"><span class="type">XCTAssertNotEqual</span>(data, <span class="number">0</span>)</span><br><span class="line"><span class="comment">// åˆ¤æ–·æ˜¯å¦ç‚ºç©º</span></span><br><span class="line"><span class="type">XCTAssertNil</span>(object)</span><br><span class="line"><span class="comment">// åˆ¤æ–·æ˜¯å¦ä¸ç‚ºç©º</span></span><br><span class="line"><span class="type">XCTAssertNotNil</span>(object)</span><br><span class="line"><span class="comment">// ç„¡æ¢ä»¶å¤±æ•—</span></span><br><span class="line"><span class="type">XCTFail</span>()</span><br></pre></td></tr></table></figure><img src="/pinkblog/2022/02/06/XCTest-%E5%92%8C-Unit-Testing-Bundle/3.png" class="" width="600"><h3 id="åŸ·è¡Œæ–¹å¼"><a href="#åŸ·è¡Œæ–¹å¼" class="headerlink" title="åŸ·è¡Œæ–¹å¼"></a>åŸ·è¡Œæ–¹å¼</h3><p>xcode çš„ä»‹é¢ä¸Šå°±æœ‰ä¸‰ç¨®æŒ‰æ³•å¯ä»¥è·‘æ¸¬è©¦ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ç”¨çµ‚ç«¯æ©Ÿè·‘æ¸¬è©¦ã€‚<br>ç¬¬ä¸€ç¨®æ¯”è¼ƒç‰¹åˆ¥ï¼Œæ˜¯è¦è¨­å®šé Schemeï¼Œä¸¦ä¸”é•·æŒ‰ç·¨è­¯æŒ‰éˆ•ï¼Œç„¶å¾Œæ”¹æˆåŸ·è¡Œæ¸¬è©¦ã€‚<br>ç¬¬äºŒæˆ–ä¸‰ç¨®æ¯”è¼ƒå–®ç´”ï¼Œç›´æ¥åŸ·è¡Œå–®ä¸€æª”æ¡ˆæˆ–æ˜¯å–®ä¸€æ¸¬è©¦ã€‚</p><img src="/pinkblog/2022/02/06/XCTest-%E5%92%8C-Unit-Testing-Bundle/4.png" class="" width="800"><h3 id="å–®å…ƒæ¸¬è©¦å‘½å"><a href="#å–®å…ƒæ¸¬è©¦å‘½å" class="headerlink" title="å–®å…ƒæ¸¬è©¦å‘½å"></a>å–®å…ƒæ¸¬è©¦å‘½å</h3><ul><li>å¿…é ˆä»¥å‰ç¶´ test é–‹é ­ã€ä¸å¸¶åƒæ•¸ã€ä¸è¿”å›å€¼ï¼Œæ˜¯å¦ç”¨åº•ç·šç”±åœ˜éšŠè€Œå®š</li><li>æœ€å¥½åç¨±èƒ½å¤ æ•˜è¿°æ¸¬è©¦çš„å…§å®¹ï¼Œæˆ–æ˜¯åŒ…å«é æœŸçš„çµæœ</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test_NumberTool_IsPositive()</span><br><span class="line">testNumberToolIsPositive()</span><br><span class="line">testDataManagerGetDataFromServerStatusCode200()</span><br><span class="line">testDataManagerGetDataFromServerStatusCode400()</span><br></pre></td></tr></table></figure><hr><h1 id="å¦‚ä½•æŠŠç¨‹å¼å¯«æˆå¯æ¸¬è©¦"><a href="#å¦‚ä½•æŠŠç¨‹å¼å¯«æˆå¯æ¸¬è©¦" class="headerlink" title="å¦‚ä½•æŠŠç¨‹å¼å¯«æˆå¯æ¸¬è©¦"></a>å¦‚ä½•æŠŠç¨‹å¼å¯«æˆå¯æ¸¬è©¦</h1><ol><li>ä¹¾æ·¨çš„æ¶æ§‹ ( MVCã€MVVMã€VIPERã€Clean ç­‰ç­‰æ¶æ§‹ï¼Œæ¶æ§‹çš„ç´°è†©ç¨‹åº¦æœƒç›´æ¥å½±éŸ¿èƒ½æ¸¬è©¦çš„ç¨‹åº¦ )</li><li>è·è²¬å–®ä¸€çš„ç‰©ä»¶</li><li>æŠ½é›¢æª”æ¡ˆç³»çµ± ( UserDefault or File )ã€è³‡æ–™åº« ( DataBase )ã€é ç«¯è³‡æ–™ ( Api )<ul><li>æŠ½é›¢çš„æ–¹å¼æœ€å¸¸è¦‹çš„å°±æ˜¯ä½¿ç”¨ Protocol æŠ½é›¢å¯¦ä½œï¼Œä¸¦ä¸”ä½¿ç”¨ä¾è³´æ³¨å…¥ ( DI ) æ›æˆå‡è³‡æ–™</li><li>æˆ–æ˜¯ä½¿ç”¨ä¸€äº›å¯¦ä½œå¥½ Mock çš„å¥—ä»¶ï¼Œä¾‹å¦‚ <a href="https://cocoapods.org/pods/MockUserDefaults">MockUserDefaults</a></li></ul></li></ol><hr><h1 id="å¸¸è¦‹çš„æ¸¬è©¦æ¡ˆä¾‹"><a href="#å¸¸è¦‹çš„æ¸¬è©¦æ¡ˆä¾‹" class="headerlink" title="å¸¸è¦‹çš„æ¸¬è©¦æ¡ˆä¾‹"></a>å¸¸è¦‹çš„æ¸¬è©¦æ¡ˆä¾‹</h1><h2 id="å°-Model-æ¸¬è©¦"><a href="#å°-Model-æ¸¬è©¦" class="headerlink" title="å° Model æ¸¬è©¦"></a>å° Model æ¸¬è©¦</h2><p>å¯æ¸¬è©¦ Model çš„å»ºæ§‹å¼æˆ–æ˜¯æ–¹æ³•ã€‚</p><figure class="highlight swift"><figcaption><span>Cake.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cake</span></span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> price: <span class="type">Double</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getPrice</span>(<span class="params">discount</span>: <span class="type">Double</span>)</span> -&gt; <span class="type">Double</span>?&#123;</span><br><span class="line">        <span class="keyword">guard</span> discount <span class="operator">&lt;=</span> <span class="number">1.0</span> <span class="operator">&amp;&amp;</span> discount <span class="operator">&gt;=</span> <span class="number">0.0</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">        <span class="keyword">return</span> price <span class="operator">*</span> (<span class="number">1</span> <span class="operator">-</span> discount)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><figcaption><span>CakeTests.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testCakeGetPrice</span>()</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> cake <span class="operator">=</span> <span class="type">Cake</span>(name: <span class="string">&quot;Strawberry Cake&quot;</span>, price: <span class="number">120</span>)</span><br><span class="line">    <span class="keyword">let</span> result <span class="operator">=</span> cake.getPrice(discount: <span class="number">0.2</span>)</span><br><span class="line">    <span class="type">XCTAssertEqual</span>(result, <span class="number">96</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°-API-æ¸¬è©¦"><a href="#å°-API-æ¸¬è©¦" class="headerlink" title="å° API æ¸¬è©¦"></a>å° API æ¸¬è©¦</h2><p>é‡å° Server å‘¼å« API é€²è¡Œæ¸¬è©¦ï¼Œç¢ºèªå›æ‡‰ç‰©ä»¶æ˜¯å¦å¦‚é æœŸï¼Œ<br>å› ç‚ºæœƒä¾è³´çœŸå¯¦ä¼ºæœå™¨ï¼Œæ‰€ä»¥ä¸æ˜¯å–®å…ƒæ¸¬è©¦è€Œæ˜¯æ•´åˆæ¸¬è©¦ã€‚</p><p>å®˜æ–¹é‡å°éåŒæ­¥æ¸¬è©¦ä¹Ÿæœ‰å¯«æ–‡ç«  - <a href="https://developer.apple.com/documentation/xctest/asynchronous_tests_and_expectations/testing_asynchronous_operations_with_expectations">Testing Asynchronous Operations with Expectations</a><br>éœ€è¦å»ºç«‹ XCTestExpectation ä¸¦ä½¿ç”¨ waitï¼Œæ‰èƒ½ç¢ºä¿éåŒæ­¥ä¸‹æ¸¬è©¦æœƒæ­£å¸¸ã€‚</p><figure class="highlight swift"><figcaption><span>DataManagerTests.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testDataManagerGetData</span>()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®£å‘Šexpectation</span></span><br><span class="line">    <span class="keyword">let</span> expect <span class="operator">=</span> expectation(description: <span class="string">&quot;DataManager getData&quot;</span>)</span><br><span class="line">    <span class="keyword">let</span> dataManager <span class="operator">=</span> <span class="type">DataManager</span>()</span><br><span class="line">    dataManager.getData() &#123; </span><br><span class="line">        result <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">switch</span> result &#123;</span><br><span class="line">        <span class="keyword">case</span> .success(<span class="keyword">let</span> data):</span><br><span class="line">            <span class="type">XCTAssert</span>(<span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">            <span class="type">XCTAssert</span>(<span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å®Œæˆçµæœ</span></span><br><span class="line">        expect.fulfill()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç­‰å¾…éåŒæ­¥çµæœï¼Œtimeout æ™‚é–“ç‚º 30 ç§’</span></span><br><span class="line">    wait(for: [expect], timeout: <span class="number">30.0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°çœŸå¯¦ç’°å¢ƒçš„æŠ½é›¢ä¸¦æ¸¬è©¦"><a href="#å°çœŸå¯¦ç’°å¢ƒçš„æŠ½é›¢ä¸¦æ¸¬è©¦" class="headerlink" title="å°çœŸå¯¦ç’°å¢ƒçš„æŠ½é›¢ä¸¦æ¸¬è©¦"></a>å°çœŸå¯¦ç’°å¢ƒçš„æŠ½é›¢ä¸¦æ¸¬è©¦</h2><p>ç•¶é‡åˆ°æª”æ¡ˆç³»çµ±ã€è³‡æ–™åº«ã€é ç«¯è³‡æ–™ï¼Œå¯ç”¨ Protocol æŠ½é›¢å¯¦ä½œä¸¦ä¾è³´æ³¨å…¥(DI)<br>åˆ©ç”¨å‡è³‡æ–™ä¾†é€²è¡Œå®Œæ•´çš„å•†æ¥­é‚è¼¯çš„æ¸¬è©¦ã€‚</p><p>ä¸‹é¢æœ‰å››æ­¥é©Ÿï¼š</p><ol><li>å°‡å‘¼å«é ç«¯è³‡æ–™çš„é‚è¼¯éƒ½å°è£åœ¨ä¸€å€‹ç‰©ä»¶ <code>CakeAPIProvider</code>ï¼Œå¥½è™•æ˜¯æ–¹ä¾¿æŠ½é›¢</li><li>å»ºç«‹ä¸€å€‹ protocol <code>CakeProvider</code>ï¼ŒæŠŠè¦æŠ½é›¢çš„æ–¹æ³•éƒ½å®šç¾©å‡ºä¾†</li><li>çœŸæ­£åœ¨ç®¡ç†è³‡æ–™çš„ <code>CakeManager</code> åªè¦ä½¿ç”¨è©² protocol å‘¼å«å„ç¨®å•†æ¥­é‚è¼¯</li></ol><figure class="highlight swift"><figcaption><span>CakeProvider.swift CakeAPIProvider.swift CakeManager.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">CakeProvider</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getData</span>(<span class="params">completion</span>: <span class="keyword">@escaping</span> ((<span class="type">Result</span>&lt;<span class="type">Cake</span>,<span class="type">Error</span>&gt;)-&gt;<span class="type">Void</span>))</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CakeAPIProvider</span>: <span class="title">CakeProvider</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getData</span>(<span class="params">completion</span>: <span class="keyword">@escaping</span> ((<span class="type">Result</span>&lt;<span class="type">Cake</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span>))</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;...&quot;</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="type">AF</span>.request(url).response&#123;</span><br><span class="line">            response <span class="keyword">in</span></span><br><span class="line">            <span class="comment">//completion(...)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CakeManager</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> provider: <span class="type">CakeProvider</span> <span class="operator">=</span> <span class="type">CakeAPIProvider</span>()</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getCakePrice</span>(<span class="params">completion</span>: <span class="keyword">@escaping</span> ((<span class="type">Result</span>&lt;<span class="type">Double</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span>))</span>&#123;</span><br><span class="line">        provider.getData &#123;</span><br><span class="line">            result <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">switch</span> result&#123;</span><br><span class="line">            <span class="keyword">case</span> .success(<span class="keyword">let</span> cake):</span><br><span class="line">                completion(.success(cake.price))</span><br><span class="line">            <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">                completion(.failure(error))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//func ...</span></span><br><span class="line">    <span class="comment">//func ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>åˆ°æ™‚å€™è¦é€²è¡Œæ¸¬è©¦æˆ–æŠ½æ›å¯¦ä½œæ™‚ï¼Œåªè¦æ› <code>CakeManager</code> çš„ provider å³å¯ï¼</li></ol><figure class="highlight swift"><figcaption><span>CakeManagerTests.swift</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CakeMockProvider</span>: <span class="title">CakeProvider</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getData</span>(<span class="params">completion</span>: <span class="keyword">@escaping</span> ((<span class="type">Result</span>&lt;<span class="type">Cake</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span>))</span> &#123;</span><br><span class="line">        completion(.success(<span class="type">Cake</span>(name: <span class="string">&quot;MockCake&quot;</span>, price: <span class="number">100</span>)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CakeManagerTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testCakeManager</span>()</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> cakeManager <span class="operator">=</span> <span class="type">CakeManager</span>()</span><br><span class="line">        cakeManager.provider <span class="operator">=</span> <span class="type">CakeMockProvider</span>() <span class="comment">// é€™è£¡é€²è¡ŒæŠ½æ›</span></span><br><span class="line">        cakeManager.getCakePrice &#123;</span><br><span class="line">            result <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">switch</span> result&#123;</span><br><span class="line">            <span class="keyword">case</span>.success(<span class="keyword">let</span> price):</span><br><span class="line">                <span class="type">XCTAssertEqual</span>(price, <span class="number">100</span>)</span><br><span class="line">            <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">                <span class="type">XCTFail</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ¸¬è©¦è¦†è“‹ç‡-Code-Coverage"><a href="#æ¸¬è©¦è¦†è“‹ç‡-Code-Coverage" class="headerlink" title="æ¸¬è©¦è¦†è“‹ç‡ (Code Coverage)"></a>æ¸¬è©¦è¦†è“‹ç‡ (Code Coverage)</h1><p>æ¸¬è©¦è¦†è“‹ç‡å¯ä»¥ç”¨ä¾†çœ‹åœ¨è·‘æ¸¬è©¦çš„éç¨‹ä¸­ï¼Œæœ‰å¤šå°‘æ¯”ä¾‹çš„ç¨‹å¼æœ‰åŸ·è¡Œåˆ°ã€‚</p><h2 id="å»ºç«‹æ–¹å¼"><a href="#å»ºç«‹æ–¹å¼" class="headerlink" title="å»ºç«‹æ–¹å¼"></a>å»ºç«‹æ–¹å¼</h2><p>ç·¨è¼¯ Scheme &gt; Test &gt; å‹¾é¸ Code Coverageï¼Œ<br>å¯ä»¥é¸æ“‡ç‰¹å®š targetï¼Œç›¡é‡é¸æ“‡è‡ªå·±å°ˆæ¡ˆå°±å¥½ï¼Œä¸ç„¶æœƒåŒ…å«ä¸€äº›ä¸‰æ–¹ä¾è³´ã€‚ </p><img src="/pinkblog/2022/02/06/XCTest-%E5%92%8C-Unit-Testing-Bundle/6.png" class="" width="800"><h2 id="æŸ¥çœ‹çµæœ"><a href="#æŸ¥çœ‹çµæœ" class="headerlink" title="æŸ¥çœ‹çµæœ"></a>æŸ¥çœ‹çµæœ</h2><p>å¯ä»¥å¾ xcode çš„æ´»å‹•ç´€éŒ„è£¡çœ‹åˆ° Coverage</p><img src="/pinkblog/2022/02/06/XCTest-%E5%92%8C-Unit-Testing-Bundle/7.png" class="" width="800"><p>è¿½æ±‚ 100ï¼… çš„æ¸¬è©¦è¦†è“‹ç‡å…¶å¯¦ä¸å¤ªå®¹æ˜“ï¼Œ<br>æ›´ä½•æ³å‰ç«¯å¾ˆå¤šæ˜¯ UI ç›¸é—œçš„ç¨‹å¼ç¢¼ï¼Œä¹Ÿä¸æ˜¯é‚£éº¼å®¹æ˜“å¯«å–®å…ƒæ¸¬è©¦ï¼Œ<br>è‡³å°‘ç¢ºèªé‡è¦é‚è¼¯æˆ–æ˜¯é—œéµè·¯å¾‘å·²ç¶“è¢«æ¸¬è©¦å°±å¯ä»¥äº†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note default flat&quot;&gt;&lt;p&gt;é–‹å§‹å¯«æ¸¬è©¦å‰å¿…é ˆå…ˆç­è§£è©²å¹³å°ç”¨ä¾†å¯«æ¸¬è©¦çš„å¥—ä»¶æˆ–æ¡†æ¶ï¼Œ&lt;br&gt;ä¾‹å¦‚ C# çš„ MSTestã€Java çš„ JUnitã€JavaScript çš„ JsUnitï¼Œ&lt;br&gt;ç•¶ç„¶åœ¨ iOS å¹³å°ä¸Šä¹Ÿæœ‰å°ˆå±¬çš„æ¸¬è©¦æ¡†æ¶ XCT</summary>
      
    
    
    
    <category term="iOS Development" scheme="http://pinkpika.github.io/pinkblog/categories/iOS-Development/"/>
    
    
    <category term="iOS" scheme="http://pinkpika.github.io/pinkblog/tags/iOS/"/>
    
    <category term="Unit Testing" scheme="http://pinkpika.github.io/pinkblog/tags/Unit-Testing/"/>
    
  </entry>
  
  <entry>
    <title>Unit Testing çš„å…¥é–€ä»‹ç´¹</title>
    <link href="http://pinkpika.github.io/pinkblog/2022/02/06/Unit-Testing-%E7%9A%84%E5%85%A5%E9%96%80%E4%BB%8B%E7%B4%B9/"/>
    <id>http://pinkpika.github.io/pinkblog/2022/02/06/Unit-Testing-%E7%9A%84%E5%85%A5%E9%96%80%E4%BB%8B%E7%B4%B9/</id>
    <published>2022-02-06T05:56:37.000Z</published>
    <updated>2022-02-17T18:17:52.737Z</updated>
    
    <content type="html"><![CDATA[<div class="note default flat"><p>å¸¸å¸¸è½åˆ°èªªå¯«æ¸¬è©¦å¯ä»¥ç¢ºä¿ç¨‹å¼ç¢¼å“è³ªã€å¹«åŠ©æˆ‘å€‘ä¸æœƒä¿®å£ç¨‹å¼ç¢¼ï¼Œ<br>é‚£å…·é«”ä¾†èªªæ¸¬è©¦åˆ°åº•æ˜¯ä»€éº¼æ¨£çš„æ±è¥¿å‘¢ï¼Ÿ</p></div><h1 id="å–®å…ƒæ¸¬è©¦-Unit-Testing"><a href="#å–®å…ƒæ¸¬è©¦-Unit-Testing" class="headerlink" title="å–®å…ƒæ¸¬è©¦ (Unit Testing)"></a>å–®å…ƒæ¸¬è©¦ (Unit Testing)</h1><p>å–®å…ƒæ¸¬è©¦æ˜¯ä¸€çµ„é©—è­‰åŠŸèƒ½çš„ç¨‹å¼ç¢¼ï¼Œé€™æ®µç¨‹å¼æœƒå‘¼å«è¢«æ¸¬è©¦çš„å·¥ä½œå–®å…ƒï¼Œä¸¦ä¸”é‡å°çµæœé€²è¡Œé©—è­‰ï¼Œ<br>ç‚ºäº†å¯ä»¥åœ¨é–‹ç™¼éç¨‹ä¸­æˆ–æ˜¯ç™¼å¸ƒä¹‹å‰å¯ä»¥æ‰¾åˆ°é‚è¼¯éŒ¯èª¤çš„åŠŸèƒ½ï¼Œé€šå¸¸éƒ½æœƒåŠ åœ¨ CI/CD çš„æµç¨‹ä¸­ã€‚</p><p>ä¸€çµ„å–®å…ƒæ¸¬è©¦é€šå¸¸æœ‰ä¸‰å€‹æ­¥é©Ÿï¼š</p><ol><li>Arrangeï¼šæº–å‚™ =&gt; åˆå§‹åŒ–ä¸¦è¨­å®šå¥½è¦æ¸¬é©—çš„ç‰©ä»¶</li><li>Actï¼šæ“ä½œ =&gt; åŸ·è¡Œè¦é©—è­‰çš„æ–¹æ³•</li><li>Assertï¼šé©—è­‰ =&gt; å°çµæœé€²è¡Œé©—è­‰æ˜¯ä¸æ˜¯ç¬¦åˆé æœŸ</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testNumberToolIsPositive</span>()</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Arrangeï¼šæº–å‚™</span></span><br><span class="line">    <span class="keyword">let</span> numberTool <span class="operator">=</span> <span class="type">NumberTool</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Actï¼šæ“ä½œ</span></span><br><span class="line">    <span class="keyword">let</span> result <span class="operator">=</span> numberTool.isPositive(input: <span class="number">999</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Assertï¼šé©—è­‰</span></span><br><span class="line">    <span class="type">XCTAssert</span>(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å–®å…ƒæ¸¬è©¦çš„é—œéµç‰¹è³ª"><a href="#å–®å…ƒæ¸¬è©¦çš„é—œéµç‰¹è³ª" class="headerlink" title="å–®å…ƒæ¸¬è©¦çš„é—œéµç‰¹è³ª"></a>å–®å…ƒæ¸¬è©¦çš„é—œéµç‰¹è³ª</h1><ol><li>è‡ªå‹•åŒ–ä¸”å¯è¢«é‡è¤‡åŸ·è¡Œçš„</li><li>å®¹æ˜“å¯¦ä½œçš„</li><li>å®¹æ˜“åŸ·è¡Œçš„ (éš¨ä¾¿æŒ‰å€‹éˆ•å°±å¯ä»¥)</li><li>éè‡¨æ™‚æ€§çš„ (é€™å€‹æ¸¬è©¦åˆ°ç¬¬äºŒå¤©ç¬¬ä¸‰å¤©ä»æœ‰æ„ç¾©ï¼Œä¸¦å¯ä»¥åŸ·è¡Œ)</li><li>åŸ·è¡Œé€Ÿåº¦å¾ˆå¿«çš„</li><li>åŸ·è¡Œçµæœä¸€è‡´çš„</li><li>å®Œå…¨ç¨ç«‹çš„ (ä¸ä¾è³´å…¶ä»–å› ç´ æˆ–æ¸¬è©¦)</li><li>æ¸¬è©¦ç›®æ¨™æ¸…æ¥šçš„ (ç™¼ç”ŸéŒ¯èª¤å¯ä»¥æ˜ç¢ºçŸ¥é“å“ªè£¡æœ‰å•é¡Œ)</li></ol><div class="note warning flat"><p>å‡è¨­ä½ çš„æ¸¬è©¦æœ‰ä¸ç¬¦åˆä¸Šé¢å–®å…ƒæ¸¬è©¦çš„ç‰¹è³ªï¼Œå¾ˆæœ‰å¯èƒ½ä½ çš„æ˜¯å±¬æ–¼â€æ•´åˆæ¸¬è©¦â€</p></div><h1 id="æ•´åˆæ¸¬è©¦-Integration-Testing"><a href="#æ•´åˆæ¸¬è©¦-Integration-Testing" class="headerlink" title="æ•´åˆæ¸¬è©¦ (Integration Testing)"></a>æ•´åˆæ¸¬è©¦ (Integration Testing)</h1><p>ç•¶ä½ çš„æ¸¬è©¦ä¾è³´æŸç¨®ç’°å¢ƒæˆ–æ˜¯å¸¶æœ‰ä¸å®šå› ç´ (ä¾‹å¦‚ç³»çµ±æ™‚é–“ã€ç¶²è·¯ç‹€æ…‹)ï¼Œ<br>æˆ–æ˜¯ç”¨åˆ°äº†çœŸå¯¦çš„æª”æ¡ˆç³»çµ±æˆ–æ˜¯è³‡æ–™åº«ç­‰ç­‰ï¼Œé€™äº›æ¸¬è©¦éƒ½å°‡å±¬æ–¼æ•´åˆæ¸¬è©¦ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testDataManagerGetDataFromServer</span>()</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> dataManager <span class="operator">=</span> <span class="type">DataManager</span>()</span><br><span class="line">    dataManager.getDataFromServer &#123; <span class="comment">// ---&gt; å‡è¨­æ­¤æ–¹æ³•å‘¼å«äº†Api</span></span><br><span class="line">        result <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">switch</span> result&#123;</span><br><span class="line">        <span class="keyword">case</span> .success(<span class="keyword">let</span> data):</span><br><span class="line">            <span class="type">XCTAssert</span>(<span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">            <span class="type">XCTAssert</span>(<span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´åˆæ¸¬è©¦ä¾ç„¶æœ‰å¿…è¦ï¼Œä½†æœ‰å€‹å•é¡Œå°±æ˜¯ä¸€æ¬¡æ¸¬è©¦å¤ªå¤šæ±è¥¿ï¼Œ<br>ç„¡æ³•ç¢ºå®šåˆ°åº•æ˜¯èª°å£äº†ï¼Œåˆ°åº•æ˜¯å‰ç«¯ API ç‰©ä»¶å¯«å£é‚„æ˜¯ Server ç›®å‰æ˜¯å£æ‰çš„å‘¢ï¼Ÿ</p><hr><div class="note warning flat"><p>å¯«å¥½å–®å…ƒæ¸¬è©¦å°±å¥½äº†å—ï¼Ÿ</p></div><img src="/pinkblog/2022/02/06/Unit-Testing-%E7%9A%84%E5%85%A5%E9%96%80%E4%BB%8B%E7%B4%B9/unitTests.gif" class="" width="300" title="å…©å€‹å®Œç¾çš„å–®å…ƒæ¸¬è©¦ï¼Œä¸ä»£è¡¨é‹ä½œæœƒæ­£å¸¸..."><hr><h1 id="æ¸¬è©¦é‡‘å­—å¡”-Testing-Pyramid"><a href="#æ¸¬è©¦é‡‘å­—å¡”-Testing-Pyramid" class="headerlink" title="æ¸¬è©¦é‡‘å­—å¡” (Testing Pyramid)"></a>æ¸¬è©¦é‡‘å­—å¡” (Testing Pyramid)</h1><p>å‰ç«¯å¾€å¾€åŒ…å«å¤§é‡ UI çš„äº’å‹•å’Œå¤šæ¨£çš„è³‡æ–™ä¾†æºï¼Œ<br>å¦‚æœåªä¾é å–®å…ƒæ¸¬è©¦ï¼Œå¯èƒ½æ²’è¾¦æ³•å®Œå…¨æ¸¬è©¦å‡ºå¯èƒ½çš„å•é¡Œï¼Œæ‰€ä»¥è¡ä¼¸å‡ºä¸åŒå±¤ç´šçš„æ¸¬è©¦æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æ¸¬è©¦é‡‘å­—å¡”ã€‚<br>ç¶²è·¯ä¸Šæœ‰å„ç¨®ä¸åŒçš„ç‰ˆæœ¬ï¼Œä¾ç…§ä¸åŒç”¢å“å¯è¡ç”Ÿä¸åŒåˆ†å±¤ï¼Œä½†æ˜¯æƒ³è¡¨é”çš„æ¦‚å¿µéƒ½å¤§åŒå°ç•°ï¼</p><img src="/pinkblog/2022/02/06/Unit-Testing-%E7%9A%84%E5%85%A5%E9%96%80%E4%BB%8B%E7%B4%B9/testing-pyramid.png" class="" width="500"><p>é€™è£¡ç°¡å–®èªªæ˜æœ€å¸¸è¦‹çš„ä¸‰å±¤ï¼š</p><table><thead><tr><th></th><th>å®šç¾©</th><th>ç‰¹é»</th></tr></thead><tbody><tr><td>UIæ¸¬è©¦(UI Testing)</td><td>å¾ä½¿ç”¨è€…è§’åº¦çš„æ¸¬è©¦ï¼Œå¯¦éš›æ“ä½œApp</td><td>é€Ÿåº¦æ…¢ã€æ’°å¯«æˆæœ¬é«˜ã€ç¶­è­·æˆæœ¬é«˜</td></tr><tr><td>æ•´åˆæ¸¬è©¦(Integration Testing)</td><td>æ¸¬è©¦åŒ…å«å¯¦éš›çš„ä¼ºæœå™¨ã€DB</td><td>ä»‹æ–¼ä¸­é–“</td></tr><tr><td>å–®å…ƒæ¸¬è©¦(Unit Testing)</td><td>å–®ç´”æ¸¬è©¦é‚è¼¯ï¼Œä¸¦éš”é›¢æ‰€æœ‰å¤–éƒ¨å› ç´ </td><td>é€Ÿåº¦å¿«ã€æ’°å¯«æˆæœ¬ä½ã€ç¶­è­·æˆæœ¬ä½</td></tr></tbody></table><p>æ’°å¯«æ¸¬è©¦çš„é †åºæ˜¯ç”±ä¸‹è‡³ä¸Šï¼Œåƒæ˜¯è“‹æˆ¿å­ä¸€æ¨£ï¼Œ<br>é€šå¸¸å–®å…ƒæ¸¬è©¦æ˜¯æ¶µè“‹ç¯„åœæœ€å¤§çš„ï¼Œéœ€è¦é‡å°å¤§éƒ¨åˆ†çš„ <strong>åŸºåº•ç‰©ä»¶æ–¹æ³•å’Œå•†æ¥­é‚è¼¯</strong> é€²è¡Œæ¸¬è©¦ï¼Œ<br>è€Œæ•´åˆæ¸¬è©¦ã€UIæ¸¬è©¦æ‡‰è©²æœƒè¶Šä¾†è¶Šå°‘æ‰å°ï¼Œå° <strong>é—œéµè·¯å¾‘(Critical Path)</strong> é€²è¡Œæ¸¬è©¦å³å¯ã€‚</p><h1 id="æ¨è–¦æ›¸å–®"><a href="#æ¨è–¦æ›¸å–®" class="headerlink" title="æ¨è–¦æ›¸å–®"></a>æ¨è–¦æ›¸å–®</h1><p><a href="https://www.tenlong.com.tw/products/9789864342471?list_name=srh">å–®å…ƒæ¸¬è©¦çš„è—è¡“(The Art of Unit Testing)</a></p><p>æœ€é‡è¦çš„ä¸‰å€‹ç« ç¯€ï¼š</p><ul><li>ç¬¬1ç« ï¼šå–®å…ƒæ¸¬è©¦å®šç¾©</li><li>ç¬¬8ç« ï¼šå¥½çš„å–®å…ƒæ¸¬è©¦</li><li>ç¬¬11ç« ï¼šå¦‚ä½•è®“ç¨‹å¼è®Šå¯æ¸¬è©¦</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note default flat&quot;&gt;&lt;p&gt;å¸¸å¸¸è½åˆ°èªªå¯«æ¸¬è©¦å¯ä»¥ç¢ºä¿ç¨‹å¼ç¢¼å“è³ªã€å¹«åŠ©æˆ‘å€‘ä¸æœƒä¿®å£ç¨‹å¼ç¢¼ï¼Œ&lt;br&gt;é‚£å…·é«”ä¾†èªªæ¸¬è©¦åˆ°åº•æ˜¯ä»€éº¼æ¨£çš„æ±è¥¿å‘¢ï¼Ÿ&lt;/p&gt;
&lt;/div&gt;

&lt;h1 id=&quot;å–®å…ƒæ¸¬è©¦-Unit-Testing&quot;&gt;&lt;a href=&quot;#å–®å…ƒæ¸¬è©¦</summary>
      
    
    
    
    <category term="iOS Development" scheme="http://pinkpika.github.io/pinkblog/categories/iOS-Development/"/>
    
    
    <category term="iOS" scheme="http://pinkpika.github.io/pinkblog/tags/iOS/"/>
    
    <category term="Unit Testing" scheme="http://pinkpika.github.io/pinkblog/tags/Unit-Testing/"/>
    
  </entry>
  
  <entry>
    <title>SwiftLint éœæ…‹æª¢æŸ¥å™¨</title>
    <link href="http://pinkpika.github.io/pinkblog/2022/02/01/SwiftLint-%E9%9D%9C%E6%85%8B%E6%AA%A2%E6%9F%A5%E5%99%A8/"/>
    <id>http://pinkpika.github.io/pinkblog/2022/02/01/SwiftLint-%E9%9D%9C%E6%85%8B%E6%AA%A2%E6%9F%A5%E5%99%A8/</id>
    <published>2022-02-01T05:40:55.000Z</published>
    <updated>2022-02-17T18:17:52.737Z</updated>
    
    <content type="html"><![CDATA[<div class="note default flat"><p>æœ¬ç¯‡æœƒä»‹ç´¹ Coding Style èˆ‡ iOS å¹³å°ä¸Šæœ€æ´»èºçš„éœæ…‹æª¢æŸ¥å™¨ SwiftLintï¼Œ<br>å¯ä»¥å¹«åŠ©ä½ çš„ç¨‹å¼ç¢¼ä¿æŒä¸€è‡´çš„é¢¨æ ¼ï¼Œä¸¦ä¸”è®“åœ˜éšŠæœ‰ç›¸åŒçš„è¦ç¯„å¯ä»¥éµå¾ªã€‚</p></div><h1 id="CodingStyle"><a href="#CodingStyle" class="headerlink" title="CodingStyle"></a>CodingStyle</h1><p>CodingStyle å°±æ˜¯æŒ‡å¯«ä½œç¨‹å¼ç¢¼çš„é¢¨æ ¼ï¼Œå…¶ä¸­åŒ…å«å¾ˆå¤šé¢å‘ï¼Œ<br>ä¾‹å¦‚èªªæ˜¯è®Šæ•¸å‘½åæ–¹å¼ã€æ˜¯å¦æœ‰ç©ºæ ¼ã€æ˜¯å¦è¦æ›è¡Œã€è¨»è§£æ ¼å¼ã€ä¿®é£¾è©çš„é †åºç­‰ç­‰ï¼Œ<br>æœ‰æ™‚ç¨‹å¼ç¢¼çš„åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯æœƒå› ç‚ºé¢¨æ ¼çš„ä¸åŒå°è‡´çœ‹èµ·ä¾†å·®å¾ˆå¤šï¼Œåš´é‡ä¸€é»ç”šè‡³æœƒæœ‰é–±è®€ä¸Šçš„å›°é›£ï¼Œ<br>å› æ­¤å¾€å¾€æˆç†Ÿçš„åœ˜éšŠæœƒéœ€è¦è¨‚å®šä¸€å¥—è¦å‰‡ä¾†è¦ç¯„å®ƒã€‚</p><h1 id="CodingStyle-è¦å‰‡"><a href="#CodingStyle-è¦å‰‡" class="headerlink" title="CodingStyle è¦å‰‡"></a>CodingStyle è¦å‰‡</h1><p>CodingStyle è¦å‰‡å°±åƒä¸€ä»½ç©¿æ­è¦å‰‡ï¼Œå¯ä»¥è®“åœ˜éšŠè£¡çš„ç¨‹å¼ç¢¼ä¿æŒä¸‹é¢ä¸‰å€‹ç‰¹é»ã€‚</p><ol><li>å¯è®€æ€§</li><li>æ˜“ç¶­è­·</li><li>ä¸€è‡´æ€§</li></ol><p>è‡ªå·±å®šç¾©ä¸€å¥—ç©¿æ­è¦å‰‡å…¶å¯¦è »ä¸å®¹æ˜“çš„ï¼Œå› æ­¤å¯ä»¥åƒè€ƒä¸‹é¢å…©å€‹ç¶²ç«™ã€‚</p><ol><li><a href="https://www.swift.org/documentation/api-design-guidelines/">swift.org - API Design Guidelines</a><ul><li>swift å®˜æ–¹çš„ API è¨­è¨ˆæ–¹å¼ï¼Œæ¯”è¼ƒåæ¦‚å¿µæ€§</li></ul></li><li><a href="https://github.com/raywenderlich/swift-style-guide">raywenderlich - Swift Style</a><ul><li>raywenderlich å‡ºçš„ä¸€å¥— CodingStyleï¼Œç›®å‰ç®—æ˜¯é–‹æºç¤¾ç¾¤è£¡æœ€å¤šäººéµå¾ªçš„çš„ä¸€å¥—è¦å‰‡</li><li>å®šç¾©çš„è¦å‰‡ä¹Ÿç›¸ç•¶æ˜ç¢ºï¼Œæœƒè·Ÿä½ èªªä»€éº¼æ˜¯å°çš„ã€ä»€éº¼æ˜¯éŒ¯çš„</li></ul></li></ol><h1 id="CodingStyle-éœæ…‹æª¢æŸ¥å™¨"><a href="#CodingStyle-éœæ…‹æª¢æŸ¥å™¨" class="headerlink" title="CodingStyle éœæ…‹æª¢æŸ¥å™¨"></a>CodingStyle éœæ…‹æª¢æŸ¥å™¨</h1><p>æœ‰äº†ç©¿æ­è¦å‰‡é‚„éœ€è¦ä¸€ä½æœè£å¯©æ ¸å“¡å¹«æˆ‘å€‘æª¢é©—ï¼Œæª¢æŸ¥ç¨‹å¼ç¢¼æ˜¯å¦æœ‰ä¾ç…§è¦å‰‡ç©¿æ­ï¼Œ<br>æœ€å¤§çš„å¥½è™•æ˜¯å¯ä»¥è‡ªå‹•åŒ–åœ°æª¢æŸ¥å¯«ä½œé¢¨æ ¼æ˜¯å¦æ­£ç¢ºï¼Œç”šè‡³æœ‰äº›å¯ä»¥å¹«ä½ è‡ªå‹•ä¿®æ­£ã€‚</p><h2 id="SwiftLint"><a href="#SwiftLint" class="headerlink" title="SwiftLint"></a>SwiftLint</h2><p><a href="https://github.com/realm/SwiftLint">SwiftLint</a> å‰‡æ˜¯ <a href="https://github.com/realm">realm</a> å…¬å¸å‡ºçš„ä¸€æ¬¾ CodingStyle éœæ…‹æª¢æŸ¥å™¨ï¼Œ<br>é¸ç”¨æ­¤å·¥å…·åŸå› æ˜¯ç›®å‰ç†±é–€ç¨å¤§ä¸”å”¯ä¸€æŒçºŒæ›´æ–°ï¼Œ<br>è€Œä¸” SwiftLint çš„é è¨­è¦å‰‡å°±éµå¾ªå¤§éƒ¨åˆ† raywenderlich çš„ Swift Styleã€‚</p><h3 id="å®‰è£æ–¹å¼"><a href="#å®‰è£æ–¹å¼" class="headerlink" title="å®‰è£æ–¹å¼"></a>å®‰è£æ–¹å¼</h3><ol><li><p>åœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥ä¸‹æ–¹æŒ‡ä»¤ï¼Œå°ˆæ¡ˆåˆå§‹åŒ–pod (è«‹äº‹å…ˆé›»è…¦å®‰è£é CocoaPods)</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod init</span><br></pre></td></tr></table></figure></li><li><p>è¨­å®š PodFileï¼Œé–‹å•Ÿå°ˆæ¡ˆå…§çš„ PodFile æª”æ¡ˆåŠ å…¥ä¸‹é¢ç¨‹å¼ç¢¼</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">&#x27;SwiftLint&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>åœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥ä¸‹æ–¹æŒ‡ä»¤ï¼Œå®‰è£ä¸‰æ–¹</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod install</span><br></pre></td></tr></table></figure></li><li><p>è¨­å®š Build Phasesï¼Œé–‹å•Ÿå°ˆæ¡ˆå…§è¨­å®šBuild Phases &gt; æŒ‰ â€œï¼‹â€ &gt; RunScript &gt; è¼¸å…¥ä¸‹æ–¹è…³æœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;$&#123;PODS_ROOT&#125;/SwiftLint/swiftlint&quot; lint</span><br></pre></td></tr></table></figure></li></ol><h3 id="åŸ·è¡Œæ–¹æ³•"><a href="#åŸ·è¡Œæ–¹æ³•" class="headerlink" title="åŸ·è¡Œæ–¹æ³•"></a>åŸ·è¡Œæ–¹æ³•</h3><p>ç›´æ¥æŒ‰ä¸‹ç·¨è­¯å³å¯ï¼</p><img src="/pinkblog/2022/02/01/SwiftLint-%E9%9D%9C%E6%85%8B%E6%AA%A2%E6%9F%A5%E5%99%A8/1.png" class="" width="800"><h3 id="ç¦ç”¨è¦å‰‡"><a href="#ç¦ç”¨è¦å‰‡" class="headerlink" title="ç¦ç”¨è¦å‰‡"></a>ç¦ç”¨è¦å‰‡</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// swiftlint:disable colon</span></span><br><span class="line"><span class="keyword">let</span> noWarning :<span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span> <span class="comment">// æˆ‘è¢«è·³éäº†</span></span><br><span class="line"><span class="comment">// swiftlint:enable colon</span></span><br><span class="line"><span class="keyword">let</span> hasWarning :<span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span> <span class="comment">// æˆ‘è¢«ç¦æ­¢äº†</span></span><br></pre></td></tr></table></figure><h3 id="è¦å‰‡æ¸…å–®"><a href="#è¦å‰‡æ¸…å–®" class="headerlink" title="è¦å‰‡æ¸…å–®"></a>è¦å‰‡æ¸…å–®</h3><p>ä¸‹é¢é€£çµçš„æ¯ä¸€æ¢éƒ½æ˜¯ä¸€æ¢è¦å‰‡ï¼Œæœ‰äº›æ˜¯é è¨­æœ‰ã€æœ‰äº›æ˜¯é è¨­æ²’æœ‰ï¼Œ<br>ä¸¦ä¸”æ¯ä¸€æ¢éƒ½æœ‰è©³ç´°çš„ç¯„ä¾‹èªªæ˜æ€æ¨£æ˜¯æ­£ç¢ºçš„ã€æ€æ¨£æ˜¯éŒ¯èª¤çš„ã€‚</p><p><a href="https://realm.github.io/SwiftLint/rule-directory.html">Rule Directory</a></p><h3 id="å®¢è£½åŒ–è¦å‰‡"><a href="#å®¢è£½åŒ–è¦å‰‡" class="headerlink" title="å®¢è£½åŒ–è¦å‰‡"></a>å®¢è£½åŒ–è¦å‰‡</h3><p>ç•¶ç„¶æœ‰æ™‚å€™æœƒéœ€è¦èª¿æ•´æˆé©åˆåœ˜éšŠçš„è¦ç¯„ï¼Œè«‹å…ˆä¾ç…§ä¸‹é¢æ­¥é©Ÿèª¿æ•´ Configï¼Œ<br>æœ€å¾Œç´°éƒ¨èª¿æ•´ Config æª”æ¡ˆå…§çš„è¦å‰‡å³å¯ã€‚</p><ol><li><p>èª¿æ•´ Build Phases</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;$&#123;PODS_ROOT&#125;/SwiftLint/swiftlint&quot; lint --config &quot;$&#123;SRCROOT&#125;/swiftlint.yml&quot;</span><br></pre></td></tr></table></figure></li><li><p>æ”¾å…¥è¦å‰‡è¨­å®šæª”ï¼Œæ”¾åœ¨å°ˆæ¡ˆçš„æ ¹ç›®éŒ„ï¼Œå«åšâ€swiftlint.ymlâ€</p></li><li><p>ä¸€æ¨£ç›´æ¥æŒ‰ä¸‹ç·¨è­¯å³å¯ï¼</p></li></ol><img src="/pinkblog/2022/02/01/SwiftLint-%E9%9D%9C%E6%85%8B%E6%AA%A2%E6%9F%A5%E5%99%A8/2.png" class="" width="800"><h3 id="å®¢è£½åŒ–è¦å‰‡ç¯„ä¾‹"><a href="#å®¢è£½åŒ–è¦å‰‡ç¯„ä¾‹" class="headerlink" title="å®¢è£½åŒ–è¦å‰‡ç¯„ä¾‹"></a>å®¢è£½åŒ–è¦å‰‡ç¯„ä¾‹</h3><p>Swiftlint çš„å®¢è£½åŒ–è¦å‰‡æ˜¯éå¸¸å½ˆæ€§çš„ï¼Œ<br>å¯ä»¥é–‹å•Ÿæˆ–é—œé–‰æŸäº›è¦å‰‡ï¼Œ<br>ç”šè‡³å¯ä»¥ç”¨æ­£è¦è¡¨é”å¼å®šç¾©å…¨æ–°çš„è¦å‰‡ï¼Œ<br>ç™¼ç”Ÿä¸ç¬¦åˆè¦å‰‡è¦è§¸ç™¼â€warningâ€æˆ–æ˜¯â€errorâ€ä¹Ÿå¯ä»¥è‡ªç”±æ±ºå®šï¼Œ<br>ä¹Ÿå¯ä»¥è·³éå›ºå®šçš„è·¯å¾‘çš„æª¢æŸ¥ï¼Œä¾‹å¦‚ Pods è£¡çš„ä¸‰æ–¹æª”æ¡ˆï¼Œé¿å…æµªè²»æª¢æŸ¥æ•ˆèƒ½ï¼Œ<br>æœ€å¾Œé€£å ±éŒ¯çš„æ–¹å¼ä¹Ÿæä¾›å¾ˆå¤šç¨®ï¼Œä¾‹å¦‚ xcode, json â€¦ ç­‰ç­‰æ”¯æ´å„å¼å„æ¨£çš„å ±å‘Šã€‚</p><p>é€™è£¡æœ‰ä¸€å€‹å®Œæ•´ç¯„ä¾‹å¯ä»¥åƒè€ƒï¼š<a href="https://github.com/pinkpika/SwiftLintDemo/blob/main/swiftlint.yml">swiftlint.yml</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸å•Ÿç”¨çš„è¦å‰‡</span></span><br><span class="line"><span class="attr">disabled_rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å•Ÿç”¨çš„è¦å‰‡</span></span><br><span class="line"><span class="attr">opt_in_rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¢è£½åŒ–çš„è¦å‰‡</span></span><br><span class="line"><span class="attr">custom_rules:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸ·è¡ŒlintingåŒ…å«çš„è·¯å¾‘</span></span><br><span class="line"><span class="attr">included:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸ·è¡Œlintingå¿½ç•¥çš„è·¯å¾‘(å„ªå…ˆåº¦å¤§æ–¼included)</span></span><br><span class="line"><span class="attr">excluded:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å ±éŒ¯é¡å‹</span></span><br><span class="line"><span class="attr">reporter:</span> <span class="string">&quot;xcode&quot;</span></span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–å·¥å…·"><a href="#å…¶ä»–å·¥å…·" class="headerlink" title="å…¶ä»–å·¥å…·"></a>å…¶ä»–å·¥å…·</h2><ul><li><a href="https://github.com/sleekbyte/tailor">tailor</a>ï¼šå¦ä¸€å¥—éœæ…‹æª¢æŸ¥å™¨<ul><li>ä½†æœ‰å€‹åš´é‡å•é¡Œï¼Œç›®å‰åªæ”¯æ´åˆ°Swift3.0ï¼Œç„¡äººæ›´æ–°â€¦</li></ul></li><li><a href="https://github.com/nicklockwood/SwiftFormat">SwiftFormat</a>ï¼šå¼·åˆ¶æ ¼å¼åŒ–çš„å·¥å…·<ul><li>å°šæœªæ·±å…¥ç ”ç©¶ï¼Œä½†èƒ½è¨­å®šçš„æ¢ä»¶ä¸å¤ å¤šã€‚</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note default flat&quot;&gt;&lt;p&gt;æœ¬ç¯‡æœƒä»‹ç´¹ Coding Style èˆ‡ iOS å¹³å°ä¸Šæœ€æ´»èºçš„éœæ…‹æª¢æŸ¥å™¨ SwiftLintï¼Œ&lt;br&gt;å¯ä»¥å¹«åŠ©ä½ çš„ç¨‹å¼ç¢¼ä¿æŒä¸€è‡´çš„é¢¨æ ¼ï¼Œä¸¦ä¸”è®“åœ˜éšŠæœ‰ç›¸åŒçš„è¦ç¯„å¯ä»¥éµå¾ªã€‚&lt;/p&gt;
&lt;/div&gt;

&lt;h1 id=&quot;</summary>
      
    
    
    
    <category term="iOS Development" scheme="http://pinkpika.github.io/pinkblog/categories/iOS-Development/"/>
    
    
    <category term="iOS" scheme="http://pinkpika.github.io/pinkblog/tags/iOS/"/>
    
    <category term="CodingStyle" scheme="http://pinkpika.github.io/pinkblog/tags/CodingStyle/"/>
    
  </entry>
  
  <entry>
    <title>DispatchQueue çš„ç°¡å–®æ‡‰ç”¨</title>
    <link href="http://pinkpika.github.io/pinkblog/2022/01/26/DispatchQueue-%E7%9A%84%E7%B0%A1%E5%96%AE%E6%87%89%E7%94%A8/"/>
    <id>http://pinkpika.github.io/pinkblog/2022/01/26/DispatchQueue-%E7%9A%84%E7%B0%A1%E5%96%AE%E6%87%89%E7%94%A8/</id>
    <published>2022-01-26T06:23:27.000Z</published>
    <updated>2022-02-17T18:17:52.736Z</updated>
    
    <content type="html"><![CDATA[<div class="note default flat"><p>æœ¬ç¯‡å…§å®¹ä»¥éå¸¸åˆéšçš„æ–¹å¼ä»‹ç´¹ DispatchQueueï¼Œ<br>åŒæ™‚æœƒèªªæ˜ iOS é«”ç³»è£¡æœ€æµè¡Œçš„å¤šç·’è™•ç†çš„æŠ€è¡“ GCD å’Œä¸€äº›æ‡‰ç”¨æƒ…å¢ƒå’Œç¯„ä¾‹ï¼Œ<br>å¾Œä¾†ä¹Ÿæœ‰ç”¨åœ¨å…¬å¸åŸ¹è¨“åˆæ¬¡æ¥è§¸ iOS å·¥ç¨‹å¸«çš„ä¸€æ®µèª²ç¨‹è£¡ã€‚</p></div><div class="note warning flat"><p>ä¸éæœ¬ç¯‡çš„ä¸»é¡Œä¸æ˜¯æœ€æ–° Swift 5.5 çš„ async/awaitï¼Œå°‡æœƒè‘—é‡åœ¨ GCD çš„ DispatchQueue</p></div><h1 id="æåŠ-DispatchQueue-å‰ï¼Œå…ˆéœ€è¦çŸ¥é“å¤šåŸ·è¡Œç·’çš„æ‡‰ç”¨ç¨‹å¼å¦‚ä½•é‹ä½œçš„ï¼Ÿ"><a href="#æåŠ-DispatchQueue-å‰ï¼Œå…ˆéœ€è¦çŸ¥é“å¤šåŸ·è¡Œç·’çš„æ‡‰ç”¨ç¨‹å¼å¦‚ä½•é‹ä½œçš„ï¼Ÿ" class="headerlink" title="æåŠ DispatchQueue å‰ï¼Œå…ˆéœ€è¦çŸ¥é“å¤šåŸ·è¡Œç·’çš„æ‡‰ç”¨ç¨‹å¼å¦‚ä½•é‹ä½œçš„ï¼Ÿ"></a>æåŠ DispatchQueue å‰ï¼Œå…ˆéœ€è¦çŸ¥é“å¤šåŸ·è¡Œç·’çš„æ‡‰ç”¨ç¨‹å¼å¦‚ä½•é‹ä½œçš„ï¼Ÿ</h1><img src="/pinkblog/2022/01/26/DispatchQueue-%E7%9A%84%E7%B0%A1%E5%96%AE%E6%87%89%E7%94%A8/1.png" class="" width="400"><ul><li>Program: <ul><li>æ‡‰ç”¨ç¨‹å¼æœ¬èº«</li></ul></li><li>Process: <ul><li>é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼å¾Œçš„å¯¦é«”</li><li>æ¯å€‹ Process éƒ½æ˜¯ç¨ç«‹çš„ï¼Œç„¡æ³•è‡ªç”±è®€å–å…¶ä»– Process çš„è³‡æº</li><li>åƒæ˜¯è£æœ‰ Thread çš„å®¹å™¨</li></ul></li><li>Thread: <ul><li>æ¯å€‹ Process æœƒæœ‰ç®¡ç†å¤šå€‹ Thread</li><li>åŒä¸€å€‹ Process åº•ä¸‹çš„  Thread å°±å¯ä»¥å­˜å–ç›¸åŒè³‡æº (ä¾‹å¦‚è¨˜æ†¶é«”è®Šæ•¸ç­‰ç­‰)</li><li>å¤šåŸ·è¡Œç·’è™•ç†éœ€è¦éå¸¸ç´°å¾®çš„æ“ä½œï¼Œå®¹æ˜“ç™¼ç”Ÿäº’æ¶è³‡æºï¼Œæ­»çµ DeadLock çš„å•é¡Œ</li></ul></li><li>Core: <ul><li>å°±æ˜¯ç¡¬é«”ä¸Šçš„æ ¸å¿ƒï¼Œé€šå¸¸æ˜¯å¤šæ ¸å¿ƒè™•ç†</li><li>ä¸€å€‹ Core é€šå¸¸åŒä¸€æ™‚é–“åªèƒ½è™•ç†ä¸€å€‹ Thread (é‚„æ˜¯æœ‰äº›ä¾‹å¤–åƒæ˜¯ Hyper-Threading)</li></ul></li></ul><img src="/pinkblog/2022/01/26/DispatchQueue-%E7%9A%84%E7%B0%A1%E5%96%AE%E6%87%89%E7%94%A8/2.png" class="" width="800"><div class="note info flat"><p>å¤šåŸ·è¡Œç·’ç¨‹å¼ç¢¼å¯ä»¥åŒæ™‚é–“è™•ç†å¤šé …ä»»å‹™ï¼Œç„¶è€Œè™•ç†å¤šé …ä»»å‹™å°±æ˜¯éœ€è¦æ“ä½œ Thread</p></div><h1 id="iOS-çš„å¤šç·’é–‹ç™¼æ–¹å¼"><a href="#iOS-çš„å¤šç·’é–‹ç™¼æ–¹å¼" class="headerlink" title="iOS çš„å¤šç·’é–‹ç™¼æ–¹å¼"></a>iOS çš„å¤šç·’é–‹ç™¼æ–¹å¼</h1><ol><li><p>ç¬¬ä¸€ç¨®ï¼š<a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/CreatingThreads/CreatingThreads.html">Threading Programming Guide</a><br>è‡ªè¡Œå»ºç«‹ NSThread ä¸¦ä¸”éœ€è¦è‡ªè¡Œç®¡ç† Autorelease Pool<br>éœ€è¦å®šç¾© Atomic è®Šæ•¸æˆ–æ˜¯è‡ªè¡Œç®¡ç† NSLock ä¾†è™•ç†åŒæ­¥å•é¡Œ </p></li><li><p>ç¬¬äºŒç¨®ï¼š<a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html">Concurrency Programming Guide</a><br>åç‚º Grand Central Dispatch ( GCD )<br>æ¶ˆé™¤å»ºç«‹èˆ‡ç®¡ç† Thread æ‰€éœ€ç¨‹å¼ç¢¼ï¼Œåƒ…éœ€å®šç¾©ä»»å‹™ï¼Œè®“ç³»çµ±è‡ªè¡Œç®¡ç†æ’ç¨‹<br>å¯ä»¥é«˜æ•ˆç©©å®šåœ°é¿å…åŒæ­¥å’Œ DeadLock å•é¡Œ</p></li><li><p>ç¬¬ä¸‰ç¨®ï¼š<a href="https://developer.apple.com/documentation/swift/swift_standard_library/concurrency/updating_an_app_to_use_swift_concurrency">Swift Concurrency</a><br>æœ€æ–°çš„ Swift 5.5 æä¾›äº†æ›´ç›´è§€ã€æ›´å®‰å…¨çš„å¯«æ³•<br>åŒ…å« async/awaitã€Actor ç­‰ç­‰å¥½ç”¨çš„èªæ³•</p></li></ol><h1 id="Grand-Central-Dispatch-GCD"><a href="#Grand-Central-Dispatch-GCD" class="headerlink" title="Grand Central Dispatch ( GCD )"></a>Grand Central Dispatch ( GCD )</h1><p>ç›®å‰æä¾›äº†ä¸‰ç¨®æ–¹æ³•è™•ç†å¤šåŸ·è¡Œç·’</p><ol><li>ç¬¬ä¸€ç¨®ï¼šDispatch Queues<ul><li>åˆ©ç”¨ DispatchQueueï¼Œå¯ä»¥è¼•é¬†é”åˆ° asynchronously ç•°æ­¥å’Œ concurrently ä¸¦ç™¼çš„æ–¹å¼ï¼Œè™•ç†ä½ çš„å·¥ä½œ</li><li>ä¾ç…§å…ˆå‡ºåŸå‰‡ç®¡ç†</li></ul></li><li>ç¬¬äºŒç¨®ï¼šDispatch Sources<ul><li>å¯ä»¥è™•ç† Dispatch çš„åº•å±¤ç³»çµ±äº‹ä»¶çš„é€šçŸ¥</li></ul></li><li>ç¬¬ä¸‰ç¨®ï¼šOperation Queues<ul><li>é è¨­ä¸¦è¡Œæ–¹å¼ï¼Œä¸ä¾ç…§å…ˆé€²å…ˆå‡ºåŸå‰‡ï¼Œæ ¹æ“šå„ªå…ˆé †åºæ±ºå®š</li></ul></li></ol><h1 id="DispatchQueue-çš„å»ºç«‹èˆ‡ç™¼å‹•"><a href="#DispatchQueue-çš„å»ºç«‹èˆ‡ç™¼å‹•" class="headerlink" title="DispatchQueue çš„å»ºç«‹èˆ‡ç™¼å‹•"></a>DispatchQueue çš„å»ºç«‹èˆ‡ç™¼å‹•</h1><h3 id="å»ºç«‹æ–¹å¼æœ‰å…©ç¨®"><a href="#å»ºç«‹æ–¹å¼æœ‰å…©ç¨®" class="headerlink" title="å»ºç«‹æ–¹å¼æœ‰å…©ç¨®"></a>å»ºç«‹æ–¹å¼æœ‰å…©ç¨®</h3><img src="/pinkblog/2022/01/26/DispatchQueue-%E7%9A%84%E7%B0%A1%E5%96%AE%E6%87%89%E7%94%A8/3.png" class="" width="400"><ol><li>Serialï¼šä¸²è¡Œçš„æ–¹å¼åŸ·è¡Œå·¥ä½œï¼Œä¸€æ¬¡åªèƒ½åŸ·è¡Œä¸€é …ä»»å‹™</li><li>Concurrentï¼šä¸¦ç™¼çš„æ–¹å¼åŸ·è¡Œå·¥ä½œï¼Œå¯ä»¥åŒæ™‚åŸ·è¡Œå¤šé …ä»»å‹™</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šåç¨±å¯ç”¨æ–¼å–å¾—ç›¸åŒ Queue æˆ–æ˜¯é¿å…è¡çª</span></span><br><span class="line"><span class="keyword">let</span> serialQueue <span class="operator">=</span> <span class="type">DispatchQueue</span>(label: <span class="string">&quot;serialQueue&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> concurrentQueue <span class="operator">=</span> <span class="type">DispatchQueue</span>(label: <span class="string">&quot;concurrentQueue&quot;</span>, attributes: .concurrent)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åŸ·è¡Œå‘¼å«å‡ºç³»çµ±é è¨­çš„ DispatchQueue</p><ol><li>DispatchQueue.main<ul><li>å±¬æ–¼ Serial æ–¹å¼</li><li>å…¨åŸŸå¯ä»¥æ“ä½œçš„ä¸»è¦ Queue</li><li>UIç›¸é—œçš„æ“ä½œå¿…é ˆè¦åœ¨é€™è£¡æ“ä½œ</li></ul></li><li>DispatchQueue.global<ul><li>å±¬æ–¼ Concurrent æ–¹å¼</li><li>é©åˆåœ¨èƒŒæ™¯è™•ç†å¤§é‡è¨ˆç®—</li></ul></li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mainQueue <span class="operator">=</span> <span class="type">DispatchQueue</span>.main <span class="comment">//&lt;â€”â€”- ç‚º serial</span></span><br><span class="line"><span class="keyword">let</span> globalQueue <span class="operator">=</span> <span class="type">DispatchQueue</span>.global() <span class="comment">//&lt;â€”â€”- ç‚º concurrent</span></span><br></pre></td></tr></table></figure><h3 id="ç™¼å‹•æ–¹å¼æœ‰å…©ç¨®"><a href="#ç™¼å‹•æ–¹å¼æœ‰å…©ç¨®" class="headerlink" title="ç™¼å‹•æ–¹å¼æœ‰å…©ç¨®"></a>ç™¼å‹•æ–¹å¼æœ‰å…©ç¨®</h3><ol><li>Synchronously åŒæ­¥ç™¼å‹•ï¼šç™¼å‹•å·¥ä½œå¾Œï¼Œå¿…é ˆåŸ·è¡Œå®Œæˆå·¥ä½œï¼Œæ‰èƒ½å¾€ä¸‹åŸ·è¡Œ<ul><li><code>queue.sync &#123; å®šç¾©ä½ è¦åšçš„å·¥ä½œ &#125;</code></li></ul></li><li>Asynchronously ç•°æ­¥ç™¼å‹•ï¼šç™¼å‹•å·¥ä½œå¾Œï¼Œç›´æ¥åŸ·è¡Œå¾ŒçºŒå‹•ä½œ<ul><li><code>queue.async &#123; å®šç¾©ä½ è¦åšçš„å·¥ä½œ &#125;</code></li></ul></li></ol><h1 id="DispatchQueue-çµ„åˆé‹ç”¨ç¯„ä¾‹"><a href="#DispatchQueue-çµ„åˆé‹ç”¨ç¯„ä¾‹" class="headerlink" title="DispatchQueue çµ„åˆé‹ç”¨ç¯„ä¾‹"></a>DispatchQueue çµ„åˆé‹ç”¨ç¯„ä¾‹</h1><div class="note success flat"><p>é—œéµåˆ¤æ–·æ–¹å¼:<br>    - æ±ºå®š Closure è£¡é¢å¯ä¸å¯ä»¥åŸ·è¡Œçœ‹ Serial vs Concurrent<br>    - æ±ºå®šå¾ŒçºŒæ˜¯å¦ç›´æ¥åŸ·è¡Œçœ‹ Sync vs Async</p></div><img src="/pinkblog/2022/01/26/DispatchQueue-%E7%9A%84%E7%B0%A1%E5%96%AE%E6%87%89%E7%94%A8/4.png" class="" width="800"><div class="tabs" id="dispatchqueue"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#dispatchqueue-1">Serial+Sync</button></li><li class="tab"><button type="button" data-href="#dispatchqueue-2">Serial+Async</button></li><li class="tab"><button type="button" data-href="#dispatchqueue-3">Concurrent+Sync</button></li><li class="tab"><button type="button" data-href="#dispatchqueue-4">Concurrent+Async</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="dispatchqueue-1"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> serialQueue <span class="operator">=</span> <span class="type">DispatchQueue</span>(label: <span class="string">&quot;serialQueue&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">serialQueue.sync &#123;</span><br><span class="line">    (<span class="number">1</span> <span class="operator">...</span> <span class="number">5</span>).forEach&#123; <span class="built_in">print</span>(<span class="string">&quot;i: &quot;</span> <span class="operator">+</span> <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line">serialQueue.sync &#123;</span><br><span class="line">    (<span class="number">1</span> <span class="operator">...</span> <span class="number">5</span>).forEach&#123; <span class="built_in">print</span>(<span class="string">&quot;j: &quot;</span> <span class="operator">+</span> <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;end&quot;</span>)</span><br></pre></td></tr></table></figure><p>ç”±æ–¼åŸ·è¡Œ sync æ‰€ä»¥ Closure1 å…§è¦å…ˆåŸ·è¡Œå®Œæˆï¼Œæ‰å¯ä»¥å¾€ä¸‹èµ°<br>start &gt; Closure1 &gt; Closure2 &gt; end</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">start</span><br><span class="line">i: 1</span><br><span class="line">i: 2</span><br><span class="line">i: 3</span><br><span class="line">i: 4</span><br><span class="line">i: 5</span><br><span class="line">j: 1</span><br><span class="line">j: 2</span><br><span class="line">j: 3</span><br><span class="line">j: 4</span><br><span class="line">j: 5</span><br><span class="line">end</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dispatchqueue-2"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> serialQueue <span class="operator">=</span> <span class="type">DispatchQueue</span>(label: <span class="string">&quot;serialQueue&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">serialQueue.async &#123;</span><br><span class="line">    (<span class="number">1</span> <span class="operator">...</span> <span class="number">5</span>).forEach&#123; <span class="built_in">print</span>(<span class="string">&quot;i: &quot;</span> <span class="operator">+</span> <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line">serialQueue.async &#123;</span><br><span class="line">    (<span class="number">1</span> <span class="operator">...</span> <span class="number">5</span>).forEach&#123; <span class="built_in">print</span>(<span class="string">&quot;j: &quot;</span> <span class="operator">+</span> <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;end&quot;</span>)</span><br></pre></td></tr></table></figure><p>ç”±æ–¼åŸ·è¡Œ async æ‰€ä»¥å¯ä»¥é€£çºŒåŸ·è¡Œåˆ°ä¸‹ä¸€å€‹ async å’Œæœ€å¾Œä¸€å€‹ print endï¼Œ<br>ä½†å› ç‚ºæ˜¯ serialQueueï¼Œæ‰€ä»¥å°è‡´å…ˆåŸ·è¡Œå®Œç¬¬ä¸€å€‹ Closure1 æ‰èƒ½åŸ·è¡Œ Closure2</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">start</span><br><span class="line">end</span><br><span class="line">i: 1</span><br><span class="line">i: 2</span><br><span class="line">i: 3</span><br><span class="line">i: 4</span><br><span class="line">i: 5</span><br><span class="line">j: 1</span><br><span class="line">j: 2</span><br><span class="line">j: 3</span><br><span class="line">j: 4</span><br><span class="line">j: 5</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dispatchqueue-3"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> concurrentQueue <span class="operator">=</span> <span class="type">DispatchQueue</span>(label: <span class="string">&quot;concurrentQueue&quot;</span>, attributes: .concurrent)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">concurrentQueue.sync &#123;</span><br><span class="line">    (<span class="number">1</span> <span class="operator">...</span> <span class="number">5</span>).forEach&#123; <span class="built_in">print</span>(<span class="string">&quot;i: &quot;</span> <span class="operator">+</span> <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line">concurrentQueue.sync &#123;</span><br><span class="line">    (<span class="number">1</span> <span class="operator">...</span> <span class="number">5</span>).forEach&#123; <span class="built_in">print</span>(<span class="string">&quot;j: &quot;</span> <span class="operator">+</span> <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;end&quot;</span>)</span><br></pre></td></tr></table></figure><p>ç”±æ–¼åŸ·è¡Œ sync æ‰€ä»¥ Closure1 å…§è¦å…ˆåŸ·è¡Œå®Œæˆï¼Œæ‰å¯ä»¥å¾€ä¸‹èµ°<br>æ‰€ä»¥å°±ç®—æ˜¯ concurrentQueue ä¹Ÿä¸€æ¨£</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">start</span><br><span class="line">i: 1</span><br><span class="line">i: 2</span><br><span class="line">i: 3</span><br><span class="line">i: 4</span><br><span class="line">i: 5</span><br><span class="line">j: 1</span><br><span class="line">j: 2</span><br><span class="line">j: 3</span><br><span class="line">j: 4</span><br><span class="line">j: 5</span><br><span class="line">end</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="dispatchqueue-4"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> concurrentQueue <span class="operator">=</span> <span class="type">DispatchQueue</span>(label: <span class="string">&quot;concurrentQueue&quot;</span>, attributes: .concurrent)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">concurrentQueue.async &#123;</span><br><span class="line">    (<span class="number">1</span> <span class="operator">...</span> <span class="number">5</span>).forEach&#123; <span class="built_in">print</span>(<span class="string">&quot;i: &quot;</span> <span class="operator">+</span> <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line">concurrentQueue.async &#123;</span><br><span class="line">    (<span class="number">1</span> <span class="operator">...</span> <span class="number">5</span>).forEach&#123; <span class="built_in">print</span>(<span class="string">&quot;j: &quot;</span> <span class="operator">+</span> <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;end&quot;</span>)</span><br></pre></td></tr></table></figure><p>ç”±æ–¼åŸ·è¡Œ async æ‰€ä»¥å¯ä»¥é€£çºŒåŸ·è¡Œåˆ°ä¸‹ä¸€å€‹ async å’Œæœ€å¾Œä¸€å€‹ print endï¼Œ<br>ä¸¦ä¸”å› ç‚ºæ˜¯ concurrentQueue æ‰€ä»¥ Closure1 å’Œ Closure2 æ˜¯åŒæ™‚é€²è¡Œçš„ã€‚</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">start</span><br><span class="line">end</span><br><span class="line">j: 1</span><br><span class="line">i: 1</span><br><span class="line">j: 2</span><br><span class="line">i: 2</span><br><span class="line">j: 3</span><br><span class="line">i: 3</span><br><span class="line">j: 4</span><br><span class="line">i: 4</span><br><span class="line">j: 5</span><br><span class="line">i: 5</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><hr><h1 id="ç‚ºä»€éº¼-async-çš„ç™¼å‹•æ–¹å¼å¯ä»¥é€£çºŒåŸ·è¡Œå¾ŒçºŒçš„ç¨‹å¼ç¢¼å‘¢ï¼Ÿ"><a href="#ç‚ºä»€éº¼-async-çš„ç™¼å‹•æ–¹å¼å¯ä»¥é€£çºŒåŸ·è¡Œå¾ŒçºŒçš„ç¨‹å¼ç¢¼å‘¢ï¼Ÿ" class="headerlink" title="ç‚ºä»€éº¼ async çš„ç™¼å‹•æ–¹å¼å¯ä»¥é€£çºŒåŸ·è¡Œå¾ŒçºŒçš„ç¨‹å¼ç¢¼å‘¢ï¼Ÿ"></a>ç‚ºä»€éº¼ async çš„ç™¼å‹•æ–¹å¼å¯ä»¥é€£çºŒåŸ·è¡Œå¾ŒçºŒçš„ç¨‹å¼ç¢¼å‘¢ï¼Ÿ</h1><p>åŸå› æ˜¯å› ç‚º async æœƒç‰¹åˆ¥å»ºç«‹æ–°çš„ thread ä¾†è™•ç† async è£¡çš„å·¥ä½œï¼Œ<br>å› æ­¤ç•¶å‰çš„åŸ·è¡Œç·’å¯ä»¥ç¹¼çºŒåŸ·è¡Œå¾ŒçºŒçš„ç¨‹å¼ç¢¼ã€‚</p><img src="/pinkblog/2022/01/26/DispatchQueue-%E7%9A%84%E7%B0%A1%E5%96%AE%E6%87%89%E7%94%A8/5.png" class="" width="800"><hr><div class="note info flat"><p>çŸ¥é“ä¸Šé¢é‚£äº›çµ„åˆï¼Œé‚£ä»–çš„æ‡‰ç”¨æƒ…å¢ƒåˆ°åº•æ˜¯å“ªè£¡ï¼Ÿ</p></div><hr><h1 id="DispatchQueue-æ‡‰ç”¨æƒ…å¢ƒ"><a href="#DispatchQueue-æ‡‰ç”¨æƒ…å¢ƒ" class="headerlink" title="DispatchQueue æ‡‰ç”¨æƒ…å¢ƒ"></a>DispatchQueue æ‡‰ç”¨æƒ…å¢ƒ</h1><h2 id="æƒ…å¢ƒä¸€ï¼šè™•ç†å¤§é‡è³‡æ–™"><a href="#æƒ…å¢ƒä¸€ï¼šè™•ç†å¤§é‡è³‡æ–™" class="headerlink" title="æƒ…å¢ƒä¸€ï¼šè™•ç†å¤§é‡è³‡æ–™"></a>æƒ…å¢ƒä¸€ï¼šè™•ç†å¤§é‡è³‡æ–™</h2><p>é€šå¸¸ä¸å¸Œæœ›è™•ç†å¤§é‡è³‡æ–™æ™‚æœƒå¡ä½ä½¿ç”¨è€…ç•«é¢ï¼Œæ‰€ä»¥éœ€è¦åœ¨èƒŒæ™¯åŸ·è¡Œå·¥ä½œã€‚<br>å¯ä»¥ä½¿ç”¨ <code>DispatchQueue.global().async</code>ï¼Œ<br>ä½†è¨˜å¾—è¦å› main thread æ‰èƒ½æ›´æ–°ç•«é¢ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleBigData</span>()</span>&#123;</span><br><span class="line">    <span class="type">DispatchQueue</span>.global().async &#123;</span><br><span class="line">        <span class="keyword">var</span> total <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">...</span><span class="number">1000000</span>&#123;</span><br><span class="line">            total <span class="operator">+=</span> i</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Done BigData <span class="subst">\(total)</span>&quot;</span>)</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Update UI on main thread.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æƒ…å¢ƒäºŒï¼šå‘¼å«API"><a href="#æƒ…å¢ƒäºŒï¼šå‘¼å«API" class="headerlink" title="æƒ…å¢ƒäºŒï¼šå‘¼å«API"></a>æƒ…å¢ƒäºŒï¼šå‘¼å«API</h2><p>æœ€å¸¸ä½¿ç”¨çš„ API ä¸‰æ–¹ Alamofire å¹«æˆ‘å€‘è™•ç†å¥½äº†ï¼Œ<br>å‘¼å« API å‰ä¸‰æ–¹å…§éƒ¨æœƒç”¨ async è®“ç•«é¢ä¸æœƒå¡ï¼Œ<br>åŒæ™‚é è¨­å›æ‡‰æ˜¯å› main queue (ä¹Ÿå¯ä»¥è‡ªè¡Œè¨­å®š queue)ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleCallApi</span>()</span>&#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://httpbin.org/get&quot;</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="type">AF</span>.request(url).response&#123;</span><br><span class="line">        response <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Done CallApi url <span class="subst">\(response)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æƒ…å¢ƒä¸‰ï¼šå¤šé“APIä¸¦è¡Œå‘¼å«ï¼Œå…¨éƒ¨å®Œæˆæ™‚è¦åšçµ±ä¸€è™•ç†"><a href="#æƒ…å¢ƒä¸‰ï¼šå¤šé“APIä¸¦è¡Œå‘¼å«ï¼Œå…¨éƒ¨å®Œæˆæ™‚è¦åšçµ±ä¸€è™•ç†" class="headerlink" title="æƒ…å¢ƒä¸‰ï¼šå¤šé“APIä¸¦è¡Œå‘¼å«ï¼Œå…¨éƒ¨å®Œæˆæ™‚è¦åšçµ±ä¸€è™•ç†"></a>æƒ…å¢ƒä¸‰ï¼šå¤šé“APIä¸¦è¡Œå‘¼å«ï¼Œå…¨éƒ¨å®Œæˆæ™‚è¦åšçµ±ä¸€è™•ç†</h2><p>å¤šé“APIå‘¼å«å¾Œçš„çµæœï¼Œå¯èƒ½éœ€è¦æœ€å¾Œåšä¸€å€‹çµ±æ•´çš„è™•ç†ï¼Œæœ€å¾Œæ‰èƒ½æ›´æ–°ç•«é¢ã€‚</p><p>å¯ä»¥åˆ©ç”¨ group(enter+leave+notify)ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleMergeApi</span>()</span>&#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url1 <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://httpbin.org/get?data=1&quot;</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url2 <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://httpbin.org/get?data=2&quot;</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> group <span class="operator">=</span> <span class="type">DispatchGroup</span>()</span><br><span class="line">    group.enter()</span><br><span class="line">    <span class="type">AF</span>.request(url1).response&#123;</span><br><span class="line">        response <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Done MergeApi url1 <span class="subst">\(response)</span>&quot;</span>)</span><br><span class="line">        group.leave()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    group.enter()</span><br><span class="line">    <span class="type">AF</span>.request(url2).response&#123;</span><br><span class="line">        response <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Done MergeApi url2 <span class="subst">\(response)</span>&quot;</span>)</span><br><span class="line">        group.leave()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    group.notify(queue: .main) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Done MergeApi&quot;</span>)</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Merge Data or Update UI on main thread.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æƒ…å¢ƒå››ï¼šä¸€é“ä¸€é“å‘¼å«API"><a href="#æƒ…å¢ƒå››ï¼šä¸€é“ä¸€é“å‘¼å«API" class="headerlink" title="æƒ…å¢ƒå››ï¼šä¸€é“ä¸€é“å‘¼å«API"></a>æƒ…å¢ƒå››ï¼šä¸€é“ä¸€é“å‘¼å«API</h2><p>ç”±æ–¼ Alamofire é è¨­æ˜¯ async ä¸¦è¡Œç™¼é€ï¼Œ<br>è¦åšä¸€é»è™•ç†æ‰èƒ½ä¸€é“APIå®Œæˆå¾Œï¼Œå†å‘¼å«ä¸‹ä¸€é“APIã€‚</p><p>å¯ä»¥åˆ©ç”¨ group(enter+leave+wait)ï¼Œä½†åˆ‡è¨˜ wait ä¸å¯ä»¥åœ¨ main thread ä¸ŠåŸ·è¡Œä¸ç„¶æœƒå¡æ­»ï¼Œ<br>æ‰€ä»¥ä¸‹é¢ç¯„ä¾‹æ‰ä½¿ç”¨ <code>DispatchQueue.global().async</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handlePipeApi</span>()</span>&#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url1 <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://httpbin.org/get?data=1&quot;</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url2 <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://httpbin.org/get?data=2&quot;</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> group <span class="operator">=</span> <span class="type">DispatchGroup</span>()</span><br><span class="line">    <span class="type">DispatchQueue</span>.global().async &#123;</span><br><span class="line">        group.enter()</span><br><span class="line">        <span class="type">AF</span>.request(url1).response&#123;</span><br><span class="line">            response <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Done PipeApi url1 <span class="subst">\(response)</span>&quot;</span>)</span><br><span class="line">            group.leave()</span><br><span class="line">        &#125;</span><br><span class="line">        group.wait()</span><br><span class="line">        </span><br><span class="line">        group.enter()</span><br><span class="line">        <span class="type">AF</span>.request(url2).response&#123;</span><br><span class="line">            response <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Done PipeApi url2 <span class="subst">\(response)</span>&quot;</span>)</span><br><span class="line">            group.leave()</span><br><span class="line">        &#125;</span><br><span class="line">        group.wait()</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Done PipeApi&quot;</span>)</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Update UI on main thread.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="DispatchQueue-æ‡‰ç”¨æƒ…å¢ƒ-Demo"><a href="#DispatchQueue-æ‡‰ç”¨æƒ…å¢ƒ-Demo" class="headerlink" title="DispatchQueue æ‡‰ç”¨æƒ…å¢ƒ Demo"></a>DispatchQueue æ‡‰ç”¨æƒ…å¢ƒ Demo</h1><p><a href="https://github.com/pinkpika/DispatchQueueCase">Demo - DispatchQueueCase</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note default flat&quot;&gt;&lt;p&gt;æœ¬ç¯‡å…§å®¹ä»¥éå¸¸åˆéšçš„æ–¹å¼ä»‹ç´¹ DispatchQueueï¼Œ&lt;br&gt;åŒæ™‚æœƒèªªæ˜ iOS é«”ç³»è£¡æœ€æµè¡Œçš„å¤šç·’è™•ç†çš„æŠ€è¡“ GCD å’Œä¸€äº›æ‡‰ç”¨æƒ…å¢ƒå’Œç¯„ä¾‹ï¼Œ&lt;br&gt;å¾Œä¾†ä¹Ÿæœ‰ç”¨åœ¨å…¬å¸åŸ¹è¨“åˆæ¬¡æ¥è§¸ iOS å·¥ç¨‹å¸«çš„ä¸€æ®µèª²ç¨‹è£¡ã€‚</summary>
      
    
    
    
    <category term="iOS Development" scheme="http://pinkpika.github.io/pinkblog/categories/iOS-Development/"/>
    
    
    <category term="iOS" scheme="http://pinkpika.github.io/pinkblog/tags/iOS/"/>
    
    <category term="Multithreading" scheme="http://pinkpika.github.io/pinkblog/tags/Multithreading/"/>
    
    <category term="å¤šåŸ·è¡Œç·’" scheme="http://pinkpika.github.io/pinkblog/tags/%E5%A4%9A%E5%9F%B7%E8%A1%8C%E7%B7%92/"/>
    
  </entry>
  
</feed>
